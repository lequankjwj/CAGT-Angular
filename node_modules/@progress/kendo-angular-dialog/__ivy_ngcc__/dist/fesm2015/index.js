/**-----------------------------------------------------------------------------------------
* Copyright © 2020 Progress Software Corporation. All rights reserved.
* Licensed under commercial license. See LICENSE.md in the project root for more information
*-------------------------------------------------------------------------------------------*/
import { EventEmitter, TemplateRef, Component, ElementRef, Input, Output, HostBinding, Optional, InjectionToken, Renderer2, ChangeDetectorRef, ContentChild, ViewChild, HostListener, Injectable, isDevMode, ComponentFactoryResolver, Inject, NgZone, Directive, Host, ViewChildren, ViewContainerRef, forwardRef, NgModule } from '@angular/core';
import { trigger, state, style, transition, animate } from '@angular/animations';
import { LocalizationService, L10N_PREFIX, ComponentMessages } from '@progress/kendo-angular-l10n';
import { Subject, merge, Subscription, of } from 'rxjs';
import { filter, map, take, share, tap, switchMap, takeUntil } from 'rxjs/operators';
import { DraggableDirective, isChanged, isDocumentAvailable, DraggableModule } from '@progress/kendo-angular-common';
import { offset, scrollPosition, positionWithScroll, getDocumentElement, getWindowViewPort } from '@progress/kendo-popup-common';
import { Button } from '@progress/kendo-angular-buttons';
import { CommonModule } from '@angular/common';

/**
 * Specifies the action buttons of the Dialog
 * ([see example]({% slug actionbuttons_dialog %})).
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from '@progress/kendo-angular-l10n';
import * as ɵngcc3 from '@progress/kendo-angular-common';

function DialogActionsComponent_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!actions"]);
} }
function DialogActionsComponent_ng_container_1_button_1_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 2);
    ɵngcc0.ɵɵlistener("click", function DialogActionsComponent_ng_container_1_button_1_Template_button_click_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r6); const action_r4 = ctx.$implicit; const ctx_r5 = ɵngcc0.ɵɵnextContext(2); return ctx_r5.onButtonClick(action_r4, $event); });
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const action_r4 = ctx.$implicit;
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngClass", ctx_r3.buttonClass(action_r4));
    ɵngcc0.ɵɵattribute("aria-label", action_r4.text);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", action_r4.text, " ");
} }
function DialogActionsComponent_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, DialogActionsComponent_ng_container_1_button_1_Template, 2, 3, "button", 1);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.actions);
} }
function DialogActionsComponent_2_ng_template_0_Template(rf, ctx) { }
function DialogActionsComponent_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, DialogActionsComponent_2_ng_template_0_Template, 0, 0, "ng-template", 3);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r2.actions);
} }
const _c0 = ["*"];
var I18N_1;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The title of the close button
     * @meaning kendo.dialog.closeTitle
     */ 
    const MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_2 = goog.getMsg("Close");
    I18N_1 = MSG_EXTERNAL_7499923323865444383$$DIST_FESM2015_INDEX_JS_2;
}
else {
    I18N_1 = $localize `:kendo.dialog.closeTitle|The title of the close button␟9b2bd34897f127e69e5f02f64692fca98a5a7572␟7499923323865444383:Close`;
}
const _c3 = ["closeTitle", I18N_1];
function DialogComponent_kendo_dialog_titlebar_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "kendo-dialog-titlebar", 7);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("closeTitle", ctx_r0.closeTitle)("id", ctx_r0.titleId);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.title);
} }
function DialogComponent_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!title"]);
} }
function DialogComponent_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 1, ["*ngIf", "!contentTemplate"]);
} }
function DialogComponent_8_ng_template_0_Template(rf, ctx) { }
function DialogComponent_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, DialogComponent_8_ng_template_0_Template, 0, 0, "ng-template", 8);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r3.contentTemplate);
} }
function DialogComponent_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 2, ["*ngIf", "!actions"]);
} }
function DialogComponent_kendo_dialog_actions_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "kendo-dialog-actions", 9);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("actions", ctx_r5.actions)("layout", ctx_r5.actionsLayout);
} }
const _c4 = [[["kendo-dialog-titlebar"]], "*", [["kendo-dialog-actions"]]];
const _c5 = ["kendo-dialog-titlebar", "*", "kendo-dialog-actions"];
function WindowTitleBarComponent_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!template"]);
} }
function WindowTitleBarComponent_1_ng_template_0_Template(rf, ctx) { }
const _c6 = function (a0) { return { "$implicit": a0 }; };
function WindowTitleBarComponent_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WindowTitleBarComponent_1_ng_template_0_Template, 0, 0, "ng-template", 1);
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r1.template)("ngTemplateOutletContext", ɵngcc0.ɵɵpureFunction1(2, _c6, ctx_r1.service));
} }
var I18N_7;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The title of the close button
     * @meaning kendo.window.closeTitle
     */ 
    const MSG_EXTERNAL_2849207436137160812$$DIST_FESM2015_INDEX_JS_8 = goog.getMsg("Close");
    I18N_7 = MSG_EXTERNAL_2849207436137160812$$DIST_FESM2015_INDEX_JS_8;
}
else {
    I18N_7 = $localize `:kendo.window.closeTitle|The title of the close button␟bb50cb526949482fc976fd868573ab283580ee69␟2849207436137160812:Close`;
}
var I18N_9;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The title of the restore button
     * @meaning kendo.window.restoreTitle
     */ 
    const MSG_EXTERNAL_3443120027481340803$$DIST_FESM2015_INDEX_JS_10 = goog.getMsg("Restore");
    I18N_9 = MSG_EXTERNAL_3443120027481340803$$DIST_FESM2015_INDEX_JS_10;
}
else {
    I18N_9 = $localize `:kendo.window.restoreTitle|The title of the restore button␟9a9ce231f0396e40adcfa80bfa76e546e0085be0␟3443120027481340803:Restore`;
}
var I18N_11;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The title of the maximize button
     * @meaning kendo.window.maximizeTitle
     */ 
    const MSG_EXTERNAL_7793415109119115257$$DIST_FESM2015_INDEX_JS_12 = goog.getMsg("Maximize");
    I18N_11 = MSG_EXTERNAL_7793415109119115257$$DIST_FESM2015_INDEX_JS_12;
}
else {
    I18N_11 = $localize `:kendo.window.maximizeTitle|The title of the maximize button␟42bc654ef8767c5df5277aa88941b94f8d373b4d␟7793415109119115257:Maximize`;
}
var I18N_13;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The title of the minimize button
     * @meaning kendo.window.minimizeTitle
     */ 
    const MSG_EXTERNAL_7581084655285341827$$DIST_FESM2015_INDEX_JS_14 = goog.getMsg("Minimize");
    I18N_13 = MSG_EXTERNAL_7581084655285341827$$DIST_FESM2015_INDEX_JS_14;
}
else {
    I18N_13 = $localize `:kendo.window.minimizeTitle|The title of the minimize button␟7ca9f9b41a23760f7f74e91ee4c76d5a5f4a706c␟7581084655285341827:Minimize`;
}
const _c15 = ["closeTitle", I18N_7, "restoreTitle", I18N_9, "maximizeTitle", I18N_11, "minimizeTitle", I18N_13];
function WindowComponent_kendo_window_titlebar_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "kendo-window-titlebar", 5);
    ɵngcc0.ɵɵelementStart(1, "div", 6);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "div", 7);
    ɵngcc0.ɵɵelement(4, "button", 8);
    ɵngcc0.ɵɵelement(5, "button", 9);
    ɵngcc0.ɵɵelement(6, "button", 10);
    ɵngcc0.ɵɵelement(7, "button", 11);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("template", ctx_r0.titleBarTemplate);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.title);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵattribute("title", ctx_r0.minimizeButtonTitle)("aria-label", ctx_r0.minimizeButtonTitle);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r0.maximizeButtonTitle)("aria-label", ctx_r0.maximizeButtonTitle);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r0.restoreButtonTitle)("aria-label", ctx_r0.restoreButtonTitle);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("title", ctx_r0.closeButtonTitle)("aria-label", ctx_r0.closeButtonTitle);
} }
function WindowComponent_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 0, ["*ngIf", "!showDefaultTitleBar"]);
} }
function WindowComponent_div_5_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵprojection(0, 1, ["*ngIf", "!contentTemplate"]);
} }
function WindowComponent_div_5_2_ng_template_0_Template(rf, ctx) { }
function WindowComponent_div_5_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WindowComponent_div_5_2_ng_template_0_Template, 0, 0, "ng-template", 13);
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r5.contentTemplate);
} }
function WindowComponent_div_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 12);
    ɵngcc0.ɵɵtemplate(1, WindowComponent_div_5_1_Template, 1, 0, undefined, 2);
    ɵngcc0.ɵɵtemplate(2, WindowComponent_div_5_2_Template, 1, 1, undefined, 2);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("hidden", ctx_r2.state === "minimized" && ctx_r2.keepContent);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r2.contentTemplate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r2.contentTemplate);
} }
function WindowComponent_ng_template_6_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 15);
} if (rf & 2) {
    const dir_r8 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("direction", dir_r8);
} }
function WindowComponent_ng_template_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, WindowComponent_ng_template_6_div_0_Template, 1, 1, "div", 14);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r3.resizeDirections);
} }
const _c16 = [[["kendo-window-titlebar"]], "*"];
const _c17 = ["kendo-window-titlebar", "*"];
class DialogActionsComponent {
    constructor(el) {
        this.el = el;
        /**
         * Specifies the possible layout of the action buttons.
         */
        this.layout = 'stretched';
        /**
         * Fires when the user clicks an action button.
         */
        this.action = new EventEmitter();
        this.buttonGroupClassName = true;
    }
    get className() {
        return this.layout === 'stretched';
    }
    /**
     * @hidden
     */
    actionTemplate() {
        return this.actions instanceof TemplateRef;
    }
    /**
     * @hidden
     */
    onButtonClick(action, _e) {
        this.action.emit(action);
    }
    /**
     * @hidden
     */
    buttonClass(action) {
        const classes = ['k-button'];
        if (action.primary) {
            classes.push('k-primary');
        }
        return classes.join(' ');
    }
}
DialogActionsComponent.ɵfac = function DialogActionsComponent_Factory(t) { return new (t || DialogActionsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
DialogActionsComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: DialogActionsComponent, selectors: [["kendo-dialog-actions"]], hostVars: 4, hostBindings: function DialogActionsComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-dialog-buttongroup", ctx.buttonGroupClassName)("k-dialog-button-layout-stretched", ctx.className);
    } }, inputs: { layout: "layout", actions: "actions" }, outputs: { action: "action" }, ngContentSelectors: _c0, decls: 3, vars: 3, consts: [[4, "ngIf"], ["type", "button", 3, "ngClass", "click", 4, "ngFor", "ngForOf"], ["type", "button", 3, "ngClass", "click"], [3, "ngTemplateOutlet"]], template: function DialogActionsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵtemplate(0, DialogActionsComponent_0_Template, 1, 0, undefined, 0);
        ɵngcc0.ɵɵtemplate(1, DialogActionsComponent_ng_container_1_Template, 2, 1, "ng-container", 0);
        ɵngcc0.ɵɵtemplate(2, DialogActionsComponent_2_Template, 1, 1, undefined, 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx.actions);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.actionTemplate());
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.actionTemplate());
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgForOf, ɵngcc1.NgClass, ɵngcc1.NgTemplateOutlet], encapsulation: 2 });
/** @nocollapse */
DialogActionsComponent.ctorParameters = () => [
    { type: ElementRef }
];
DialogActionsComponent.propDecorators = {
    actions: [{ type: Input }],
    layout: [{ type: Input }],
    action: [{ type: Output }],
    buttonGroupClassName: [{ type: HostBinding, args: ['class.k-dialog-buttongroup',] }],
    className: [{ type: HostBinding, args: ['class.k-dialog-button-layout-stretched',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DialogActionsComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-dialog-actions',
                template: `
        <ng-content *ngIf="!actions"></ng-content>
        <ng-container *ngIf="!actionTemplate()">
            <button
                type="button"
                [ngClass]="buttonClass(action)"
                (click)="onButtonClick(action, $event)"
                *ngFor="let action of actions"
                [attr.aria-label]="action.text"
            >
                {{ action.text }}
            </button>
        </ng-container>
        <ng-template [ngTemplateOutlet]="actions" *ngIf="actionTemplate()"></ng-template>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }]; }, { layout: [{
            type: Input
        }], action: [{
            type: Output
        }], buttonGroupClassName: [{
            type: HostBinding,
            args: ['class.k-dialog-buttongroup']
        }], className: [{
            type: HostBinding,
            args: ['class.k-dialog-button-layout-stretched']
        }], actions: [{
            type: Input
        }] }); })();

/**
 * @hidden
 */
class PreventableEvent {
    constructor() {
        this.prevented = false;
    }
    /**
     * Prevents the default action for a specified event.
     * In this way, the source component suppresses the built-in behavior that follows the event.
     */
    preventDefault() {
        this.prevented = true;
    }
    /**
     * If the event is prevented by any of its subscribers, returns `true`.
     *
     * @returns `true` if the default action was prevented. Otherwise, returns `false`.
     */
    isDefaultPrevented() {
        return this.prevented;
    }
}

/**
 * Represents the [Kendo UI DialogTitleBar component for Angular]({% slug api_dialog_dialogtitlebarcomponent %}).
 *
 * It is used as part of the Dialog content when the component is created dynamically by using an [Angular service]({% slug service_dialog %}).
 */
class DialogTitleBarComponent {
    constructor(hostElement, localizationService) {
        this.hostElement = hostElement;
        this.localizationService = localizationService;
        /**
         * Fires when the close button of the title-bar is clicked.
         */
        this.close = new EventEmitter();
    }
    get className() {
        return true;
    }
    get closeButtonTitle() {
        return this.localizationService.get('closeTitle');
    }
    ngAfterViewChecked() {
        const element = this.hostElement.nativeElement;
        element.setAttribute('id', this.id);
    }
    /**
     * @hidden
     */
    onCloseClick(e) {
        e.preventDefault();
        const eventArgs = new PreventableEvent();
        this.close.emit(eventArgs);
    }
}
DialogTitleBarComponent.ɵfac = function DialogTitleBarComponent_Factory(t) { return new (t || DialogTitleBarComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService, 8)); };
DialogTitleBarComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: DialogTitleBarComponent, selectors: [["kendo-dialog-titlebar"]], hostVars: 4, hostBindings: function DialogTitleBarComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-window-titlebar", ctx.className)("k-dialog-titlebar", ctx.className);
    } }, inputs: { id: "id", closeTitle: "closeTitle" }, outputs: { close: "close" }, ngContentSelectors: _c0, decls: 5, vars: 2, consts: [[1, "k-window-title", "k-dialog-title"], [1, "k-window-actions", "k-dialog-actions"], ["href", "#", "role", "button", 1, "k-button", "k-bare", "k-button-icon", "k-window-action", "k-dialog-action", "k-dialog-close", 3, "click"], [1, "k-icon", "k-i-x"]], template: function DialogTitleBarComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵprojection(1);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(2, "div", 1);
        ɵngcc0.ɵɵelementStart(3, "a", 2);
        ɵngcc0.ɵɵlistener("click", function DialogTitleBarComponent_Template_a_click_3_listener($event) { return ctx.onCloseClick($event); });
        ɵngcc0.ɵɵelement(4, "span", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵattribute("title", ctx.closeButtonTitle)("aria-label", ctx.closeButtonTitle);
    } }, encapsulation: 2 });
/** @nocollapse */
DialogTitleBarComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: LocalizationService, decorators: [{ type: Optional }] }
];
DialogTitleBarComponent.propDecorators = {
    close: [{ type: Output }],
    id: [{ type: Input }],
    closeTitle: [{ type: Input }],
    className: [{ type: HostBinding, args: ['class.k-window-titlebar',] }, { type: HostBinding, args: ['class.k-dialog-titlebar',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DialogTitleBarComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-dialog-titlebar',
                template: `
        <div class="k-window-title k-dialog-title">
            <ng-content></ng-content>
        </div>

        <div class="k-window-actions k-dialog-actions">
            <a
                href="#"
                role="button"
                [attr.title]="closeButtonTitle"
                [attr.aria-label]="closeButtonTitle"
                class="k-button k-bare k-button-icon k-window-action k-dialog-action k-dialog-close"
                (click)="onCloseClick($event)"
            >
                <span class="k-icon k-i-x"></span>
            </a>
        </div>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc2.LocalizationService, decorators: [{
                type: Optional
            }] }]; }, { close: [{
            type: Output
        }], className: [{
            type: HostBinding,
            args: ['class.k-window-titlebar']
        }, {
            type: HostBinding,
            args: ['class.k-dialog-titlebar']
        }], id: [{
            type: Input
        }], closeTitle: [{
            type: Input
        }] }); })();

/**
 * @hidden
 */
const isPresent = (value) => value !== null && value !== undefined;
/**
 * @hidden
 */
const isTruthy = (value) => !!value;
const toClassList = (classNames) => String(classNames).trim().split(' ');
const focusableRegex = /^(?:a|input|select|textarea|button|object)$/i;
/**
 * @hidden
 */
var Keys;
(function (Keys) {
    Keys[Keys["esc"] = 27] = "esc";
    Keys[Keys["tab"] = 9] = "tab";
    Keys[Keys["enter"] = 13] = "enter";
    Keys[Keys["space"] = 32] = "space";
    Keys[Keys["ctrl"] = 17] = "ctrl";
    Keys[Keys["shift"] = 16] = "shift";
    Keys[Keys["left"] = 37] = "left";
    Keys[Keys["up"] = 38] = "up";
    Keys[Keys["right"] = 39] = "right";
    Keys[Keys["down"] = 40] = "down";
})(Keys || (Keys = {}));
/**
 * @hidden
 */
const DIALOG_ELEMENTS_HANDLING_ESC_KEY = 'k-dialog-wrapper k-dialog-buttongroup k-dialog-action';
/**
 * @hidden
 */
const DIALOG_ELEMENTS_HANDLING_ARROWS = 'k-dialog-buttongroup';
/**
 * @hidden
 */
const WINDOW_CLASSES = 'k-window';
/**
 * @hidden
 */
const hasClasses = (element, classNames) => {
    const namesList = toClassList(classNames);
    return Boolean(toClassList(element.className).find((className) => namesList.indexOf(className) >= 0));
};
/**
 * @hidden
 */
const isVisible = (element) => {
    const rect = element.getBoundingClientRect();
    return !!(rect.width && rect.height) && window.getComputedStyle(element).visibility !== 'hidden';
};
/**
 * @hidden
 */
const isFocusable = (element, checkVisibility = true) => {
    if (element.tagName) {
        const tagName = element.tagName.toLowerCase();
        const tabIndex = element.getAttribute('tabIndex');
        const validTabIndex = tabIndex !== null && !isNaN(tabIndex) && tabIndex > -1;
        let focusable = false;
        if (focusableRegex.test(tagName)) {
            focusable = !element.disabled;
        }
        else {
            focusable = validTabIndex;
        }
        return focusable && (!checkVisibility || isVisible(element));
    }
    return false;
};
/**
 * @hidden
 */
const focusableSelector = [
    'a[href]',
    'area[href]',
    'input:not([disabled])',
    'select:not([disabled])',
    'textarea:not([disabled])',
    'button:not([disabled])',
    'iframe',
    'object',
    'embed',
    '*[tabindex]',
    '*[contenteditable]'
].join(',');
/**
 * @hidden
 */
const preventDefault = ({ originalEvent: event }) => {
    event.stopPropagation();
    event.preventDefault();
};
/**
 * @hidden
 */
const RESIZE_DIRECTIONS = ['n', 'e', 's', 'w', 'se', 'sw', 'ne', 'nw'];
/**
 * @hidden
 */
const OFFSET_STYLES = ['top', 'left', 'width', 'height'];
/**
 * @hidden
 */
const isString = (value) => value instanceof String || typeof value === 'string';
/**
 * @hidden
 */
const isNumber = (value) => typeof value === 'number' && isFinite(value);
/**
 * @hidden
 */
const createValueWithUnit = (value) => value + (isNumber(value) ? 'px' : '');

/**
 * The settings for the Dialog actions when the Dialog is opened through `DialogService`
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogAction {
}
/**
 * Indicates that the **Close** button is clicked. Used when the results from
 * the Dialogs that are opened through `DialogService` are filtered
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogCloseResult {
}
/**
 * The settings that can be used when the Dialog is opened through `DialogService`.
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogSettings {
}
/**
 * Holds references to the object instance and published events of the Dialog.
 * Controls the Dialogs that were opened through the `DialogService`
 * ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 */
class DialogRef {
}

/**
 * @hidden
 */
const DIALOG_LOCALIZATION_SERVICE = new InjectionToken('Dialog LocalizationService');

/**
 * Represents the [Kendo UI Dialog component for Angular]({% slug overview_dialog_dialogs %}).
 */
class DialogComponent {
    constructor(_elRef, _renderer, localization, cdr) {
        this._elRef = _elRef;
        this._renderer = _renderer;
        this.cdr = cdr;
        /**
         * Specifies the layout of the action buttons in the Dialog.
         * This option is only applicable if the action buttons are specified through the `actions` options.
         *
         * @default 'stretched'
         */
        this.actionsLayout = 'stretched';
        /**
         * @hidden
         */
        this.titleId = null;
        /**
         * Fires when the user clicks an action button of the Dialog.
         * The event is fired only when the action buttons are specified through the `actions` options.
         */
        this.action = new EventEmitter();
        /**
         * Fires when the user clicks the **Close** button of the Dialog.
         */
        this.close = new EventEmitter();
        this.tabIndex = 0;
        this.subscriptions = [];
        this.direction = localization.rtl ? 'rtl' : 'ltr';
        this.subscriptions.push(localization.changes.subscribe(({ rtl }) => (this.direction = rtl ? 'rtl' : 'ltr')));
        this.titleId = this.generateTitleId();
    }
    get dir() {
        return this.direction;
    }
    /**
     * @hidden
     */
    onComponentKeydown(event) {
        const target = event.target;
        const parent = target.parentElement;
        if (hasClasses(target, DIALOG_ELEMENTS_HANDLING_ESC_KEY) || hasClasses(parent, DIALOG_ELEMENTS_HANDLING_ESC_KEY)) {
            if (event.keyCode === Keys.esc) {
                this.close.emit(new DialogCloseResult());
            }
        }
        if (hasClasses(target, 'k-button') &&
            hasClasses(parent, DIALOG_ELEMENTS_HANDLING_ARROWS) &&
            (event.keyCode === Keys.left || event.keyCode === Keys.right)) {
            this.handleActionButtonFocus(parent, event.keyCode);
        }
        if (event.keyCode === Keys.tab) {
            this.keepFocusWithinComponent(target, event);
        }
    }
    ngAfterContentInit() {
        this.bubble('close', this.titlebarContent);
        if (this.titlebarContent) {
            this.titlebarContent.id = this.titleId;
        }
    }
    ngAfterViewInit() {
        this.handleInitialFocus();
        this.bubble('close', this.titlebarView);
        this.bubble('action', this.actionsView);
        if (this.titlebarView || this.titlebarContent) {
            //Needed for Dialogs created via service
            this._renderer.setAttribute(this._elRef.nativeElement.querySelector('.k-dialog'), 'aria-labelledby', this.titleId);
        }
    }
    ngOnInit() {
        this._renderer.removeAttribute(this._elRef.nativeElement, 'title');
        this.cdr.detectChanges();
    }
    ngOnDestroy() {
        this.subscriptions.forEach(s => s.unsubscribe());
        this.subscriptions = [];
    }
    /**
     * Focuses the wrapper of the Dialog component.
     */
    focus() {
        const wrapper = this._elRef.nativeElement;
        if (isPresent(wrapper)) {
            wrapper.focus();
        }
    }
    /**
     * @hidden
     */
    handleInitialFocus() {
        const wrapper = this._elRef.nativeElement;
        const primaryButton = wrapper.querySelector('.k-primary');
        if (this.autoFocusedElement) {
            const initiallyFocusedElement = wrapper.querySelector(this.autoFocusedElement);
            if (initiallyFocusedElement) {
                initiallyFocusedElement.focus();
            }
        }
        else if (this.shouldFocusPrimary(primaryButton)) {
            primaryButton.focus();
        }
        else {
            wrapper.focus();
        }
    }
    /**
     * @hidden
     */
    handleActionButtonFocus(parent, key) {
        const focusableActionButtons = this.getAllFocusableChildren(parent);
        for (let i = 0; i < focusableActionButtons.length; i++) {
            const current = focusableActionButtons[i];
            if (current === document.activeElement) {
                if (key === Keys.left && i > 0) {
                    focusableActionButtons[i - 1].focus();
                    break;
                }
                if (key === Keys.right && i < focusableActionButtons.length - 1) {
                    focusableActionButtons[i + 1].focus();
                    break;
                }
            }
        }
    }
    /**
     * @hidden
     */
    keepFocusWithinComponent(target, event) {
        const firstFocusable = this._elRef.nativeElement;
        const lastFocusable = this.getLastFocusableElement(firstFocusable);
        const tabBeforeFirstFocusable = target === firstFocusable && event.shiftKey;
        const tabAfterLastFocusable = !event.shiftKey && isPresent(lastFocusable) && target === lastFocusable;
        const tabWithNoFocusable = !isPresent(lastFocusable) && !event.shiftKey;
        if (tabBeforeFirstFocusable || tabWithNoFocusable) {
            event.preventDefault();
            firstFocusable.focus();
        }
        if (tabAfterLastFocusable) {
            event.preventDefault();
            lastFocusable.focus();
        }
    }
    /**
     * @hidden
     */
    shouldFocusPrimary(el) {
        return isPresent(el) && isFocusable(el);
    }
    /**
     * @hidden
     */
    getAllFocusableChildren(parent) {
        return parent.querySelectorAll(focusableSelector);
    }
    /**
     * @hidden
     */
    getLastFocusableElement(parent) {
        const all = this.getAllFocusableChildren(parent);
        return all.length > 0 ? all[all.length - 1] : null;
    }
    /**
     * @hidden
     */
    generateTitleId() {
        return 'kendo-dialog-title-' + Math.ceil(Math.random() * 1000000).toString();
    }
    get wrapperClass() {
        return true;
    }
    get styles() {
        const styles = {};
        if (this.width) {
            styles.width = createValueWithUnit(this.width);
        }
        if (this.height) {
            styles.height = createValueWithUnit(this.height);
        }
        if (this.minWidth) {
            styles.minWidth = createValueWithUnit(this.minWidth);
        }
        if (this.maxWidth) {
            styles.maxWidth = createValueWithUnit(this.maxWidth);
        }
        if (this.minHeight) {
            styles.minHeight = createValueWithUnit(this.minHeight);
        }
        if (this.maxHeight) {
            styles.maxHeight = createValueWithUnit(this.maxHeight);
        }
        return styles;
    }
    bubble(eventName, component) {
        if (component) {
            const emit = e => this[eventName].emit(e);
            const s = component[eventName].subscribe(emit);
            this.subscriptions.push(s);
        }
    }
}
DialogComponent.ɵfac = function DialogComponent_Factory(t) { return new (t || DialogComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };
DialogComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: DialogComponent, selectors: [["kendo-dialog"]], contentQueries: function DialogComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, DialogTitleBarComponent, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titlebarContent = _t.first);
    } }, viewQuery: function DialogComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(DialogTitleBarComponent, true);
        ɵngcc0.ɵɵviewQuery(DialogActionsComponent, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titlebarView = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.actionsView = _t.first);
    } }, hostVars: 4, hostBindings: function DialogComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown", function DialogComponent_keydown_HostBindingHandler($event) { return ctx.onComponentKeydown($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("tabIndex", ctx.tabIndex)("dir", ctx.dir);
        ɵngcc0.ɵɵclassProp("k-dialog-wrapper", ctx.wrapperClass);
    } }, inputs: { actionsLayout: "actionsLayout", actions: "actions", autoFocusedElement: "autoFocusedElement", title: "title", width: "width", minWidth: "minWidth", maxWidth: "maxWidth", height: "height", minHeight: "minHeight", maxHeight: "maxHeight" }, outputs: { action: "action", close: "close" }, exportAs: ["kendoDialog"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: DIALOG_LOCALIZATION_SERVICE,
                useExisting: LocalizationService
            },
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.dialog'
            }
        ])], ngContentSelectors: _c5, decls: 11, vars: 9, consts: [["kendoDialogLocalizedMessages", "", 6, "closeTitle"], [1, "k-overlay"], ["role", "dialog", 1, "k-widget", "k-window", "k-dialog", 3, "ngStyle"], [3, "closeTitle", "id", 4, "ngIf"], [4, "ngIf"], [1, "k-content", "k-window-content", "k-dialog-content"], [3, "actions", "layout", 4, "ngIf"], [3, "closeTitle", "id"], [3, "ngTemplateOutlet"], [3, "actions", "layout"]], template: function DialogComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c4);
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵi18nAttributes(1, _c3);
        ɵngcc0.ɵɵelement(2, "div", 1);
        ɵngcc0.ɵɵelementStart(3, "div", 2);
        ɵngcc0.ɵɵtemplate(4, DialogComponent_kendo_dialog_titlebar_4_Template, 2, 3, "kendo-dialog-titlebar", 3);
        ɵngcc0.ɵɵtemplate(5, DialogComponent_5_Template, 1, 0, undefined, 4);
        ɵngcc0.ɵɵelementStart(6, "div", 5);
        ɵngcc0.ɵɵtemplate(7, DialogComponent_7_Template, 1, 0, undefined, 4);
        ɵngcc0.ɵɵtemplate(8, DialogComponent_8_Template, 1, 1, undefined, 4);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(9, DialogComponent_9_Template, 1, 0, undefined, 4);
        ɵngcc0.ɵɵtemplate(10, DialogComponent_kendo_dialog_actions_10_Template, 1, 2, "kendo-dialog-actions", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementContainerEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("@overlayAppear", undefined);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngStyle", ctx.styles)("@dialogSlideInAppear", undefined);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.title);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.title);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.contentTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.contentTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.actions);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.actions);
    } }, directives: function () { return [LocalizedMessagesDirective, ɵngcc1.NgStyle, ɵngcc1.NgIf, DialogTitleBarComponent, ɵngcc1.NgTemplateOutlet, DialogActionsComponent]; }, encapsulation: 2, data: { animation: [
            trigger('overlayAppear', [
                state('in', style({ opacity: 1 })),
                transition('void => *', [style({ opacity: 0.1 }), animate('.3s cubic-bezier(.2, .6, .4, 1)')])
            ]),
            trigger('dialogSlideInAppear', [
                state('in', style({ transform: 'translate(0, 0)' })),
                transition('void => *', [style({ transform: 'translate(0, -10%)' }), animate('.3s cubic-bezier(.2, 1, .2, 1)')])
            ])
        ] } });
/** @nocollapse */
DialogComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: LocalizationService },
    { type: ChangeDetectorRef }
];
DialogComponent.propDecorators = {
    actions: [{ type: Input }],
    actionsLayout: [{ type: Input }],
    autoFocusedElement: [{ type: Input }],
    title: [{ type: Input }],
    width: [{ type: Input }],
    minWidth: [{ type: Input }],
    maxWidth: [{ type: Input }],
    height: [{ type: Input }],
    minHeight: [{ type: Input }],
    maxHeight: [{ type: Input }],
    action: [{ type: Output }],
    close: [{ type: Output }],
    dir: [{ type: HostBinding, args: ['attr.dir',] }],
    tabIndex: [{ type: HostBinding, args: ['attr.tabIndex',] }],
    titlebarContent: [{ type: ContentChild, args: [DialogTitleBarComponent,] }],
    titlebarView: [{ type: ViewChild, args: [DialogTitleBarComponent,] }],
    actionsView: [{ type: ViewChild, args: [DialogActionsComponent,] }],
    onComponentKeydown: [{ type: HostListener, args: ['keydown', ['$event'],] }],
    wrapperClass: [{ type: HostBinding, args: ['class.k-dialog-wrapper',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DialogComponent, [{
        type: Component,
        args: [{
                animations: [
                    trigger('overlayAppear', [
                        state('in', style({ opacity: 1 })),
                        transition('void => *', [style({ opacity: 0.1 }), animate('.3s cubic-bezier(.2, .6, .4, 1)')])
                    ]),
                    trigger('dialogSlideInAppear', [
                        state('in', style({ transform: 'translate(0, 0)' })),
                        transition('void => *', [style({ transform: 'translate(0, -10%)' }), animate('.3s cubic-bezier(.2, 1, .2, 1)')])
                    ])
                ],
                exportAs: 'kendoDialog',
                providers: [
                    LocalizationService,
                    {
                        provide: DIALOG_LOCALIZATION_SERVICE,
                        useExisting: LocalizationService
                    },
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.dialog'
                    }
                ],
                selector: 'kendo-dialog',
                template: `
        <ng-container
            kendoDialogLocalizedMessages
            i18n-closeTitle="kendo.dialog.closeTitle|The title of the close button"
            closeTitle="Close"
        >
        <div class="k-overlay" @overlayAppear></div>

        <div class="k-widget k-window k-dialog" role="dialog" [ngStyle]="styles" @dialogSlideInAppear>
            <kendo-dialog-titlebar *ngIf="title" [closeTitle]="closeTitle" [id]="titleId">{{ title }}</kendo-dialog-titlebar>
            <ng-content select="kendo-dialog-titlebar" *ngIf="!title"></ng-content>

            <div class="k-content k-window-content k-dialog-content">
                <ng-content *ngIf="!contentTemplate"></ng-content>
                <ng-template [ngTemplateOutlet]="contentTemplate" *ngIf="contentTemplate"></ng-template>
            </div>

            <ng-content select="kendo-dialog-actions" *ngIf="!actions"></ng-content>
            <kendo-dialog-actions *ngIf="actions" [actions]="actions" [layout]="actionsLayout"> </kendo-dialog-actions>
        </div>
    </ng-container>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.ChangeDetectorRef }]; }, { actionsLayout: [{
            type: Input
        }], action: [{
            type: Output
        }], close: [{
            type: Output
        }], tabIndex: [{
            type: HostBinding,
            args: ['attr.tabIndex']
        }], dir: [{
            type: HostBinding,
            args: ['attr.dir']
        }], onComponentKeydown: [{
            type: HostListener,
            args: ['keydown', ['$event']]
        }], wrapperClass: [{
            type: HostBinding,
            args: ['class.k-dialog-wrapper']
        }], actions: [{
            type: Input
        }], autoFocusedElement: [{
            type: Input
        }], title: [{
            type: Input
        }], width: [{
            type: Input
        }], minWidth: [{
            type: Input
        }], maxWidth: [{
            type: Input
        }], height: [{
            type: Input
        }], minHeight: [{
            type: Input
        }], maxHeight: [{
            type: Input
        }], titlebarContent: [{
            type: ContentChild,
            args: [DialogTitleBarComponent]
        }], titlebarView: [{
            type: ViewChild,
            args: [DialogTitleBarComponent]
        }], actionsView: [{
            type: ViewChild,
            args: [DialogActionsComponent]
        }] }); })();

/**
 * The base class  which will be extended by a component that is provided as content through `content`
 * ([see example]({% slug service_dialog %}#toc-passing-title-content-and-actions-as-a-single-component)).
 */
class DialogContentBase {
    constructor(dialog) {
        this.dialog = dialog;
    }
    /**
     * @hidden
     */
    ngAfterViewInit() {
        if (this.dialogTitleBar) {
            // when opening component inside dialog with service AND the component has defined its own titlebar
            this.dialogTitleBar.close.pipe(filter((e) => !e.isDefaultPrevented())).subscribe(() => {
                this.dialog.close();
            });
        }
        if (this.dialogActions) {
            if (this.dialogActions.actions) {
                this.dialogActions.action.subscribe(action => this.dialog.dialog.instance.action.emit(action));
            }
        }
    }
}
DialogContentBase.ɵfac = function DialogContentBase_Factory(t) { ɵngcc0.ɵɵinvalidFactory(); };
DialogContentBase.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DialogContentBase, viewQuery: function DialogContentBase_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(DialogTitleBarComponent, true);
        ɵngcc0.ɵɵviewQuery(DialogActionsComponent, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.dialogTitleBar = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.dialogActions = _t.first);
    } } });
DialogContentBase.propDecorators = {
    dialogTitleBar: [{ type: ViewChild, args: [DialogTitleBarComponent,] }],
    dialogActions: [{ type: ViewChild, args: [DialogActionsComponent,] }]
};


/**
 * @hidden
 */
class DialogContainerService {
    set container(container) {
        DialogContainerService.container = container;
    }
    get container() {
        return DialogContainerService.container;
    }
}
DialogContainerService.ɵfac = function DialogContainerService_Factory(t) { return new (t || DialogContainerService)(); };
DialogContainerService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: DialogContainerService, factory: DialogContainerService.ɵfac });
DialogContainerService.container = null;
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DialogContainerService, [{
        type: Injectable
    }], null, null); })();

// tslint:disable:max-line-length
const isNotComponent = (component) => isString(component) || component instanceof TemplateRef;
class DialogInjector {
    constructor(getDialogRef, parentInjector) {
        this.getDialogRef = getDialogRef;
        this.parentInjector = parentInjector;
    }
    get(token, notFoundValue) {
        if (token === DialogRef) {
            return this.getDialogRef();
        }
        return this.parentInjector.get(token, notFoundValue);
    }
}
/**
 * A service for opening Dialog windows dynamically
 * ([see example]({% slug service_dialog %})).
 */
class DialogService {
    constructor(
    /**
     * @hidden
     */
    resolver, containerService) {
        this.resolver = resolver;
        this.containerService = containerService;
    }
    /**
     * Opens a Dialog window. Requires an element in the application that uses the
     * [`kendoDialogContainer`]({% slug api_dialog_dialogcontainerdirective %}) directive.
     * Created Dialogs will be mounted in the DOM directly after that element.
     *
     * @param {DialogAction} options - The options that define the Dialog.
     * @returns {DialogRef} - A reference to the Dialog object and the convenience properties.
     *
     * @example
     *
     * ```ts-no-run
     * _@Component({
     *   selector: 'my-app',
     *   template: `
     *     <button kendoButton (click)="open()">Harmless button</button>
     *     <div kendoDialogContainer></div>
     *   `
     * })
     * export class AppComponent {
     *     constructor( private dialogService: DialogService ) {}
     *
     *     public open() {
     *         var dialog = this.dialogService.open({
     *           title: "Please confirm",
     *           content: "Are you sure?",
     *           actions: [
     *             { text: "No" },
     *             { text: "Yes", primary: true }
     *           ]
     *         });
     *
     *         dialog.result.subscribe((result) => {
     *           if (result instanceof DialogCloseResult) {
     *             console.log("close");
     *           } else {
     *             console.log("action", result);
     *           }
     *         });
     *     }
     * }
     * ```
     *
     */
    open(options) {
        const factory = this.resolver.resolveComponentFactory(DialogComponent);
        const container = options.appendTo || this.containerService.container;
        if (!container) {
            throw new Error(`
Cannot attach dialog to the page.
Add an element that uses the kendoDialogContainer directive, or set the 'appendTo' property.
See https://www.telerik.com/kendo-angular-ui/components/dialogs/dialog/service/.
          `);
        }
        // create DialogRef to (1) pass as result, (2) provide through injector
        const dialogRef = {
            close: () => {
                /* noop */
            },
            content: null,
            dialog: null,
            result: null
        };
        return this.initializeDialog(options.content, factory, container, dialogRef, options);
    }
    initializeDialog(component, factory, container, dialogRef, options) {
        const content = this.contentFrom(component, container, dialogRef);
        const dialog = container.createComponent(factory, undefined, undefined, content.nodes);
        dialogRef.dialog = dialog;
        dialog.changeDetectorRef.markForCheck();
        // copy @Input options to dialog instance
        this.applyOptions(dialog.instance, options);
        // create close handler and result stream
        const apiClose = new Subject();
        const close = (e) => {
            if (e instanceof PreventableEvent) {
                e = new DialogCloseResult();
            }
            apiClose.next(e || new DialogCloseResult());
            if (content.componentRef) {
                content.componentRef.destroy();
            }
            dialog.destroy();
        };
        const result = merge(apiClose, 
        // triggered when the titlebar or actions are defined in DialogSettings
        merge(dialog.instance.close, dialog.instance.action).pipe(map(e => (e instanceof PreventableEvent ? new DialogCloseResult() : e)), filter(e => {
            if (options.preventAction) {
                // add dialogRef only when using component
                const dialogRefParameter = isNotComponent(component) ? undefined : dialogRef;
                return !options.preventAction(e, dialogRefParameter);
            }
            return true;
        }))).pipe(take(1), 
        // Takes care for multiple subscriptions:
        // We subscribe internaly and the user may subscribe to get a close result - dialog.result.subscribe().
        // This causes multiple subscriptions to the same source and thus multiple emissions. share() solves that.
        share());
        result.subscribe(close);
        dialogRef.close = close;
        dialogRef.result = result;
        if (component && isDevMode()) {
            const hasContentTitle = content.nodes[0] && content.nodes[0].length > 0;
            const hasContentActions = content.nodes[2] && content.nodes[2].length > 0;
            const multipleTitles = options.title && hasContentTitle;
            const multipleActions = options.actions && hasContentActions;
            if (component.prototype instanceof DialogContentBase) {
                // content component extends DialogContentBase
                if (multipleTitles || multipleActions) {
                    console.warn(`
                    Multiple Title and/or Actions configurations detected.
                    When using a component as content, provide the title and actions either in the component's markup
                    or via the title and actions properties of the DialogSettings object, but not both.
                    See https://www.telerik.com/kendo-angular-ui/components/dialogs/dialog/service/#toc-passing-title-content-and-actions-as-a-single-component'`);
                }
            }
            else {
                if (hasContentTitle || hasContentActions) {
                    console.warn(`
                    When Title and/or Actions markup is provided in content component's template,
                    the component needs to inherit the DialogContentBase class to ensure that close and result events are properly hooked.
                    See https://www.telerik.com/kendo-angular-ui/components/dialogs/dialog/service/#toc-passing-title-content-and-actions-as-a-single-component'`);
                }
            }
        }
        return dialogRef;
    }
    applyOptions(instance, options) {
        instance.title = options.title;
        instance.actions = options.actions;
        instance.actionsLayout = options.actionsLayout || 'stretched';
        instance.width = options.width;
        instance.minWidth = options.minWidth;
        instance.maxWidth = options.maxWidth;
        instance.height = options.height;
        instance.minHeight = options.minHeight;
        instance.maxHeight = options.maxHeight;
        instance.autoFocusedElement = options.autoFocusedElement;
        instance.closeTitle = options.closeTitle;
        if (options.content instanceof TemplateRef) {
            instance.contentTemplate = options.content;
        }
    }
    contentFrom(content, container, dialogRef) {
        const renderer = container.injector.get(Renderer2);
        let nodes = [];
        let titleNodes = [];
        let actionNodes = [];
        let componentRef = null;
        if (typeof content === 'string') {
            nodes = [renderer.createText(content)];
        }
        else if (content && !(content instanceof TemplateRef)) {
            // Component
            const injector = new DialogInjector(() => dialogRef, container.injector);
            const factory = this.resolver.resolveComponentFactory(content);
            componentRef = container.createComponent(factory, undefined, injector);
            titleNodes = Array.from(componentRef.location.nativeElement.querySelectorAll('kendo-dialog-titlebar'));
            nodes = [componentRef.location.nativeElement];
            actionNodes = Array.from(componentRef.location.nativeElement.querySelectorAll('kendo-dialog-actions'));
            dialogRef.content = componentRef;
        }
        return {
            componentRef,
            nodes: [
                titleNodes,
                nodes,
                actionNodes // <ng-content select="kendo-dialog-actions">
            ]
        };
    }
}
DialogService.ɵfac = function DialogService_Factory(t) { return new (t || DialogService)(ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(DialogContainerService)); };
DialogService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: DialogService, factory: DialogService.ɵfac });
/** @nocollapse */
DialogService.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: DialogContainerService, decorators: [{ type: Inject, args: [DialogContainerService,] }] }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DialogService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: DialogContainerService, decorators: [{
                type: Inject,
                args: [DialogContainerService]
            }] }]; }, null); })();

/**
 * @hidden
 */
let newZIndex = 10002;
/**
 * @hidden
 */
const DEFAULT_OPTIONS = {
    draggable: true,
    height: null,
    left: null,
    minHeight: 100,
    minWidth: 120,
    position: 'absolute',
    resizable: true,
    state: 'default',
    top: null,
    width: null
};
/**
 * @hidden
 */
const createMoveStream = (el, ev) => mouseDown => {
    return el.kendoDrag
        .pipe(takeUntil(el.kendoRelease.pipe(tap(() => { ev.emit(); }))), map(({ pageX, pageY }) => ({
        originalX: mouseDown.pageX,
        originalY: mouseDown.pageY,
        pageX,
        pageY
    })));
};
/**
 * @hidden
 */
class DragResizeService {
    constructor(ngZone) {
        this.ngZone = ngZone;
        this.close = new EventEmitter();
        this.focus = new EventEmitter();
        this.change = new EventEmitter();
        this.stateChange = new EventEmitter();
        this.dragStart = new EventEmitter();
        this.dragEnd = new EventEmitter();
        this.resizeStart = new EventEmitter();
        this.resizeEnd = new EventEmitter();
        this.options = Object.assign({}, DEFAULT_OPTIONS);
        this.lastAction = null;
        this.subscriptions = new Subscription();
        this.dragSubscription = new Subscription();
    }
    ngOnDestroy() {
        if (this.subscriptions) {
            this.subscriptions.unsubscribe();
        }
        if (this.dragSubscription) {
            this.dragSubscription.unsubscribe();
        }
    }
    init(el) {
        const state$$1 = this.options.state;
        let options = this.options;
        this.window = el;
        if (state$$1 !== 'default') {
            this.restoreOptions = Object.assign({}, options);
        }
        if (state$$1 === 'minimized') {
            options.height = 0;
            options.minHeight = 0;
        }
        if (state$$1 === 'maximized') {
            options.position = 'fixed';
        }
    }
    onDrag(el) {
        this.subscriptions.add(this.ngZone.runOutsideAngular(() => {
            let startPosition;
            let dragStarted;
            this.dragSubscription = el.kendoPress
                .pipe(tap((ev) => {
                if (!ev.isTouch) {
                    preventDefault(ev);
                }
                this.focus.emit();
                startPosition = this.currentPosition();
                dragStarted = false;
            }), switchMap(createMoveStream(el, this.dragEnd)))
                .subscribe(({ pageX, pageY, originalX, originalY }) => {
                if (!dragStarted) {
                    this.ensureWidth();
                    this.dragStart.emit();
                    dragStarted = true;
                }
                this.handleDrag({
                    originalX, originalY,
                    pageX, pageY, startPosition
                });
            });
        }));
    }
    handleDrag({ originalX, originalY, pageX, pageY, startPosition }) {
        this.options.left = startPosition.x + pageX - originalX;
        this.options.top = startPosition.y + pageY - originalY;
        if (this.options.state === 'minimized' && isPresent(this.restoreOptions)) {
            this.restoreOptions.left = this.options.left;
            this.restoreOptions.top = this.options.top;
        }
        this.change.emit({
            left: startPosition.x + pageX - originalX,
            top: startPosition.y + pageY - originalY
        });
    }
    onResize(handle, direction) {
        this.subscriptions.add(this.ngZone.runOutsideAngular(() => {
            let startOffsetAndPosition;
            let resizeStarted = false;
            handle.kendoPress.pipe(tap((ev) => {
                preventDefault(ev);
                this.focus.emit();
                startOffsetAndPosition = this.currentOffsetAndPosition();
                resizeStarted = false;
            }), switchMap(createMoveStream(handle, this.resizeEnd)))
                .subscribe(({ pageX, pageY, originalX, originalY }) => {
                if (!resizeStarted) {
                    this.resizeStart.emit(direction);
                    resizeStarted = true;
                }
                let deltaX = pageX - originalX;
                let deltaY = pageY - originalY;
                this.handleResize(startOffsetAndPosition, direction, deltaX, deltaY);
            });
        }));
    }
    handleResize(initial, dir, deltaX, deltaY) {
        const old = this.options;
        let ev = {};
        if (dir.indexOf('e') >= 0) {
            const newWidth = initial.width + deltaX;
            if (newWidth !== old.width && newWidth >= old.minWidth) {
                ev.width = newWidth;
            }
        }
        if (dir.indexOf('n') >= 0) {
            const newHeight = initial.height - deltaY;
            const newTop = initial.y + deltaY;
            if (newHeight !== old.height && newHeight >= old.minHeight && newTop !== old.top) {
                ev.height = newHeight;
                ev.top = newTop;
            }
        }
        if (dir.indexOf('s') >= 0) {
            const newHeight = initial.height + deltaY;
            if (newHeight !== old.height && newHeight >= old.minHeight) {
                ev.height = newHeight;
            }
        }
        if (dir.indexOf('w') >= 0) {
            const newLeft = initial.x + deltaX;
            const newWidth = initial.width - deltaX;
            if (newWidth !== old.width && newWidth >= old.minWidth && newLeft !== old.left) {
                ev.width = newWidth;
                ev.left = newLeft;
            }
        }
        if (isPresent(ev.width) || isPresent(ev.height)) {
            OFFSET_STYLES.forEach((style$$1) => {
                if (isPresent(ev[style$$1])) {
                    this.options[style$$1] = ev[style$$1];
                }
            });
            this.change.emit(ev);
        }
    }
    restoreAction() {
        this.lastAction = 'restore';
        this.defaultState();
    }
    defaultState() {
        if (isPresent(this.restoreOptions)) {
            this.options = Object.assign({}, this.restoreOptions);
        }
        this.options.state = 'default';
        this.stateChange.emit('default');
    }
    storeOptions() {
        this.restoreOptions = Object.assign({}, this.options);
    }
    maximizeAction() {
        this.lastAction = 'maximize';
        this.maximizeState();
    }
    maximizeState() {
        this.storeOptions();
        const wnd = this.windowViewPort;
        this.options = Object.assign({}, this.options, {
            height: wnd.height,
            left: 0,
            position: 'fixed',
            state: 'maximized',
            top: 0,
            width: wnd.width
        });
        this.stateChange.emit('maximized');
    }
    minimizeAction() {
        this.lastAction = 'minimize';
        this.minimizeState();
    }
    minimizeState() {
        this.storeOptions();
        this.options = Object.assign({}, this.options, {
            height: null,
            minHeight: 0,
            state: 'minimized'
        });
        this.stateChange.emit('minimized');
    }
    /**
     * Handles manual changes of the 'state' property.
     * Required to distinguish them from action clicks.
     */
    applyManualState() {
        const state$$1 = this.options.state;
        switch (state$$1) {
            case 'default':
                this.clearHeight();
                this.defaultState();
                break;
            case 'maximized':
                this.clearHeight();
                this.maximizeState();
                break;
            case 'minimized':
                this.minimizeState();
                break;
            default:
                break;
        }
    }
    closeAction() {
        this.close.emit();
    }
    ensureWidth() {
        const windowOffset = offset(this.window.nativeElement);
        if (!isPresent(this.options.width)) {
            this.options.width = windowOffset.width;
            this.change.emit({ width: windowOffset.width });
        }
    }
    clearHeight() {
        if (this.options.height === 0) {
            delete this.options.height;
        }
        if (this.options.minHeight === 0) {
            delete this.options.minHeight;
        }
    }
    center() {
        if (this.options.state === 'maximized') {
            return;
        }
        let scroll = scrollPosition(this.window.nativeElement);
        let wnd = this.windowViewPort;
        let wrapper = offset(this.window.nativeElement);
        let ev = {};
        if (!isPresent(this.options.left)) {
            this.options.left = scroll.x + Math.max(0, (wnd.width - wrapper.width) / 2);
            ev.left = this.options.left;
        }
        if (!isPresent(this.options.top)) {
            this.options.top = scroll.y + Math.max(0, (wnd.height - wrapper.height) / 2);
            ev.top = this.options.top;
        }
        this.change.emit(ev);
    }
    currentOffsetAndPosition() {
        const o = this.options;
        const off = offset(this.window.nativeElement);
        return Object.assign({}, this.currentPosition(), {
            height: o.height ? o.height : off.height,
            width: o.width ? o.width : off.width
        });
    }
    currentPosition() {
        const o = this.options;
        if (!o.top || !o.left) {
            this.setPosition();
        }
        return {
            x: this.options.left,
            y: this.options.top
        };
    }
    setPosition() {
        const wrapper = positionWithScroll(this.window.nativeElement, getDocumentElement(this.window.nativeElement));
        this.options.left = wrapper.left;
        this.options.top = wrapper.top;
    }
    setRestoreOption(style$$1, value) {
        if (isPresent(this.restoreOptions)) {
            this.restoreOptions[style$$1] = value;
        }
    }
    get nextPossibleZIndex() {
        return newZIndex;
    }
    get nextZIndex() {
        return newZIndex++;
    }
    get windowViewPort() {
        return getWindowViewPort(this.window.nativeElement);
    }
}
DragResizeService.ɵfac = function DragResizeService_Factory(t) { return new (t || DragResizeService)(ɵngcc0.ɵɵinject(ɵngcc0.NgZone)); };
DragResizeService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: DragResizeService, factory: DragResizeService.ɵfac });
/** @nocollapse */
DragResizeService.ctorParameters = () => [
    { type: NgZone }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DragResizeService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.NgZone }]; }, null); })();

/**
 * @hidden
 */
class ResizeHandleDirective {
    constructor(draggable, el, renderer, service) {
        this.draggable = draggable;
        this.el = el;
        this.renderer = renderer;
        this.service = service;
        this.subscriptions = new Subscription();
    }
    get hostClass() {
        return true;
    }
    ngOnInit() {
        this.setDisplay();
        this.renderer.addClass(this.el.nativeElement, 'k-resize-' + this.direction);
        this.subscriptions.add(of(this.draggable).subscribe(handle => {
            this.service.onResize(handle, this.direction);
        }));
        this.subscriptions.add(this.service.resizeStart.subscribe((dir) => {
            if (dir !== this.direction) {
                this.setDisplay('none');
            }
        }));
        this.subscriptions.add(this.service.dragStart.subscribe(() => {
            this.setDisplay('none');
        }));
        this.subscriptions.add(merge(this.service.resizeEnd, this.service.dragEnd).subscribe(() => {
            this.setDisplay('block');
        }));
        this.subscriptions.add(this.service.stateChange.subscribe((state$$1) => {
            this.setDisplay(state$$1 === 'default' ? 'block' : 'none');
        }));
    }
    ngOnDestroy() {
        this.subscriptions.unsubscribe();
    }
    setDisplay(value = 'block') {
        this.renderer.setStyle(this.el.nativeElement, 'display', this.service.options.state === 'default' ? value : 'none');
    }
}
ResizeHandleDirective.ɵfac = function ResizeHandleDirective_Factory(t) { return new (t || ResizeHandleDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc3.DraggableDirective, 1), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService)); };
ResizeHandleDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: ResizeHandleDirective, selectors: [["", "kendoWindowResizeHandle", ""]], hostVars: 2, hostBindings: function ResizeHandleDirective_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-resize-handle", ctx.hostClass);
    } }, inputs: { direction: "direction" } });
/** @nocollapse */
ResizeHandleDirective.ctorParameters = () => [
    { type: DraggableDirective, decorators: [{ type: Host }] },
    { type: ElementRef },
    { type: Renderer2 },
    { type: DragResizeService }
];
ResizeHandleDirective.propDecorators = {
    direction: [{ type: Input }],
    hostClass: [{ type: HostBinding, args: ['class.k-resize-handle',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ResizeHandleDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoWindowResizeHandle]'
            }]
    }], function () { return [{ type: ɵngcc3.DraggableDirective, decorators: [{
                type: Host
            }] }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService }]; }, { hostClass: [{
            type: HostBinding,
            args: ['class.k-resize-handle']
        }], direction: [{
            type: Input
        }] }); })();

class WindowTitleBarComponent {
    constructor(el, service, ngZone) {
        this.el = el;
        this.ngZone = ngZone;
        this.service = service;
    }
    ngOnInit() {
        this.dragDirective = new DraggableDirective(this.el, this.ngZone);
        this.dragDirective.ngOnInit();
        if (this.isDraggable) {
            this.subscribeDrag();
        }
        this.subscribeStateChange();
    }
    ngOnDestroy() {
        this.dragDirective.ngOnDestroy();
        this.unsubscribeDrag();
        this.unsubscribeState();
    }
    /**
     * @hidden
     */
    subscribeDrag() {
        this.unsubscribeDrag();
        this.dragSubscription = of(this.dragDirective).subscribe(titleBar => {
            this.service.onDrag(titleBar);
        });
    }
    /**
     * @hidden
     */
    subscribeStateChange() {
        this.stateSubscription = this.service.stateChange.subscribe((state$$1) => {
            if (this.service.options.draggable) {
                if (state$$1 === 'maximized') {
                    this.unsubscribeDrag();
                }
                else {
                    this.subscribeDrag();
                }
            }
        });
    }
    /**
     * @hidden
     */
    unsubscribeDrag() {
        if (this.dragSubscription) {
            this.service.dragSubscription.unsubscribe();
            this.dragSubscription.unsubscribe();
            this.dragSubscription = null;
        }
    }
    /**
     * @hidden
     */
    unsubscribeState() {
        if (this.stateSubscription) {
            this.stateSubscription.unsubscribe();
            this.stateSubscription = null;
        }
    }
    get className() {
        return true;
    }
    get touchAction() {
        if (this.isDraggable) {
            return 'none';
        }
    }
    /**
     * @hidden
     */
    handle(ev) {
        const target = ev.target;
        const state$$1 = this.service.options.state;
        if (!hasClasses(target, 'k-icon') && !isFocusable(target, false) && this.service.options.resizable) {
            if (state$$1 === 'default') {
                this.service.maximizeAction();
            }
            else if (state$$1 === 'maximized') {
                this.service.restoreAction();
            }
        }
    }
    get isDraggable() {
        const options = this.service.options;
        return options.draggable && options.state !== 'maximized';
    }
}
WindowTitleBarComponent.ɵfac = function WindowTitleBarComponent_Factory(t) { return new (t || WindowTitleBarComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(DragResizeService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowTitleBarComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: WindowTitleBarComponent, selectors: [["kendo-window-titlebar"]], hostVars: 6, hostBindings: function WindowTitleBarComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("dblclick", function WindowTitleBarComponent_dblclick_HostBindingHandler($event) { return ctx.handle($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵstyleProp("touch-action", ctx.touchAction);
        ɵngcc0.ɵɵclassProp("k-window-titlebar", ctx.className)("k-dialog-titlebar", ctx.className);
    } }, inputs: { template: "template" }, ngContentSelectors: _c0, decls: 2, vars: 2, consts: [[4, "ngIf"], [3, "ngTemplateOutlet", "ngTemplateOutletContext"]], template: function WindowTitleBarComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵtemplate(0, WindowTitleBarComponent_0_Template, 1, 0, undefined, 0);
        ɵngcc0.ɵɵtemplate(1, WindowTitleBarComponent_1_Template, 1, 4, undefined, 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx.template);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.template);
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgTemplateOutlet], encapsulation: 2 });
/** @nocollapse */
WindowTitleBarComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: DragResizeService },
    { type: NgZone }
];
WindowTitleBarComponent.propDecorators = {
    template: [{ type: Input }],
    className: [{ type: HostBinding, args: ['class.k-window-titlebar',] }, { type: HostBinding, args: ['class.k-dialog-titlebar',] }],
    touchAction: [{ type: HostBinding, args: ['style.touch-action',] }],
    handle: [{ type: HostListener, args: ['dblclick', ['$event'],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowTitleBarComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-window-titlebar',
                template: `
    <ng-content *ngIf="!template"></ng-content>
    <ng-template
      [ngTemplateOutlet]="template"
      [ngTemplateOutletContext]="{'$implicit': service}" *ngIf="template">
    </ng-template>
  `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: DragResizeService }, { type: ɵngcc0.NgZone }]; }, { className: [{
            type: HostBinding,
            args: ['class.k-window-titlebar']
        }, {
            type: HostBinding,
            args: ['class.k-dialog-titlebar']
        }], touchAction: [{
            type: HostBinding,
            args: ['style.touch-action']
        }], handle: [{
            type: HostListener,
            args: ['dblclick', ['$event']]
        }], template: [{
            type: Input
        }] }); })();

/**
 * @hidden
 */
class NavigationService {
    constructor(window) {
        this.window = window;
    }
    process(ev) {
        const key = ev.keyCode;
        switch (key) {
            case Keys.up:
            case Keys.down:
            case Keys.left:
            case Keys.right: {
                ev.preventDefault();
                this.handleArrow(key, ev);
                break;
            }
            case Keys.esc:
                this.handleEscape();
                break;
            default:
                break;
        }
    }
    handleArrow(key, ev) {
        const options = this.window.options;
        if (ev.altKey) {
            this.handleStateChange(key, options.state);
            return;
        }
        if ((ev.ctrlKey || ev.metaKey) && options.state === 'default') {
            this.handleResize(key);
        }
        else {
            this.handleDrag(key);
        }
    }
    handleEscape() {
        this.window.closeAction();
    }
    handleDrag(key) {
        let options = this.window.options;
        if (!options.draggable) {
            return;
        }
        const offset$$1 = this.window.currentOffsetAndPosition();
        let restoreOptions = this.window.restoreOptions;
        let ev = {};
        let delta = 10;
        if (key === Keys.left || key === Keys.up) {
            delta *= -1;
        }
        switch (key) {
            case Keys.left:
            case Keys.right: {
                ev.left = offset$$1.x + delta;
                options.left = ev.left;
                break;
            }
            case Keys.up:
            case Keys.down: {
                ev.top = offset$$1.y + delta;
                options.top = ev.top;
                break;
            }
            default:
                break;
        }
        if (options.state === 'minimized' && isPresent(restoreOptions)) {
            restoreOptions.left = options.left;
            restoreOptions.top = options.top;
        }
        this.window.change.emit(ev);
    }
    handleResize(key) {
        const options = this.window.options;
        if (!options.resizable) {
            return;
        }
        const offset$$1 = this.window.currentOffsetAndPosition();
        let newWidth;
        let newHeight;
        let ev = {};
        let delta = 10;
        if (key === Keys.left || key === Keys.up) {
            delta *= -1;
        }
        switch (key) {
            case Keys.left:
            case Keys.right: {
                newWidth = offset$$1.width + delta;
                if (newWidth !== options.width && newWidth >= options.minWidth) {
                    ev.width = newWidth;
                }
                break;
            }
            case Keys.up:
            case Keys.down: {
                newHeight = offset$$1.height + delta;
                if (newHeight !== options.height && newHeight >= options.minHeight) {
                    ev.height = newHeight;
                }
                break;
            }
            default:
                break;
        }
        if (isPresent(ev.width) || isPresent(ev.height)) {
            OFFSET_STYLES.forEach((style$$1) => {
                if (isPresent(ev[style$$1])) {
                    this.window.options[style$$1] = ev[style$$1];
                }
            });
            this.window.change.emit(ev);
        }
    }
    handleStateChange(key, state$$1) {
        if ((state$$1 === 'minimized' && key === Keys.up) ||
            (state$$1 === 'maximized' && key === Keys.down)) {
            this.window.restoreAction();
            return;
        }
        if (state$$1 === 'default') {
            if (key === Keys.up) {
                this.window.maximizeAction();
            }
            else if (key === Keys.down) {
                this.window.minimizeAction();
            }
        }
    }
}
NavigationService.ɵfac = function NavigationService_Factory(t) { return new (t || NavigationService)(ɵngcc0.ɵɵinject(DragResizeService)); };
NavigationService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NavigationService, factory: NavigationService.ɵfac });
/** @nocollapse */
NavigationService.ctorParameters = () => [
    { type: DragResizeService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NavigationService, [{
        type: Injectable
    }], function () { return [{ type: DragResizeService }]; }, null); })();

/**
 * Represents the [Kendo UI Window component for Angular]({% slug overview_window_dialogs %}).
 */
class WindowComponent {
    constructor(el, renderer, service, navigation, ngZone, localization) {
        this.el = el;
        this.renderer = renderer;
        this.service = service;
        this.navigation = navigation;
        this.ngZone = ngZone;
        this.localization = localization;
        /**
         * Specifies if the content of the component is persisted in the DOM when minimized.
         * @default false
         */
        this.keepContent = false;
        /**
         * Fires when the user starts to move the Window.
         */
        this.dragStart = new EventEmitter();
        /**
         * Fires when the Window was moved by the user.
         */
        this.dragEnd = new EventEmitter();
        /**
         * Fires when the user starts to resize the Window.
         */
        this.resizeStart = new EventEmitter();
        /**
         * Fires when the Window was resized by the user.
         */
        this.resizeEnd = new EventEmitter();
        /**
         * Fires when the user closes the Window.
         */
        this.close = new EventEmitter();
        /**
         * Fires when the `width` property of the component was updated. The event is triggered only after the resizing
         * has ended. The event data contains the new width. Allows a two-way binding of the `width` property.
         */
        this.widthChange = new EventEmitter();
        /**
         * Fires when the `height` property of the component was updated. The event is triggered only after the resizing
         * has ended. The event data contains the new height. Allows a two-way binding of the `height` property.
         */
        this.heightChange = new EventEmitter();
        /**
         * Fires when the `top` property of the component was updated. The event is triggered only after the dragging
         * and resizing have ended. The event data contains the new top offset. Allows a two-way binding of the `top` property.
         */
        this.topChange = new EventEmitter();
        /**
         * Fires when the `left` property of the component was updated. The event is triggered only after the dragging
         * and resizing have ended. The event data contains the new left offset. Allows a two-way binding of the `left` property.
         */
        this.leftChange = new EventEmitter();
        /**
         * Fires when the `state` property of the component was updated. The event data contains the new state. Allows a
         * two-way binding of the `state` property.
         */
        this.stateChange = new EventEmitter();
        this.tabIndex = 0;
        this.draged = false;
        this.resized = false;
        this.windowSubscription = new Subscription();
        this.direction = this.localization.rtl ? 'rtl' : 'ltr';
        this.localizationChangeSubscription = this.localization.changes
            .subscribe(({ rtl }) => this.direction = rtl ? 'rtl' : 'ltr');
        this.resizeDirections = RESIZE_DIRECTIONS;
        this.subscribeEvents();
    }
    /**
     * Specifies whether the user will be able to drag the component.
     * @default true
     */
    set draggable(value) {
        this.options.draggable = value;
    }
    get draggable() {
        return this.options.draggable;
    }
    /**
     * Specifies whether the user will be able to resize the component.
     * @default true
     */
    set resizable(value) {
        this.options.resizable = value;
    }
    get resizable() {
        return this.options.resizable;
    }
    /**
     * Specifies the initial state of the component.
     * If not specified, the value is set to `default`.
     *
     * The possible values are:
     * * `minimized`
     * * `maximized`
     * * `default`
     */
    set state(value) {
        this.options.state = value;
    }
    get state() {
        return this.options.state;
    }
    /**
     * Specifies the minimum width of the component.
     * The `minWidth` property has to be set in pixels.
     * @default 120
     */
    set minWidth(value) {
        this.setOption('minWidth', value);
    }
    get minWidth() {
        return this.options.minWidth;
    }
    /**
     * Specifies the minimum height of the Window.
     * The `minHeight` property has to be set in pixels.
     * @default 100
     */
    set minHeight(value) {
        this.setOption('minHeight', value);
    }
    get minHeight() {
        return this.options.minHeight;
    }
    /**
     * Specifies the width of the Window.
     * The `width` property has to be set in pixels.
     */
    set width(value) {
        this.setOption('width', value);
    }
    get width() {
        return this.options.width;
    }
    /**
     * Specifies the height of the Window.
     * The `height` property has to be set in pixels.
     */
    set height(value) {
        this.setOption('height', value);
    }
    get height() {
        return this.options.height;
    }
    /**
     * Specifies the initial top offset of the Window.
     * The `top` property has to be set in pixels.
     */
    set top(value) {
        this.setOption('top', value);
    }
    get top() {
        return this.options.top;
    }
    /**
     * Specifies the initial left offset of the Window.
     * Numeric values are treated as pixels.
     */
    set left(value) {
        this.setOption('left', value);
    }
    get left() {
        return this.options.left;
    }
    get closeButtonTitle() {
        if (this.messages && this.messages.closeTitle) {
            return this.messages.closeTitle;
        }
        return this.localization.get('closeTitle');
    }
    get restoreButtonTitle() {
        if (this.messages && this.messages.restoreTitle) {
            return this.messages.restoreTitle;
        }
        return this.localization.get('restoreTitle');
    }
    get maximizeButtonTitle() {
        if (this.messages && this.messages.maximizeTitle) {
            return this.messages.maximizeTitle;
        }
        return this.localization.get('maximizeTitle');
    }
    get minimizeButtonTitle() {
        if (this.messages && this.messages.minimizeTitle) {
            return this.messages.minimizeTitle;
        }
        return this.localization.get('minimizeTitle');
    }
    get hostClasses() {
        return true;
    }
    get dir() {
        return this.direction;
    }
    ngAfterViewInit() {
        this.setNextZIndex();
        this.handleInitialFocus();
        this.ngZone.runOutsideAngular(() => Promise.resolve(null).then(() => this.setInitialOffset()));
    }
    ngOnInit() {
        this.renderer.removeAttribute(this.el.nativeElement, 'title');
        this.service.init(this.el);
    }
    ngOnChanges(changes) {
        OFFSET_STYLES.forEach((style$$1) => {
            if (isChanged(style$$1, changes)) {
                this.setStyle(style$$1, this.options[style$$1]);
            }
        });
        if (isChanged('draggable', changes)) {
            const titleBar = isPresent(this.titleBarContent) ? this.titleBarContent : this.titleBarView;
            if (isTruthy(changes.draggable.currentValue)) {
                titleBar.subscribeDrag();
            }
            else {
                titleBar.unsubscribeDrag();
            }
        }
        if (isChanged('state', changes)) {
            if (isPresent(this.service.lastAction)) {
                this.service.lastAction = null;
            }
            else {
                this.service.applyManualState();
                this.updateAllOffset();
            }
        }
    }
    ngOnDestroy() {
        if (this.windowSubscription) {
            this.windowSubscription.unsubscribe();
        }
        this.localizationChangeSubscription.unsubscribe();
    }
    /**
     * Focuses the wrapper of the Window component.
     */
    focus() {
        const wrapper = this.el.nativeElement;
        if (isPresent(wrapper)) {
            wrapper.focus();
        }
    }
    /**
     * Brings the current Window component on top of other Window components on the page.
     */
    bringToFront() {
        this.setNextZIndex();
    }
    /**
     * Manually updates the `width` or `height` option of the Window.
     * The required style will be applied to the Window wrapper element and the
     * corresponding property of the component instance will be updated.
     * This method is intended to be used for sizing dynamically created components using the
     * [`WindowService`]({% slug api_dialog_windowservice %})
     * @param {WindowDimensionSetting} dimension - The option that will be updated
     * @param {number} value - The value set in pixels
     */
    setDimension(dimension, value) {
        this.setOption(dimension, value);
        this.setStyle(dimension, value);
    }
    /**
     * Manually updates the `top` or `left` offset of the Window.
     * The required style will be applied to the Window wrapper element and the
     * corresponding property of the component instance will be updated.
     * This method is intended to be used for positioning dynamically created components using the
     * [`WindowService`]({% slug api_dialog_windowservice %})
     * @param {WindowOffsetSetting} offset - The option that will be updated
     * @param {number} value - The value set in pixels
     */
    setOffset(offset$$1, value) {
        this.setOption(offset$$1, value);
        this.setStyle(offset$$1, value);
    }
    get showDefaultTitleBar() {
        return !isPresent(this.titleBarContent);
    }
    get styleMinWidth() {
        return this.minWidth + 'px';
    }
    get styleMinHeight() {
        return this.minHeight + 'px';
    }
    get stylePosition() {
        return this.options.position;
    }
    get wrapperMaximizedClass() {
        return this.state === 'maximized';
    }
    get wrapperMinimizedClass() {
        return this.state === 'minimized';
    }
    /**
     * @hidden
     */
    onComponentKeydown(event) {
        if (hasClasses(event.target, WINDOW_CLASSES)) {
            this.navigation.process(event);
        }
    }
    /**
     * @hidden
     */
    onComponentFocus() {
        this.renderer.addClass(this.el.nativeElement, 'k-state-focused');
        this.setNextZIndex();
    }
    /**
     * @hidden
     */
    onComponentBlur() {
        this.renderer.removeClass(this.el.nativeElement, 'k-state-focused');
    }
    subscribeEvents() {
        if (!isDocumentAvailable()) {
            return;
        }
        this.windowSubscription.add(this.service.focus.subscribe(() => {
            this.el.nativeElement.focus();
        }));
        this.windowSubscription.add(this.service.dragStart.subscribe(() => {
            this.draged = true;
            this.ngZone.run(() => {
                this.dragStart.emit();
            });
        }));
        this.windowSubscription.add(this.service.dragEnd.subscribe(() => {
            if (this.draged) {
                this.draged = false;
                this.ngZone.run(() => {
                    this.dragEnd.emit();
                });
            }
        }));
        this.windowSubscription.add(this.service.close.subscribe(() => {
            this.close.emit();
        }));
        this.windowSubscription.add(this.service.resizeStart.subscribe(() => {
            this.resized = true;
            this.ngZone.run(() => {
                this.resizeStart.emit();
            });
        }));
        this.windowSubscription.add(this.service.resizeEnd.subscribe(() => {
            if (this.resized) {
                this.resized = false;
                this.ngZone.run(() => {
                    this.resizeEnd.emit();
                });
            }
        }));
        this.windowSubscription.add(this.service.change.subscribe((ev) => {
            OFFSET_STYLES.forEach((style$$1) => {
                if (isPresent(ev[style$$1])) {
                    this.setStyle(style$$1, ev[style$$1]);
                    if (this.state !== 'maximized') {
                        const emitter = this[style$$1 + 'Change'];
                        if (emitter.observers.length) {
                            this.ngZone.run(() => {
                                emitter.emit(ev[style$$1]);
                            });
                        }
                    }
                }
            });
        }));
        this.windowSubscription.add(this.service.stateChange.subscribe((state$$1) => {
            if (isPresent(this.service.lastAction)) {
                this.updateAllOffset();
                this.stateChange.emit(state$$1);
            }
        }));
    }
    setNextZIndex() {
        const currentZIndex = this.el.nativeElement.style['z-index'];
        const nextPossibleZIndex = this.service.nextPossibleZIndex;
        if (!currentZIndex || (nextPossibleZIndex - currentZIndex > 1)) {
            this.renderer.setStyle(this.el.nativeElement, "z-index", this.service.nextZIndex);
        }
    }
    setInitialOffset() {
        if (this.state !== 'maximized') {
            this.updateAllOffset();
            if (!isPresent(this.left) || !isPresent(this.top)) {
                this.service.center();
            }
        }
        else {
            const viewPort = this.service.windowViewPort;
            this.setStyle('width', viewPort.width);
            this.setStyle('height', viewPort.height);
            this.setStyle('top', 0);
            this.setStyle('left', 0);
        }
    }
    updateAllOffset() {
        OFFSET_STYLES.forEach((style$$1) => {
            if (isPresent(this[style$$1])) {
                this.setStyle(style$$1, this[style$$1]);
            }
            else {
                this.removeStyle(style$$1);
            }
        });
    }
    setStyle(style$$1, value) {
        this.renderer.setStyle(this.el.nativeElement, style$$1, value + 'px');
    }
    removeStyle(style$$1) {
        this.renderer.removeStyle(this.el.nativeElement, style$$1);
    }
    get options() {
        return this.service.options;
    }
    setOption(style$$1, value) {
        if (typeof value !== 'number' && typeof value !== 'string') {
            return;
        }
        const parsedValue = (typeof value === 'number') ? value : parseInt(value, 10);
        this.options[style$$1] = parsedValue;
        this.service.setRestoreOption(style$$1, parsedValue);
    }
    handleInitialFocus() {
        const wrapper = this.el.nativeElement;
        if (this.autoFocusedElement) {
            const initiallyFocusedElement = wrapper.querySelector(this.autoFocusedElement);
            if (initiallyFocusedElement) {
                initiallyFocusedElement.focus();
            }
        }
        else {
            this.focus();
        }
    }
}
WindowComponent.ɵfac = function WindowComponent_Factory(t) { return new (t || WindowComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService), ɵngcc0.ɵɵdirectiveInject(NavigationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
WindowComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: WindowComponent, selectors: [["kendo-window"]], contentQueries: function WindowComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, WindowTitleBarComponent, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titleBarContent = _t.first);
    } }, viewQuery: function WindowComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(WindowTitleBarComponent, true);
        ɵngcc0.ɵɵviewQuery(ResizeHandleDirective, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.titleBarView = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.resizeHandles = _t);
    } }, hostVars: 16, hostBindings: function WindowComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown", function WindowComponent_keydown_HostBindingHandler($event) { return ctx.onComponentKeydown($event); })("focus", function WindowComponent_focus_HostBindingHandler() { return ctx.onComponentFocus(); })("blur", function WindowComponent_blur_HostBindingHandler() { return ctx.onComponentBlur(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("tabIndex", ctx.tabIndex)("dir", ctx.dir);
        ɵngcc0.ɵɵstyleProp("min-width", ctx.styleMinWidth)("min-height", ctx.styleMinHeight)("position", ctx.stylePosition);
        ɵngcc0.ɵɵclassProp("k-widget", ctx.hostClasses)("k-window", ctx.hostClasses)("k-window-maximized", ctx.wrapperMaximizedClass)("k-window-minimized", ctx.wrapperMinimizedClass);
    } }, inputs: { keepContent: "keepContent", draggable: "draggable", resizable: "resizable", state: "state", minWidth: "minWidth", minHeight: "minHeight", width: "width", height: "height", top: "top", left: "left", autoFocusedElement: "autoFocusedElement", title: "title" }, outputs: { dragStart: "dragStart", dragEnd: "dragEnd", resizeStart: "resizeStart", resizeEnd: "resizeEnd", close: "close", widthChange: "widthChange", heightChange: "heightChange", topChange: "topChange", leftChange: "leftChange", stateChange: "stateChange" }, exportAs: ["kendoWindow"], features: [ɵngcc0.ɵɵProvidersFeature([
            DragResizeService,
            NavigationService,
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.window'
            }
        ]), ɵngcc0.ɵɵNgOnChangesFeature], ngContentSelectors: _c17, decls: 7, vars: 4, consts: [["kendoWindowLocalizedMessages", "", 6, "closeTitle", "restoreTitle", "maximizeTitle", "minimizeTitle"], [3, "template", 4, "ngIf"], [4, "ngIf"], ["class", "k-content k-window-content", 3, "hidden", 4, "ngIf"], [3, "ngIf"], [3, "template"], [1, "k-window-title"], [1, "k-window-actions"], ["kendoWindowMinimizeAction", ""], ["kendoWindowMaximizeAction", ""], ["kendoWindowRestoreAction", ""], ["kendoWindowCloseAction", ""], [1, "k-content", "k-window-content", 3, "hidden"], [3, "ngTemplateOutlet"], ["kendoWindowResizeHandle", "", "kendoDraggable", "", 3, "direction", 4, "ngFor", "ngForOf"], ["kendoWindowResizeHandle", "", "kendoDraggable", "", 3, "direction"]], template: function WindowComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c16);
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵi18nAttributes(1, _c15);
        ɵngcc0.ɵɵelementContainerStart(2);
        ɵngcc0.ɵɵtemplate(3, WindowComponent_kendo_window_titlebar_3_Template, 8, 10, "kendo-window-titlebar", 1);
        ɵngcc0.ɵɵtemplate(4, WindowComponent_4_Template, 1, 0, undefined, 2);
        ɵngcc0.ɵɵtemplate(5, WindowComponent_div_5_Template, 3, 3, "div", 3);
        ɵngcc0.ɵɵtemplate(6, WindowComponent_ng_template_6_Template, 1, 1, "ng-template", 4);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵelementContainerEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showDefaultTitleBar);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.showDefaultTitleBar);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.state !== "minimized" || ctx.keepContent);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.resizable);
    } }, directives: function () { return [LocalizedMessagesDirective, ɵngcc1.NgIf, WindowTitleBarComponent,
        WindowMinimizeActionDirective,
        WindowMaximizeActionDirective,
        WindowRestoreActionDirective,
        WindowCloseActionDirective, ɵngcc1.NgTemplateOutlet, ɵngcc1.NgForOf, ResizeHandleDirective, ɵngcc3.DraggableDirective]; }, encapsulation: 2 });
/** @nocollapse */
WindowComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: DragResizeService },
    { type: NavigationService },
    { type: NgZone },
    { type: LocalizationService }
];
WindowComponent.propDecorators = {
    autoFocusedElement: [{ type: Input }],
    title: [{ type: Input }],
    draggable: [{ type: Input }],
    resizable: [{ type: Input }],
    keepContent: [{ type: Input }],
    state: [{ type: Input }],
    minWidth: [{ type: Input }],
    minHeight: [{ type: Input }],
    width: [{ type: Input }],
    height: [{ type: Input }],
    top: [{ type: Input }],
    left: [{ type: Input }],
    dragStart: [{ type: Output }],
    dragEnd: [{ type: Output }],
    resizeStart: [{ type: Output }],
    resizeEnd: [{ type: Output }],
    close: [{ type: Output }],
    widthChange: [{ type: Output }],
    heightChange: [{ type: Output }],
    topChange: [{ type: Output }],
    leftChange: [{ type: Output }],
    stateChange: [{ type: Output }],
    tabIndex: [{ type: HostBinding, args: ['attr.tabIndex',] }],
    hostClasses: [{ type: HostBinding, args: ['class.k-widget',] }, { type: HostBinding, args: ['class.k-window',] }],
    dir: [{ type: HostBinding, args: ['attr.dir',] }],
    titleBarView: [{ type: ViewChild, args: [WindowTitleBarComponent,] }],
    titleBarContent: [{ type: ContentChild, args: [WindowTitleBarComponent,] }],
    resizeHandles: [{ type: ViewChildren, args: [ResizeHandleDirective,] }],
    styleMinWidth: [{ type: HostBinding, args: ['style.minWidth',] }],
    styleMinHeight: [{ type: HostBinding, args: ['style.minHeight',] }],
    stylePosition: [{ type: HostBinding, args: ['style.position',] }],
    wrapperMaximizedClass: [{ type: HostBinding, args: ['class.k-window-maximized',] }],
    wrapperMinimizedClass: [{ type: HostBinding, args: ['class.k-window-minimized',] }],
    onComponentKeydown: [{ type: HostListener, args: ['keydown', ['$event'],] }],
    onComponentFocus: [{ type: HostListener, args: ['focus',] }],
    onComponentBlur: [{ type: HostListener, args: ['blur',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowComponent, [{
        type: Component,
        args: [{
                exportAs: 'kendoWindow',
                providers: [
                    DragResizeService,
                    NavigationService,
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.window'
                    }
                ],
                selector: 'kendo-window',
                template: `
        <ng-container kendoWindowLocalizedMessages
            i18n-closeTitle="kendo.window.closeTitle|The title of the close button"
            closeTitle="Close"

            i18n-restoreTitle="kendo.window.restoreTitle|The title of the restore button"
            restoreTitle="Restore"

            i18n-maximizeTitle="kendo.window.maximizeTitle|The title of the maximize button"
            maximizeTitle="Maximize"

            i18n-minimizeTitle="kendo.window.minimizeTitle|The title of the minimize button"
            minimizeTitle="Minimize"
        >
        <ng-container>

        <kendo-window-titlebar *ngIf="showDefaultTitleBar" [template]="titleBarTemplate">
            <div class="k-window-title">{{ title }}</div>
            <div class="k-window-actions">
                <button kendoWindowMinimizeAction  [attr.title]="minimizeButtonTitle" [attr.aria-label]="minimizeButtonTitle"></button>
                <button kendoWindowMaximizeAction [attr.title]="maximizeButtonTitle" [attr.aria-label]="maximizeButtonTitle"></button>
                <button kendoWindowRestoreAction [attr.title]="restoreButtonTitle" [attr.aria-label]="restoreButtonTitle"></button>
                <button kendoWindowCloseAction [attr.title]="closeButtonTitle" [attr.aria-label]="closeButtonTitle"></button>
            </div>
        </kendo-window-titlebar>
        <ng-content select="kendo-window-titlebar" *ngIf="!showDefaultTitleBar"></ng-content>

        <div *ngIf="state !== 'minimized' || keepContent"
            [hidden]="state === 'minimized' && keepContent"
            class="k-content k-window-content"
        >
            <ng-content *ngIf="!contentTemplate"></ng-content>
            <ng-template [ngTemplateOutlet]="contentTemplate" *ngIf="contentTemplate"></ng-template>
        </div>

        <ng-template [ngIf]='resizable'>
            <div *ngFor='let dir of resizeDirections'
                [direction]="dir"
                kendoWindowResizeHandle
                kendoDraggable>
            </div>
        </ng-template>
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService }, { type: NavigationService }, { type: ɵngcc0.NgZone }, { type: ɵngcc2.LocalizationService }]; }, { keepContent: [{
            type: Input
        }], dragStart: [{
            type: Output
        }], dragEnd: [{
            type: Output
        }], resizeStart: [{
            type: Output
        }], resizeEnd: [{
            type: Output
        }], close: [{
            type: Output
        }], widthChange: [{
            type: Output
        }], heightChange: [{
            type: Output
        }], topChange: [{
            type: Output
        }], leftChange: [{
            type: Output
        }], stateChange: [{
            type: Output
        }], tabIndex: [{
            type: HostBinding,
            args: ['attr.tabIndex']
        }], draggable: [{
            type: Input
        }], resizable: [{
            type: Input
        }], state: [{
            type: Input
        }], minWidth: [{
            type: Input
        }], minHeight: [{
            type: Input
        }], width: [{
            type: Input
        }], height: [{
            type: Input
        }], top: [{
            type: Input
        }], left: [{
            type: Input
        }], hostClasses: [{
            type: HostBinding,
            args: ['class.k-widget']
        }, {
            type: HostBinding,
            args: ['class.k-window']
        }], dir: [{
            type: HostBinding,
            args: ['attr.dir']
        }], styleMinWidth: [{
            type: HostBinding,
            args: ['style.minWidth']
        }], styleMinHeight: [{
            type: HostBinding,
            args: ['style.minHeight']
        }], stylePosition: [{
            type: HostBinding,
            args: ['style.position']
        }], wrapperMaximizedClass: [{
            type: HostBinding,
            args: ['class.k-window-maximized']
        }], wrapperMinimizedClass: [{
            type: HostBinding,
            args: ['class.k-window-minimized']
        }], onComponentKeydown: [{
            type: HostListener,
            args: ['keydown', ['$event']]
        }], onComponentFocus: [{
            type: HostListener,
            args: ['focus']
        }], onComponentBlur: [{
            type: HostListener,
            args: ['blur']
        }], autoFocusedElement: [{
            type: Input
        }], title: [{
            type: Input
        }], titleBarView: [{
            type: ViewChild,
            args: [WindowTitleBarComponent]
        }], titleBarContent: [{
            type: ContentChild,
            args: [WindowTitleBarComponent]
        }], resizeHandles: [{
            type: ViewChildren,
            args: [ResizeHandleDirective]
        }] }); })();

class WindowMaximizeActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.look = 'bare';
        this.icon = 'window-maximize';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.maximizeAction();
        }
    }
    get visible() {
        return this.window.options.state === 'default' ? 'inline-flex' : 'none';
    }
}
WindowMaximizeActionDirective.ɵfac = function WindowMaximizeActionDirective_Factory(t) { return new (t || WindowMaximizeActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowMaximizeActionDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: WindowMaximizeActionDirective, selectors: [["button", "kendoWindowMaximizeAction", ""]], hostVars: 3, hostBindings: function WindowMaximizeActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowMaximizeActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
        ɵngcc0.ɵɵstyleProp("display", ctx.visible);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowMaximizeAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
/** @nocollapse */
WindowMaximizeActionDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: DragResizeService, decorators: [{ type: Optional }] },
    { type: LocalizationService },
    { type: NgZone }
];
WindowMaximizeActionDirective.propDecorators = {
    window: [{ type: Input }],
    buttonType: [{ type: HostBinding, args: ['attr.type',] }],
    onClick: [{ type: HostListener, args: ['click',] }],
    visible: [{ type: HostBinding, args: ['style.display',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowMaximizeActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowMaximizeAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowMaximizeAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], onClick: [{
            type: HostListener,
            args: ['click']
        }], visible: [{
            type: HostBinding,
            args: ['style.display']
        }] }); })();

class WindowMinimizeActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.look = 'bare';
        this.icon = 'window-minimize';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.minimizeAction();
        }
    }
    get visible() {
        return this.window.options.state === 'default' ? 'inline-flex' : 'none';
    }
}
WindowMinimizeActionDirective.ɵfac = function WindowMinimizeActionDirective_Factory(t) { return new (t || WindowMinimizeActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowMinimizeActionDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: WindowMinimizeActionDirective, selectors: [["button", "kendoWindowMinimizeAction", ""]], hostVars: 3, hostBindings: function WindowMinimizeActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowMinimizeActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
        ɵngcc0.ɵɵstyleProp("display", ctx.visible);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowMinimizeAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
/** @nocollapse */
WindowMinimizeActionDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: DragResizeService, decorators: [{ type: Optional }] },
    { type: LocalizationService },
    { type: NgZone }
];
WindowMinimizeActionDirective.propDecorators = {
    window: [{ type: Input }],
    buttonType: [{ type: HostBinding, args: ['attr.type',] }],
    onClick: [{ type: HostListener, args: ['click',] }],
    visible: [{ type: HostBinding, args: ['style.display',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowMinimizeActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowMinimizeAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowMinimizeAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], onClick: [{
            type: HostListener,
            args: ['click']
        }], visible: [{
            type: HostBinding,
            args: ['style.display']
        }] }); })();

class WindowCloseActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.look = 'bare';
        this.icon = 'close';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.closeAction();
        }
    }
}
WindowCloseActionDirective.ɵfac = function WindowCloseActionDirective_Factory(t) { return new (t || WindowCloseActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowCloseActionDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: WindowCloseActionDirective, selectors: [["button", "kendoWindowCloseAction", ""]], hostVars: 1, hostBindings: function WindowCloseActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowCloseActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowCloseAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
/** @nocollapse */
WindowCloseActionDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: DragResizeService, decorators: [{ type: Optional }] },
    { type: LocalizationService },
    { type: NgZone }
];
WindowCloseActionDirective.propDecorators = {
    window: [{ type: Input }],
    buttonType: [{ type: HostBinding, args: ['attr.type',] }],
    onClick: [{ type: HostListener, args: ['click',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowCloseActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowCloseAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowCloseAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], onClick: [{
            type: HostListener,
            args: ['click']
        }] }); })();

class WindowRestoreActionDirective extends Button {
    constructor(el, renderer, _service, localization, ngZone) {
        super(el, renderer, null, localization, ngZone);
        this.buttonType = 'button';
        this.window = _service;
        this.look = 'bare';
        this.icon = 'window-restore';
    }
    /**
     * @hidden
     */
    onClick() {
        if (!this.isDisabled) {
            this.window.restoreAction();
        }
    }
    get visible() {
        return this.window.options.state === 'default' ? 'none' : 'inline-flex';
    }
}
WindowRestoreActionDirective.ɵfac = function WindowRestoreActionDirective_Factory(t) { return new (t || WindowRestoreActionDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(DragResizeService, 8), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone)); };
WindowRestoreActionDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: WindowRestoreActionDirective, selectors: [["button", "kendoWindowRestoreAction", ""]], hostVars: 3, hostBindings: function WindowRestoreActionDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function WindowRestoreActionDirective_click_HostBindingHandler() { return ctx.onClick(); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.buttonType);
        ɵngcc0.ɵɵstyleProp("display", ctx.visible);
    } }, inputs: { window: "window" }, exportAs: ["kendoWindowRestoreAction"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.button'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
/** @nocollapse */
WindowRestoreActionDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: DragResizeService, decorators: [{ type: Optional }] },
    { type: LocalizationService },
    { type: NgZone }
];
WindowRestoreActionDirective.propDecorators = {
    window: [{ type: Input }],
    buttonType: [{ type: HostBinding, args: ['attr.type',] }],
    onClick: [{ type: HostListener, args: ['click',] }],
    visible: [{ type: HostBinding, args: ['style.display',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowRestoreActionDirective, [{
        type: Directive,
        args: [{
                exportAs: 'kendoWindowRestoreAction',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.button'
                    }
                ],
                selector: 'button[kendoWindowRestoreAction]' // tslint:disable-line
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: DragResizeService, decorators: [{
                type: Optional
            }] }, { type: ɵngcc2.LocalizationService }, { type: ɵngcc0.NgZone }]; }, { buttonType: [{
            type: HostBinding,
            args: ['attr.type']
        }], window: [{
            type: Input
        }], onClick: [{
            type: HostListener,
            args: ['click']
        }], visible: [{
            type: HostBinding,
            args: ['style.display']
        }] }); })();

/**
 * The settings for the Window actions when the Window is opened through `WindowService`
 * ([see example]({% slug api_dialog_windowservice %}#toc-open)).
 */
class WindowSettings {
}
/**
 * Indicates that the **Close** button of a Window that is opened through `WindowService` is clicked.
 */
class WindowCloseResult {
}
/**
 * Holds references to the object instance of the Window.
 * Controls the Windows that were opened through `WindowService`
 * ([see example]({% slug api_dialog_windowservice %}#toc-open)).
 */
class WindowRef {
}

/**
 * @hidden
 */
class WindowContainerService {
    set container(container) {
        WindowContainerService.container = container;
    }
    get container() {
        return WindowContainerService.container;
    }
}
WindowContainerService.ɵfac = function WindowContainerService_Factory(t) { return new (t || WindowContainerService)(); };
WindowContainerService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: WindowContainerService, factory: WindowContainerService.ɵfac });
WindowContainerService.container = null;
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowContainerService, [{
        type: Injectable
    }], null, null); })();

class WindowInjector {
    constructor(getWindowRef, parentInjector) {
        this.getWindowRef = getWindowRef;
        this.parentInjector = parentInjector;
    }
    get(token, notFoundValue) {
        if (token === WindowRef) {
            return this.getWindowRef();
        }
        return this.parentInjector.get(token, notFoundValue);
    }
}
/**
 * A service for opening Windows dynamically
 * ([see example]({% slug service_window %})).
 */
class WindowService {
    constructor(
    /**
     * @hidden
     */
    resolver, containerService) {
        this.resolver = resolver;
        this.containerService = containerService;
    }
    /**
     * Opens a Window component.
     *
     * @param {WindowSettings} settings - The settings that define the Window.
     * @returns {WindowRef} - A reference to the Window object.
     *
     * @example
     *
     * ```ts-no-run
     * _@Component({
     *   selector: 'my-app',
     *   template: `
     *     <button kendoButton (click)="open()">Open window</button>
     *     <div kendoWindowContainer></div>
     *   `
     * })
     * export class AppComponent {
     *     constructor( private windowService: WindowService ) {}
     *
     *     public open() {
     *         var window = this.windowService.open({
     *           title: "My window",
     *           content: "My content!"
     *         });
     *
     *         window.result.subscribe((result) => {
     *           if (result instanceof WindowCloseResult) {
     *             console.log("Window was closed");
     *           }
     *         });
     *     }
     * }
     * ```
     *
     */
    open(settings) {
        const factory = this.resolver.resolveComponentFactory(WindowComponent);
        const container = settings.appendTo || this.containerService.container;
        if (!container) {
            throw new Error(`Cannot attach window to the page.
                Add an element that uses the kendoWindowContainer directive, or set the 'appendTo' property.
                See https://www.telerik.com/kendo-angular-ui/components/dialogs/window/service/
            `);
        }
        const windowRef = {
            close: () => { },
            content: null,
            result: null,
            window: null
        };
        const content = this.contentFrom(settings.content, container, windowRef);
        const window = container.createComponent(factory, undefined, undefined, content.nodes);
        windowRef.window = window;
        this.applyOptions(window.instance, settings);
        const apiClose = new Subject();
        const close = (e) => {
            apiClose.next(e || new WindowCloseResult());
            if (content.componentRef) {
                content.componentRef.destroy();
            }
            window.destroy();
        };
        const result = merge(apiClose, window.instance.close).pipe(take(1));
        result.subscribe(close);
        windowRef.close = close;
        windowRef.result = result;
        window.changeDetectorRef.markForCheck();
        return windowRef;
    }
    applyOptions(instance, options) {
        if (isPresent(options.title)) {
            instance.title = options.title;
        }
        if (isPresent(options.keepContent)) {
            instance.keepContent = options.keepContent;
        }
        if (isPresent(options.width)) {
            instance.width = options.width;
        }
        if (isPresent(options.minWidth)) {
            instance.minWidth = options.minWidth;
        }
        if (isPresent(options.height)) {
            instance.height = options.height;
        }
        if (isPresent(options.minHeight)) {
            instance.minHeight = options.minHeight;
        }
        if (isPresent(options.left)) {
            instance.left = options.left;
        }
        if (isPresent(options.top)) {
            instance.top = options.top;
        }
        if (isPresent(options.draggable)) {
            instance.draggable = options.draggable;
        }
        if (isPresent(options.resizable)) {
            instance.resizable = options.resizable;
        }
        if (isPresent(options.messages && options.messages.closeTitle)) {
            instance.messages.closeTitle = options.messages.closeTitle;
        }
        if (isPresent(options.messages && options.messages.restoreTitle)) {
            instance.messages.restoreTitle = options.messages.restoreTitle;
        }
        if (isPresent(options.messages && options.messages.maximizeTitle)) {
            instance.messages.maximizeTitle = options.messages.maximizeTitle;
        }
        if (isPresent(options.messages && options.messages.minimizeTitle)) {
            instance.messages.minimizeTitle = options.messages.minimizeTitle;
        }
        if (isPresent(options.autoFocusedElement)) {
            instance.autoFocusedElement = options.autoFocusedElement;
        }
        if (isPresent(options.state)) {
            instance.state = options.state;
            if (options.state === 'minimized') {
                instance.keepContent = true;
            }
        }
        if (options.content instanceof TemplateRef) {
            instance.contentTemplate = options.content;
        }
        if (options.titleBarContent instanceof TemplateRef) {
            instance.titleBarTemplate = options.titleBarContent;
        }
    }
    contentFrom(content, container, windowRef) {
        const renderer = container.injector.get(Renderer2);
        let nodes = [];
        let componentRef = null;
        if (typeof content === 'string') {
            nodes = [renderer.createText(content)];
        }
        else if (content && !(content instanceof TemplateRef)) {
            const injector = new WindowInjector(() => windowRef, container.injector);
            const factory = this.resolver.resolveComponentFactory(content);
            componentRef = container.createComponent(factory, undefined, injector);
            nodes = [componentRef.location.nativeElement];
            windowRef.content = componentRef;
        }
        return {
            componentRef,
            nodes: [
                [],
                nodes // Content
            ]
        };
    }
}
WindowService.ɵfac = function WindowService_Factory(t) { return new (t || WindowService)(ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(WindowContainerService)); };
WindowService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: WindowService, factory: WindowService.ɵfac });
/** @nocollapse */
WindowService.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: WindowContainerService, decorators: [{ type: Inject, args: [WindowContainerService,] }] }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: WindowContainerService, decorators: [{
                type: Inject,
                args: [WindowContainerService]
            }] }]; }, null); })();

/**
 * Provides an insertion point for the Dialogs which are created through the
 * Dialog service ([see example]({% slug api_dialog_dialogservice %}#toc-open)).
 * Created Dialogs will be mounted after that element.
 *
 * @example
 * ```html-no-run
 * <div kendoDialogContainer></div>
 * ```
 */
class DialogContainerDirective {
    constructor(container, service) {
        service.container = container;
    }
}
DialogContainerDirective.ɵfac = function DialogContainerDirective_Factory(t) { return new (t || DialogContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(DialogContainerService)); };
DialogContainerDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DialogContainerDirective, selectors: [["", "kendoDialogContainer", ""]] });
/** @nocollapse */
DialogContainerDirective.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: DialogContainerService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DialogContainerDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoDialogContainer]'
            }]
    }], function () { return [{ type: ɵngcc0.ViewContainerRef }, { type: DialogContainerService }]; }, null); })();

/**
 * @hidden
 */
class Messages extends ComponentMessages {
}
Messages.ɵfac = function Messages_Factory(t) { return ɵMessages_BaseFactory(t || Messages); };
Messages.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: Messages, inputs: { closeTitle: "closeTitle", restoreTitle: "restoreTitle", maximizeTitle: "maximizeTitle", minimizeTitle: "minimizeTitle" }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
Messages.propDecorators = {
    closeTitle: [{ type: Input }],
    restoreTitle: [{ type: Input }],
    maximizeTitle: [{ type: Input }],
    minimizeTitle: [{ type: Input }]
};
const ɵMessages_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(Messages);

/**
 * @hidden
 */
class LocalizedMessagesDirective extends Messages {
    constructor(service) {
        super();
        this.service = service;
    }
}
LocalizedMessagesDirective.ɵfac = function LocalizedMessagesDirective_Factory(t) { return new (t || LocalizedMessagesDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
LocalizedMessagesDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LocalizedMessagesDirective, selectors: [["", "kendoDialogLocalizedMessages", ""], ["", "kendoWindowLocalizedMessages", ""]], features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: Messages,
                useExisting: forwardRef(() => LocalizedMessagesDirective)
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
/** @nocollapse */
LocalizedMessagesDirective.ctorParameters = () => [
    { type: LocalizationService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LocalizedMessagesDirective, [{
        type: Directive,
        args: [{
                providers: [
                    {
                        provide: Messages,
                        useExisting: forwardRef(() => LocalizedMessagesDirective)
                    }
                ],
                selector: `
    [kendoDialogLocalizedMessages],
    [kendoWindowLocalizedMessages]
  `
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }]; }, null); })();

/**
 * Custom component messages override default component messages
 * ([see example]({% slug globalization_dialogs %}#toc-localization)).
 */
class CustomMessagesComponent extends Messages {
    constructor(service) {
        super();
        this.service = service;
    }
    get override() {
        return true;
    }
}
CustomMessagesComponent.ɵfac = function CustomMessagesComponent_Factory(t) { return new (t || CustomMessagesComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
CustomMessagesComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: CustomMessagesComponent, selectors: [["kendo-dialog-messages"], ["kendo-window-messages"]], features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: Messages,
                useExisting: forwardRef(() => CustomMessagesComponent) // tslint:disable-line:no-forward-ref
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature], decls: 0, vars: 0, template: function CustomMessagesComponent_Template(rf, ctx) { }, encapsulation: 2 });
/** @nocollapse */
CustomMessagesComponent.ctorParameters = () => [
    { type: LocalizationService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(CustomMessagesComponent, [{
        type: Component,
        args: [{
                providers: [
                    {
                        provide: Messages,
                        useExisting: forwardRef(() => CustomMessagesComponent) // tslint:disable-line:no-forward-ref
                    }
                ],
                selector: 'kendo-dialog-messages, kendo-window-messages',
                template: ``
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }]; }, null); })();

/**
 * @hidden
 */
const SHARED_DIRECTIVES = [
    DialogActionsComponent,
    CustomMessagesComponent,
    LocalizedMessagesDirective
];
/**
 * @hidden
 */
class SharedModule {
}
SharedModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: SharedModule });
SharedModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function SharedModule_Factory(t) { return new (t || SharedModule)(); }, imports: [[CommonModule],
        CommonModule] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(SharedModule, { declarations: function () { return [DialogActionsComponent,
        CustomMessagesComponent,
        LocalizedMessagesDirective]; }, imports: function () { return [CommonModule]; }, exports: function () { return [DialogActionsComponent,
        CustomMessagesComponent,
        LocalizedMessagesDirective,
        CommonModule]; } }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(SharedModule, [{
        type: NgModule,
        args: [{
                declarations: [SHARED_DIRECTIVES],
                exports: [SHARED_DIRECTIVES, CommonModule],
                imports: [CommonModule]
            }]
    }], null, null); })();

/**
 * @hidden
 */
const DIALOG_DIRECTIVES = [
    DialogComponent,
    DialogTitleBarComponent
];
/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Dialog component that includes all Dialog components and directives.
 * Imports `DialogModule` into the [root module]({{ site.data.urls.angular['ngmodules'] }}#angular-modularity)
 * of your application or into any other sub-module that will use the Dialog component.
 *
 * @example
 * ```ts-no-run
 * import { NgModule } from '@angular/core';
 * import { BrowserModule } from '@angular/platform-browser';
 * import { DialogModule } from '@progress/kendo-angular-dialog';
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     bootstrap:    [AppComponent],
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, DialogModule]
 * })
 * export class AppModule {
 * }
 * ```
 */
class DialogModule {
}
DialogModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: DialogModule });
DialogModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function DialogModule_Factory(t) { return new (t || DialogModule)(); }, providers: [DialogContainerService, DialogService], imports: [[SharedModule]] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(DialogModule, { declarations: [DialogComponent,
        DialogTitleBarComponent,
        DialogContainerDirective], imports: [SharedModule], exports: [DialogComponent,
        DialogTitleBarComponent,
        DialogActionsComponent,
        CustomMessagesComponent,
        LocalizedMessagesDirective,
        DialogContainerDirective] }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DialogModule, [{
        type: NgModule,
        args: [{
                declarations: [DIALOG_DIRECTIVES, DialogContainerDirective],
                entryComponents: [DIALOG_DIRECTIVES],
                exports: [DIALOG_DIRECTIVES, SHARED_DIRECTIVES, DialogContainerDirective],
                imports: [SharedModule],
                providers: [DialogContainerService, DialogService]
            }]
    }], null, null); })();

/**
 * Provides an insertion point for the Windows which are created through the
 * Window service ([see example]({% slug api_dialog_windowservice %}#toc-open)).
 * Created Windows will be mounted after that element.
 *
 * @example
 * ```html-no-run
 * <div kendoWindowContainer></div>
 * ```
 */
class WindowContainerDirective {
    constructor(container, service) {
        service.container = container;
    }
}
WindowContainerDirective.ɵfac = function WindowContainerDirective_Factory(t) { return new (t || WindowContainerDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(WindowContainerService)); };
WindowContainerDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: WindowContainerDirective, selectors: [["", "kendoWindowContainer", ""]] });
/** @nocollapse */
WindowContainerDirective.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: WindowContainerService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowContainerDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoWindowContainer]'
            }]
    }], function () { return [{ type: ɵngcc0.ViewContainerRef }, { type: WindowContainerService }]; }, null); })();

const WINDOW_DIRECTIVES = [
    ResizeHandleDirective,
    WindowComponent,
    WindowTitleBarComponent,
    WindowCloseActionDirective,
    WindowMinimizeActionDirective,
    WindowMaximizeActionDirective,
    WindowRestoreActionDirective
];
const ENTRY_COMPONENTS = [
    WindowComponent,
    WindowTitleBarComponent
];
const exportedModules = [
    WindowComponent,
    WindowCloseActionDirective,
    WindowMinimizeActionDirective,
    WindowMaximizeActionDirective,
    WindowRestoreActionDirective,
    WindowTitleBarComponent
];
/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Window component. Imports `WindowModule` into the
 * [root module]({{ site.data.urls.angular['ngmodules'] }}#angular-modularity)
 * of your application or into any other sub-module that will use the Window component.
 *
 * @example
 * ```ts-no-run
 * import { NgModule } from '@angular/core';
 * import { BrowserModule } from '@angular/platform-browser';
 * import { WindowModule } from '@progress/kendo-angular-window';
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     bootstrap:    [AppComponent],
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, WindowModule]
 * })
 * export class AppModule {
 * }
 * ```
 */
class WindowModule {
}
WindowModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: WindowModule });
WindowModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function WindowModule_Factory(t) { return new (t || WindowModule)(); }, providers: [WindowContainerService, WindowService], imports: [[SharedModule, DraggableModule]] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(WindowModule, { declarations: function () { return [ResizeHandleDirective,
        WindowComponent,
        WindowTitleBarComponent,
        WindowCloseActionDirective,
        WindowMinimizeActionDirective,
        WindowMaximizeActionDirective,
        WindowRestoreActionDirective,
        WindowContainerDirective]; }, imports: function () { return [SharedModule,
        DraggableModule]; }, exports: function () { return [WindowComponent,
        WindowCloseActionDirective,
        WindowMinimizeActionDirective,
        WindowMaximizeActionDirective,
        WindowRestoreActionDirective,
        WindowTitleBarComponent,
        DialogActionsComponent,
        CustomMessagesComponent,
        LocalizedMessagesDirective,
        WindowContainerDirective]; } }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(WindowModule, [{
        type: NgModule,
        args: [{
                declarations: [WINDOW_DIRECTIVES, WindowContainerDirective],
                entryComponents: [ENTRY_COMPONENTS],
                exports: [exportedModules, SHARED_DIRECTIVES, WindowContainerDirective],
                imports: [SharedModule, DraggableModule],
                providers: [WindowContainerService, WindowService]
            }]
    }], null, null); })();

/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Dialogs components.
 *
 * @example
 *
 * ```ts-no-run
 * import { DialogsModule } from '@progress/kendo-angular-dialog';
 *
 * import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 * import { NgModule } from '@angular/core';
 *
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, DialogsModule],
 *     bootstrap:    [AppComponent]
 * })
 * export class AppModule {}
 *
 * platformBrowserDynamic().bootstrapModule(AppModule);
 *
 * ```
 */
class DialogsModule {
}
DialogsModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: DialogsModule });
DialogsModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function DialogsModule_Factory(t) { return new (t || DialogsModule)(); }, imports: [DialogModule,
        WindowModule] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(DialogsModule, { exports: [DialogModule,
        WindowModule] }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DialogsModule, [{
        type: NgModule,
        args: [{
                exports: [DialogModule, WindowModule]
            }]
    }], null, null); })();

/**
 * Generated bundle index. Do not edit.
 */

export { DIALOG_DIRECTIVES, DialogContainerDirective, DialogContainerService, CustomMessagesComponent, DIALOG_LOCALIZATION_SERVICE, LocalizedMessagesDirective, Messages, SHARED_DIRECTIVES, SharedModule, DragResizeService, NavigationService, WindowContainerDirective, WindowContainerService, ResizeHandleDirective, DialogComponent, DialogTitleBarComponent, DialogContentBase, DialogActionsComponent, DialogService, DialogCloseResult, DialogRef, DialogSettings, DialogAction, WindowComponent, WindowTitleBarComponent, WindowMaximizeActionDirective, WindowMinimizeActionDirective, WindowCloseActionDirective, WindowRestoreActionDirective, WindowSettings, WindowRef, WindowCloseResult, WindowService, DialogModule, WindowModule, DialogsModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7aUhBb0JFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs2QkF1QkU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7ZUFpREU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7V0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O2tJQUFDO0FBQ0Q7OzswQkFHRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzt1R0FHRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztrQ0FBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzttSEFHRTtBQUNGO0FBQ0E7QUFDQTtBQUNBOzs7dUVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OzsrQ0FLRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O2lGQVlFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzttSEFHRTtBQUNGO0FBQ0E7QUFDQTtBQUNBOzs7MkVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7dUpBMERFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7OztrREFhRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7OztrREFhRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7O2tEQWFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7OztrREFhRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztrSUFBQztBQUNEOzs7MEJBR0U7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O3VHQUdFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O2tDQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OzRJQUtFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O21IQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztnUEFBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtxRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O2tEQWNFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztvRkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7eUpBWUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7OztvRkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7OzBCQU9FO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7MEJBU0U7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7NElBS0U7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7bUhBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzBCQVNFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OzBCQUtFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiogQ29weXJpZ2h0IMKpIDIwMjAgUHJvZ3Jlc3MgU29mdHdhcmUgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4qIExpY2Vuc2VkIHVuZGVyIGNvbW1lcmNpYWwgbGljZW5zZS4gU2VlIExJQ0VOU0UubWQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbW9yZSBpbmZvcm1hdGlvblxuKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBUZW1wbGF0ZVJlZiwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgT3V0cHV0LCBIb3N0QmluZGluZywgT3B0aW9uYWwsIEluamVjdGlvblRva2VuLCBSZW5kZXJlcjIsIENoYW5nZURldGVjdG9yUmVmLCBDb250ZW50Q2hpbGQsIFZpZXdDaGlsZCwgSG9zdExpc3RlbmVyLCBJbmplY3RhYmxlLCBpc0Rldk1vZGUsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgSW5qZWN0LCBOZ1pvbmUsIERpcmVjdGl2ZSwgSG9zdCwgVmlld0NoaWxkcmVuLCBWaWV3Q29udGFpbmVyUmVmLCBmb3J3YXJkUmVmLCBOZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdHJpZ2dlciwgc3RhdGUsIHN0eWxlLCB0cmFuc2l0aW9uLCBhbmltYXRlIH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBMb2NhbGl6YXRpb25TZXJ2aWNlLCBMMTBOX1BSRUZJWCwgQ29tcG9uZW50TWVzc2FnZXMgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1sMTBuJztcbmltcG9ydCB7IFN1YmplY3QsIG1lcmdlLCBTdWJzY3JpcHRpb24sIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCwgdGFrZSwgc2hhcmUsIHRhcCwgc3dpdGNoTWFwLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBEcmFnZ2FibGVEaXJlY3RpdmUsIGlzQ2hhbmdlZCwgaXNEb2N1bWVudEF2YWlsYWJsZSwgRHJhZ2dhYmxlTW9kdWxlIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItY29tbW9uJztcbmltcG9ydCB7IG9mZnNldCwgc2Nyb2xsUG9zaXRpb24sIHBvc2l0aW9uV2l0aFNjcm9sbCwgZ2V0RG9jdW1lbnRFbGVtZW50LCBnZXRXaW5kb3dWaWV3UG9ydCB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1wb3B1cC1jb21tb24nO1xuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItYnV0dG9ucyc7XG5pbXBvcnQgeyBDb21tb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG4vKipcbiAqIFNwZWNpZmllcyB0aGUgYWN0aW9uIGJ1dHRvbnMgb2YgdGhlIERpYWxvZ1xuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhY3Rpb25idXR0b25zX2RpYWxvZyAlfSkpLlxuICovXG5jbGFzcyBEaWFsb2dBY3Rpb25zQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlbCkge1xuICAgICAgICB0aGlzLmVsID0gZWw7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTcGVjaWZpZXMgdGhlIHBvc3NpYmxlIGxheW91dCBvZiB0aGUgYWN0aW9uIGJ1dHRvbnMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxheW91dCA9ICdzdHJldGNoZWQnO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBjbGlja3MgYW4gYWN0aW9uIGJ1dHRvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWN0aW9uID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmJ1dHRvbkdyb3VwQ2xhc3NOYW1lID0gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0IGNsYXNzTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGF5b3V0ID09PSAnc3RyZXRjaGVkJztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGFjdGlvblRlbXBsYXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25zIGluc3RhbmNlb2YgVGVtcGxhdGVSZWY7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkJ1dHRvbkNsaWNrKGFjdGlvbiwgX2UpIHtcbiAgICAgICAgdGhpcy5hY3Rpb24uZW1pdChhY3Rpb24pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgYnV0dG9uQ2xhc3MoYWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IGNsYXNzZXMgPSBbJ2stYnV0dG9uJ107XG4gICAgICAgIGlmIChhY3Rpb24ucHJpbWFyeSkge1xuICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKCdrLXByaW1hcnknKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2xhc3Nlcy5qb2luKCcgJyk7XG4gICAgfVxufVxuRGlhbG9nQWN0aW9uc0NvbXBvbmVudC5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogQ29tcG9uZW50LCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAna2VuZG8tZGlhbG9nLWFjdGlvbnMnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxuZy1jb250ZW50ICpuZ0lmPVwiIWFjdGlvbnNcIj48L25nLWNvbnRlbnQ+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCIhYWN0aW9uVGVtcGxhdGUoKVwiPlxuICAgICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cImJ1dHRvbkNsYXNzKGFjdGlvbilcIlxuICAgICAgICAgICAgICAgIChjbGljayk9XCJvbkJ1dHRvbkNsaWNrKGFjdGlvbiwgJGV2ZW50KVwiXG4gICAgICAgICAgICAgICAgKm5nRm9yPVwibGV0IGFjdGlvbiBvZiBhY3Rpb25zXCJcbiAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cImFjdGlvbi50ZXh0XCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7eyBhY3Rpb24udGV4dCB9fVxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICA8bmctdGVtcGxhdGUgW25nVGVtcGxhdGVPdXRsZXRdPVwiYWN0aW9uc1wiICpuZ0lmPVwiYWN0aW9uVGVtcGxhdGUoKVwiPjwvbmctdGVtcGxhdGU+XG4gICAgYFxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5EaWFsb2dBY3Rpb25zQ29tcG9uZW50LmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogRWxlbWVudFJlZiB9XG5dO1xuRGlhbG9nQWN0aW9uc0NvbXBvbmVudC5wcm9wRGVjb3JhdG9ycyA9IHtcbiAgICBhY3Rpb25zOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBsYXlvdXQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGFjdGlvbjogW3sgdHlwZTogT3V0cHV0IH1dLFxuICAgIGJ1dHRvbkdyb3VwQ2xhc3NOYW1lOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydjbGFzcy5rLWRpYWxvZy1idXR0b25ncm91cCcsXSB9XSxcbiAgICBjbGFzc05hbWU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2NsYXNzLmstZGlhbG9nLWJ1dHRvbi1sYXlvdXQtc3RyZXRjaGVkJyxdIH1dXG59O1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgUHJldmVudGFibGVFdmVudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucHJldmVudGVkID0gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFByZXZlbnRzIHRoZSBkZWZhdWx0IGFjdGlvbiBmb3IgYSBzcGVjaWZpZWQgZXZlbnQuXG4gICAgICogSW4gdGhpcyB3YXksIHRoZSBzb3VyY2UgY29tcG9uZW50IHN1cHByZXNzZXMgdGhlIGJ1aWx0LWluIGJlaGF2aW9yIHRoYXQgZm9sbG93cyB0aGUgZXZlbnQuXG4gICAgICovXG4gICAgcHJldmVudERlZmF1bHQoKSB7XG4gICAgICAgIHRoaXMucHJldmVudGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgdGhlIGV2ZW50IGlzIHByZXZlbnRlZCBieSBhbnkgb2YgaXRzIHN1YnNjcmliZXJzLCByZXR1cm5zIGB0cnVlYC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgZGVmYXVsdCBhY3Rpb24gd2FzIHByZXZlbnRlZC4gT3RoZXJ3aXNlLCByZXR1cm5zIGBmYWxzZWAuXG4gICAgICovXG4gICAgaXNEZWZhdWx0UHJldmVudGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcmV2ZW50ZWQ7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtLZW5kbyBVSSBEaWFsb2dUaXRsZUJhciBjb21wb25lbnQgZm9yIEFuZ3VsYXJdKHslIHNsdWcgYXBpX2RpYWxvZ19kaWFsb2d0aXRsZWJhcmNvbXBvbmVudCAlfSkuXG4gKlxuICogSXQgaXMgdXNlZCBhcyBwYXJ0IG9mIHRoZSBEaWFsb2cgY29udGVudCB3aGVuIHRoZSBjb21wb25lbnQgaXMgY3JlYXRlZCBkeW5hbWljYWxseSBieSB1c2luZyBhbiBbQW5ndWxhciBzZXJ2aWNlXSh7JSBzbHVnIHNlcnZpY2VfZGlhbG9nICV9KS5cbiAqL1xuY2xhc3MgRGlhbG9nVGl0bGVCYXJDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RFbGVtZW50LCBsb2NhbGl6YXRpb25TZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuaG9zdEVsZW1lbnQgPSBob3N0RWxlbWVudDtcbiAgICAgICAgdGhpcy5sb2NhbGl6YXRpb25TZXJ2aWNlID0gbG9jYWxpemF0aW9uU2VydmljZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIGNsb3NlIGJ1dHRvbiBvZiB0aGUgdGl0bGUtYmFyIGlzIGNsaWNrZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIH1cbiAgICBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0IGNsb3NlQnV0dG9uVGl0bGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsaXphdGlvblNlcnZpY2UuZ2V0KCdjbG9zZVRpdGxlJyk7XG4gICAgfVxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJywgdGhpcy5pZCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNsb3NlQ2xpY2soZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IGV2ZW50QXJncyA9IG5ldyBQcmV2ZW50YWJsZUV2ZW50KCk7XG4gICAgICAgIHRoaXMuY2xvc2UuZW1pdChldmVudEFyZ3MpO1xuICAgIH1cbn1cbkRpYWxvZ1RpdGxlQmFyQ29tcG9uZW50LmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBDb21wb25lbnQsIGFyZ3M6IFt7XG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdrZW5kby1kaWFsb2ctdGl0bGViYXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJrLXdpbmRvdy10aXRsZSBrLWRpYWxvZy10aXRsZVwiPlxuICAgICAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwiay13aW5kb3ctYWN0aW9ucyBrLWRpYWxvZy1hY3Rpb25zXCI+XG4gICAgICAgICAgICA8YVxuICAgICAgICAgICAgICAgIGhyZWY9XCIjXCJcbiAgICAgICAgICAgICAgICByb2xlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgICAgICBbYXR0ci50aXRsZV09XCJjbG9zZUJ1dHRvblRpdGxlXCJcbiAgICAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cImNsb3NlQnV0dG9uVGl0bGVcIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiay1idXR0b24gay1iYXJlIGstYnV0dG9uLWljb24gay13aW5kb3ctYWN0aW9uIGstZGlhbG9nLWFjdGlvbiBrLWRpYWxvZy1jbG9zZVwiXG4gICAgICAgICAgICAgICAgKGNsaWNrKT1cIm9uQ2xvc2VDbGljaygkZXZlbnQpXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImstaWNvbiBrLWkteFwiPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvYT5cbiAgICAgICAgPC9kaXY+XG4gICAgYFxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5EaWFsb2dUaXRsZUJhckNvbXBvbmVudC5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IEVsZW1lbnRSZWYgfSxcbiAgICB7IHR5cGU6IExvY2FsaXphdGlvblNlcnZpY2UsIGRlY29yYXRvcnM6IFt7IHR5cGU6IE9wdGlvbmFsIH1dIH1cbl07XG5EaWFsb2dUaXRsZUJhckNvbXBvbmVudC5wcm9wRGVjb3JhdG9ycyA9IHtcbiAgICBjbG9zZTogW3sgdHlwZTogT3V0cHV0IH1dLFxuICAgIGlkOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBjbG9zZVRpdGxlOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBjbGFzc05hbWU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2NsYXNzLmstd2luZG93LXRpdGxlYmFyJyxdIH0sIHsgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1kaWFsb2ctdGl0bGViYXInLF0gfV1cbn07XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc1ByZXNlbnQgPSAodmFsdWUpID0+IHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQ7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaXNUcnV0aHkgPSAodmFsdWUpID0+ICEhdmFsdWU7XG5jb25zdCB0b0NsYXNzTGlzdCA9IChjbGFzc05hbWVzKSA9PiBTdHJpbmcoY2xhc3NOYW1lcykudHJpbSgpLnNwbGl0KCcgJyk7XG5jb25zdCBmb2N1c2FibGVSZWdleCA9IC9eKD86YXxpbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdCkkL2k7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xudmFyIEtleXM7XG4oZnVuY3Rpb24gKEtleXMpIHtcbiAgICBLZXlzW0tleXNbXCJlc2NcIl0gPSAyN10gPSBcImVzY1wiO1xuICAgIEtleXNbS2V5c1tcInRhYlwiXSA9IDldID0gXCJ0YWJcIjtcbiAgICBLZXlzW0tleXNbXCJlbnRlclwiXSA9IDEzXSA9IFwiZW50ZXJcIjtcbiAgICBLZXlzW0tleXNbXCJzcGFjZVwiXSA9IDMyXSA9IFwic3BhY2VcIjtcbiAgICBLZXlzW0tleXNbXCJjdHJsXCJdID0gMTddID0gXCJjdHJsXCI7XG4gICAgS2V5c1tLZXlzW1wic2hpZnRcIl0gPSAxNl0gPSBcInNoaWZ0XCI7XG4gICAgS2V5c1tLZXlzW1wibGVmdFwiXSA9IDM3XSA9IFwibGVmdFwiO1xuICAgIEtleXNbS2V5c1tcInVwXCJdID0gMzhdID0gXCJ1cFwiO1xuICAgIEtleXNbS2V5c1tcInJpZ2h0XCJdID0gMzldID0gXCJyaWdodFwiO1xuICAgIEtleXNbS2V5c1tcImRvd25cIl0gPSA0MF0gPSBcImRvd25cIjtcbn0pKEtleXMgfHwgKEtleXMgPSB7fSkpO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IERJQUxPR19FTEVNRU5UU19IQU5ETElOR19FU0NfS0VZID0gJ2stZGlhbG9nLXdyYXBwZXIgay1kaWFsb2ctYnV0dG9uZ3JvdXAgay1kaWFsb2ctYWN0aW9uJztcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBESUFMT0dfRUxFTUVOVFNfSEFORExJTkdfQVJST1dTID0gJ2stZGlhbG9nLWJ1dHRvbmdyb3VwJztcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBXSU5ET1dfQ0xBU1NFUyA9ICdrLXdpbmRvdyc7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgaGFzQ2xhc3NlcyA9IChlbGVtZW50LCBjbGFzc05hbWVzKSA9PiB7XG4gICAgY29uc3QgbmFtZXNMaXN0ID0gdG9DbGFzc0xpc3QoY2xhc3NOYW1lcyk7XG4gICAgcmV0dXJuIEJvb2xlYW4odG9DbGFzc0xpc3QoZWxlbWVudC5jbGFzc05hbWUpLmZpbmQoKGNsYXNzTmFtZSkgPT4gbmFtZXNMaXN0LmluZGV4T2YoY2xhc3NOYW1lKSA+PSAwKSk7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGlzVmlzaWJsZSA9IChlbGVtZW50KSA9PiB7XG4gICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgcmV0dXJuICEhKHJlY3Qud2lkdGggJiYgcmVjdC5oZWlnaHQpICYmIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpLnZpc2liaWxpdHkgIT09ICdoaWRkZW4nO1xufTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc0ZvY3VzYWJsZSA9IChlbGVtZW50LCBjaGVja1Zpc2liaWxpdHkgPSB0cnVlKSA9PiB7XG4gICAgaWYgKGVsZW1lbnQudGFnTmFtZSkge1xuICAgICAgICBjb25zdCB0YWdOYW1lID0gZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHRhYkluZGV4ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RhYkluZGV4Jyk7XG4gICAgICAgIGNvbnN0IHZhbGlkVGFiSW5kZXggPSB0YWJJbmRleCAhPT0gbnVsbCAmJiAhaXNOYU4odGFiSW5kZXgpICYmIHRhYkluZGV4ID4gLTE7XG4gICAgICAgIGxldCBmb2N1c2FibGUgPSBmYWxzZTtcbiAgICAgICAgaWYgKGZvY3VzYWJsZVJlZ2V4LnRlc3QodGFnTmFtZSkpIHtcbiAgICAgICAgICAgIGZvY3VzYWJsZSA9ICFlbGVtZW50LmRpc2FibGVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9jdXNhYmxlID0gdmFsaWRUYWJJbmRleDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZm9jdXNhYmxlICYmICghY2hlY2tWaXNpYmlsaXR5IHx8IGlzVmlzaWJsZShlbGVtZW50KSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgZm9jdXNhYmxlU2VsZWN0b3IgPSBbXG4gICAgJ2FbaHJlZl0nLFxuICAgICdhcmVhW2hyZWZdJyxcbiAgICAnaW5wdXQ6bm90KFtkaXNhYmxlZF0pJyxcbiAgICAnc2VsZWN0Om5vdChbZGlzYWJsZWRdKScsXG4gICAgJ3RleHRhcmVhOm5vdChbZGlzYWJsZWRdKScsXG4gICAgJ2J1dHRvbjpub3QoW2Rpc2FibGVkXSknLFxuICAgICdpZnJhbWUnLFxuICAgICdvYmplY3QnLFxuICAgICdlbWJlZCcsXG4gICAgJypbdGFiaW5kZXhdJyxcbiAgICAnKltjb250ZW50ZWRpdGFibGVdJ1xuXS5qb2luKCcsJyk7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgcHJldmVudERlZmF1bHQgPSAoeyBvcmlnaW5hbEV2ZW50OiBldmVudCB9KSA9PiB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgUkVTSVpFX0RJUkVDVElPTlMgPSBbJ24nLCAnZScsICdzJywgJ3cnLCAnc2UnLCAnc3cnLCAnbmUnLCAnbncnXTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBPRkZTRVRfU1RZTEVTID0gWyd0b3AnLCAnbGVmdCcsICd3aWR0aCcsICdoZWlnaHQnXTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc1N0cmluZyA9ICh2YWx1ZSkgPT4gdmFsdWUgaW5zdGFuY2VvZiBTdHJpbmcgfHwgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc051bWJlciA9ICh2YWx1ZSkgPT4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiBpc0Zpbml0ZSh2YWx1ZSk7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgY3JlYXRlVmFsdWVXaXRoVW5pdCA9ICh2YWx1ZSkgPT4gdmFsdWUgKyAoaXNOdW1iZXIodmFsdWUpID8gJ3B4JyA6ICcnKTtcblxuLyoqXG4gKiBUaGUgc2V0dGluZ3MgZm9yIHRoZSBEaWFsb2cgYWN0aW9ucyB3aGVuIHRoZSBEaWFsb2cgaXMgb3BlbmVkIHRocm91Z2ggYERpYWxvZ1NlcnZpY2VgXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfZGlhbG9nc2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICovXG5jbGFzcyBEaWFsb2dBY3Rpb24ge1xufVxuLyoqXG4gKiBJbmRpY2F0ZXMgdGhhdCB0aGUgKipDbG9zZSoqIGJ1dHRvbiBpcyBjbGlja2VkLiBVc2VkIHdoZW4gdGhlIHJlc3VsdHMgZnJvbVxuICogdGhlIERpYWxvZ3MgdGhhdCBhcmUgb3BlbmVkIHRocm91Z2ggYERpYWxvZ1NlcnZpY2VgIGFyZSBmaWx0ZXJlZFxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhcGlfZGlhbG9nX2RpYWxvZ3NlcnZpY2UgJX0jdG9jLW9wZW4pKS5cbiAqL1xuY2xhc3MgRGlhbG9nQ2xvc2VSZXN1bHQge1xufVxuLyoqXG4gKiBUaGUgc2V0dGluZ3MgdGhhdCBjYW4gYmUgdXNlZCB3aGVuIHRoZSBEaWFsb2cgaXMgb3BlbmVkIHRocm91Z2ggYERpYWxvZ1NlcnZpY2VgLlxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhcGlfZGlhbG9nX2RpYWxvZ3NlcnZpY2UgJX0jdG9jLW9wZW4pKS5cbiAqL1xuY2xhc3MgRGlhbG9nU2V0dGluZ3Mge1xufVxuLyoqXG4gKiBIb2xkcyByZWZlcmVuY2VzIHRvIHRoZSBvYmplY3QgaW5zdGFuY2UgYW5kIHB1Ymxpc2hlZCBldmVudHMgb2YgdGhlIERpYWxvZy5cbiAqIENvbnRyb2xzIHRoZSBEaWFsb2dzIHRoYXQgd2VyZSBvcGVuZWQgdGhyb3VnaCB0aGUgYERpYWxvZ1NlcnZpY2VgXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfZGlhbG9nc2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICovXG5jbGFzcyBEaWFsb2dSZWYge1xufVxuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgRElBTE9HX0xPQ0FMSVpBVElPTl9TRVJWSUNFID0gbmV3IEluamVjdGlvblRva2VuKCdEaWFsb2cgTG9jYWxpemF0aW9uU2VydmljZScpO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtLZW5kbyBVSSBEaWFsb2cgY29tcG9uZW50IGZvciBBbmd1bGFyXSh7JSBzbHVnIG92ZXJ2aWV3X2RpYWxvZ19kaWFsb2dzICV9KS5cbiAqL1xuY2xhc3MgRGlhbG9nQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3RvcihfZWxSZWYsIF9yZW5kZXJlciwgbG9jYWxpemF0aW9uLCBjZHIpIHtcbiAgICAgICAgdGhpcy5fZWxSZWYgPSBfZWxSZWY7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyID0gX3JlbmRlcmVyO1xuICAgICAgICB0aGlzLmNkciA9IGNkcjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyB0aGUgbGF5b3V0IG9mIHRoZSBhY3Rpb24gYnV0dG9ucyBpbiB0aGUgRGlhbG9nLlxuICAgICAgICAgKiBUaGlzIG9wdGlvbiBpcyBvbmx5IGFwcGxpY2FibGUgaWYgdGhlIGFjdGlvbiBidXR0b25zIGFyZSBzcGVjaWZpZWQgdGhyb3VnaCB0aGUgYGFjdGlvbnNgIG9wdGlvbnMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBkZWZhdWx0ICdzdHJldGNoZWQnXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFjdGlvbnNMYXlvdXQgPSAnc3RyZXRjaGVkJztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBoaWRkZW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudGl0bGVJZCA9IG51bGw7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1c2VyIGNsaWNrcyBhbiBhY3Rpb24gYnV0dG9uIG9mIHRoZSBEaWFsb2cuXG4gICAgICAgICAqIFRoZSBldmVudCBpcyBmaXJlZCBvbmx5IHdoZW4gdGhlIGFjdGlvbiBidXR0b25zIGFyZSBzcGVjaWZpZWQgdGhyb3VnaCB0aGUgYGFjdGlvbnNgIG9wdGlvbnMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFjdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIHVzZXIgY2xpY2tzIHRoZSAqKkNsb3NlKiogYnV0dG9uIG9mIHRoZSBEaWFsb2cuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnRhYkluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gbG9jYWxpemF0aW9uLnJ0bCA/ICdydGwnIDogJ2x0cic7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKGxvY2FsaXphdGlvbi5jaGFuZ2VzLnN1YnNjcmliZSgoeyBydGwgfSkgPT4gKHRoaXMuZGlyZWN0aW9uID0gcnRsID8gJ3J0bCcgOiAnbHRyJykpKTtcbiAgICAgICAgdGhpcy50aXRsZUlkID0gdGhpcy5nZW5lcmF0ZVRpdGxlSWQoKTtcbiAgICB9XG4gICAgZ2V0IGRpcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25Db21wb25lbnRLZXlkb3duKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgY29uc3QgcGFyZW50ID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIGlmIChoYXNDbGFzc2VzKHRhcmdldCwgRElBTE9HX0VMRU1FTlRTX0hBTkRMSU5HX0VTQ19LRVkpIHx8IGhhc0NsYXNzZXMocGFyZW50LCBESUFMT0dfRUxFTUVOVFNfSEFORExJTkdfRVNDX0tFWSkpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSBLZXlzLmVzYykge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UuZW1pdChuZXcgRGlhbG9nQ2xvc2VSZXN1bHQoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc0NsYXNzZXModGFyZ2V0LCAnay1idXR0b24nKSAmJlxuICAgICAgICAgICAgaGFzQ2xhc3NlcyhwYXJlbnQsIERJQUxPR19FTEVNRU5UU19IQU5ETElOR19BUlJPV1MpICYmXG4gICAgICAgICAgICAoZXZlbnQua2V5Q29kZSA9PT0gS2V5cy5sZWZ0IHx8IGV2ZW50LmtleUNvZGUgPT09IEtleXMucmlnaHQpKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUFjdGlvbkJ1dHRvbkZvY3VzKHBhcmVudCwgZXZlbnQua2V5Q29kZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IEtleXMudGFiKSB7XG4gICAgICAgICAgICB0aGlzLmtlZXBGb2N1c1dpdGhpbkNvbXBvbmVudCh0YXJnZXQsIGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgICAgIHRoaXMuYnViYmxlKCdjbG9zZScsIHRoaXMudGl0bGViYXJDb250ZW50KTtcbiAgICAgICAgaWYgKHRoaXMudGl0bGViYXJDb250ZW50KSB7XG4gICAgICAgICAgICB0aGlzLnRpdGxlYmFyQ29udGVudC5pZCA9IHRoaXMudGl0bGVJZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlSW5pdGlhbEZvY3VzKCk7XG4gICAgICAgIHRoaXMuYnViYmxlKCdjbG9zZScsIHRoaXMudGl0bGViYXJWaWV3KTtcbiAgICAgICAgdGhpcy5idWJibGUoJ2FjdGlvbicsIHRoaXMuYWN0aW9uc1ZpZXcpO1xuICAgICAgICBpZiAodGhpcy50aXRsZWJhclZpZXcgfHwgdGhpcy50aXRsZWJhckNvbnRlbnQpIHtcbiAgICAgICAgICAgIC8vTmVlZGVkIGZvciBEaWFsb2dzIGNyZWF0ZWQgdmlhIHNlcnZpY2VcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLl9lbFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5rLWRpYWxvZycpLCAnYXJpYS1sYWJlbGxlZGJ5JywgdGhpcy50aXRsZUlkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKHRoaXMuX2VsUmVmLm5hdGl2ZUVsZW1lbnQsICd0aXRsZScpO1xuICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaChzID0+IHMudW5zdWJzY3JpYmUoKSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGb2N1c2VzIHRoZSB3cmFwcGVyIG9mIHRoZSBEaWFsb2cgY29tcG9uZW50LlxuICAgICAqL1xuICAgIGZvY3VzKCkge1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gdGhpcy5fZWxSZWYubmF0aXZlRWxlbWVudDtcbiAgICAgICAgaWYgKGlzUHJlc2VudCh3cmFwcGVyKSkge1xuICAgICAgICAgICAgd3JhcHBlci5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBoYW5kbGVJbml0aWFsRm9jdXMoKSB7XG4gICAgICAgIGNvbnN0IHdyYXBwZXIgPSB0aGlzLl9lbFJlZi5uYXRpdmVFbGVtZW50O1xuICAgICAgICBjb25zdCBwcmltYXJ5QnV0dG9uID0gd3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuay1wcmltYXJ5Jyk7XG4gICAgICAgIGlmICh0aGlzLmF1dG9Gb2N1c2VkRWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3QgaW5pdGlhbGx5Rm9jdXNlZEVsZW1lbnQgPSB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3IodGhpcy5hdXRvRm9jdXNlZEVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKGluaXRpYWxseUZvY3VzZWRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbGx5Rm9jdXNlZEVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnNob3VsZEZvY3VzUHJpbWFyeShwcmltYXJ5QnV0dG9uKSkge1xuICAgICAgICAgICAgcHJpbWFyeUJ1dHRvbi5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgd3JhcHBlci5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBoYW5kbGVBY3Rpb25CdXR0b25Gb2N1cyhwYXJlbnQsIGtleSkge1xuICAgICAgICBjb25zdCBmb2N1c2FibGVBY3Rpb25CdXR0b25zID0gdGhpcy5nZXRBbGxGb2N1c2FibGVDaGlsZHJlbihwYXJlbnQpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvY3VzYWJsZUFjdGlvbkJ1dHRvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBmb2N1c2FibGVBY3Rpb25CdXR0b25zW2ldO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnQgPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSBLZXlzLmxlZnQgJiYgaSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZm9jdXNhYmxlQWN0aW9uQnV0dG9uc1tpIC0gMV0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IEtleXMucmlnaHQgJiYgaSA8IGZvY3VzYWJsZUFjdGlvbkJ1dHRvbnMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICBmb2N1c2FibGVBY3Rpb25CdXR0b25zW2kgKyAxXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGtlZXBGb2N1c1dpdGhpbkNvbXBvbmVudCh0YXJnZXQsIGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGZpcnN0Rm9jdXNhYmxlID0gdGhpcy5fZWxSZWYubmF0aXZlRWxlbWVudDtcbiAgICAgICAgY29uc3QgbGFzdEZvY3VzYWJsZSA9IHRoaXMuZ2V0TGFzdEZvY3VzYWJsZUVsZW1lbnQoZmlyc3RGb2N1c2FibGUpO1xuICAgICAgICBjb25zdCB0YWJCZWZvcmVGaXJzdEZvY3VzYWJsZSA9IHRhcmdldCA9PT0gZmlyc3RGb2N1c2FibGUgJiYgZXZlbnQuc2hpZnRLZXk7XG4gICAgICAgIGNvbnN0IHRhYkFmdGVyTGFzdEZvY3VzYWJsZSA9ICFldmVudC5zaGlmdEtleSAmJiBpc1ByZXNlbnQobGFzdEZvY3VzYWJsZSkgJiYgdGFyZ2V0ID09PSBsYXN0Rm9jdXNhYmxlO1xuICAgICAgICBjb25zdCB0YWJXaXRoTm9Gb2N1c2FibGUgPSAhaXNQcmVzZW50KGxhc3RGb2N1c2FibGUpICYmICFldmVudC5zaGlmdEtleTtcbiAgICAgICAgaWYgKHRhYkJlZm9yZUZpcnN0Rm9jdXNhYmxlIHx8IHRhYldpdGhOb0ZvY3VzYWJsZSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGZpcnN0Rm9jdXNhYmxlLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhYkFmdGVyTGFzdEZvY3VzYWJsZSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGxhc3RGb2N1c2FibGUuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgc2hvdWxkRm9jdXNQcmltYXJ5KGVsKSB7XG4gICAgICAgIHJldHVybiBpc1ByZXNlbnQoZWwpICYmIGlzRm9jdXNhYmxlKGVsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGdldEFsbEZvY3VzYWJsZUNoaWxkcmVuKHBhcmVudCkge1xuICAgICAgICByZXR1cm4gcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9jdXNhYmxlU2VsZWN0b3IpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgZ2V0TGFzdEZvY3VzYWJsZUVsZW1lbnQocGFyZW50KSB7XG4gICAgICAgIGNvbnN0IGFsbCA9IHRoaXMuZ2V0QWxsRm9jdXNhYmxlQ2hpbGRyZW4ocGFyZW50KTtcbiAgICAgICAgcmV0dXJuIGFsbC5sZW5ndGggPiAwID8gYWxsW2FsbC5sZW5ndGggLSAxXSA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBnZW5lcmF0ZVRpdGxlSWQoKSB7XG4gICAgICAgIHJldHVybiAna2VuZG8tZGlhbG9nLXRpdGxlLScgKyBNYXRoLmNlaWwoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGdldCB3cmFwcGVyQ2xhc3MoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXQgc3R5bGVzKCkge1xuICAgICAgICBjb25zdCBzdHlsZXMgPSB7fTtcbiAgICAgICAgaWYgKHRoaXMud2lkdGgpIHtcbiAgICAgICAgICAgIHN0eWxlcy53aWR0aCA9IGNyZWF0ZVZhbHVlV2l0aFVuaXQodGhpcy53aWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaGVpZ2h0KSB7XG4gICAgICAgICAgICBzdHlsZXMuaGVpZ2h0ID0gY3JlYXRlVmFsdWVXaXRoVW5pdCh0aGlzLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWluV2lkdGgpIHtcbiAgICAgICAgICAgIHN0eWxlcy5taW5XaWR0aCA9IGNyZWF0ZVZhbHVlV2l0aFVuaXQodGhpcy5taW5XaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWF4V2lkdGgpIHtcbiAgICAgICAgICAgIHN0eWxlcy5tYXhXaWR0aCA9IGNyZWF0ZVZhbHVlV2l0aFVuaXQodGhpcy5tYXhXaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWluSGVpZ2h0KSB7XG4gICAgICAgICAgICBzdHlsZXMubWluSGVpZ2h0ID0gY3JlYXRlVmFsdWVXaXRoVW5pdCh0aGlzLm1pbkhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICBzdHlsZXMubWF4SGVpZ2h0ID0gY3JlYXRlVmFsdWVXaXRoVW5pdCh0aGlzLm1heEhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0eWxlcztcbiAgICB9XG4gICAgYnViYmxlKGV2ZW50TmFtZSwgY29tcG9uZW50KSB7XG4gICAgICAgIGlmIChjb21wb25lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGVtaXQgPSBlID0+IHRoaXNbZXZlbnROYW1lXS5lbWl0KGUpO1xuICAgICAgICAgICAgY29uc3QgcyA9IGNvbXBvbmVudFtldmVudE5hbWVdLnN1YnNjcmliZShlbWl0KTtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHMpO1xuICAgICAgICB9XG4gICAgfVxufVxuRGlhbG9nQ29tcG9uZW50LmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBDb21wb25lbnQsIGFyZ3M6IFt7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uczogW1xuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyKCdvdmVybGF5QXBwZWFyJywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUoJ2luJywgc3R5bGUoeyBvcGFjaXR5OiAxIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb24oJ3ZvaWQgPT4gKicsIFtzdHlsZSh7IG9wYWNpdHk6IDAuMSB9KSwgYW5pbWF0ZSgnLjNzIGN1YmljLWJlemllciguMiwgLjYsIC40LCAxKScpXSlcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXIoJ2RpYWxvZ1NsaWRlSW5BcHBlYXInLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSgnaW4nLCBzdHlsZSh7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgwLCAwKScgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbigndm9pZCA9PiAqJywgW3N0eWxlKHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlKDAsIC0xMCUpJyB9KSwgYW5pbWF0ZSgnLjNzIGN1YmljLWJlemllciguMiwgMSwgLjIsIDEpJyldKVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgZXhwb3J0QXM6ICdrZW5kb0RpYWxvZycsXG4gICAgICAgICAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IERJQUxPR19MT0NBTElaQVRJT05fU0VSVklDRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBMb2NhbGl6YXRpb25TZXJ2aWNlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlVmFsdWU6ICdrZW5kby5kaWFsb2cnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAna2VuZG8tZGlhbG9nJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICAgICBrZW5kb0RpYWxvZ0xvY2FsaXplZE1lc3NhZ2VzXG4gICAgICAgICAgICBpMThuLWNsb3NlVGl0bGU9XCJrZW5kby5kaWFsb2cuY2xvc2VUaXRsZXxUaGUgdGl0bGUgb2YgdGhlIGNsb3NlIGJ1dHRvblwiXG4gICAgICAgICAgICBjbG9zZVRpdGxlPVwiQ2xvc2VcIlxuICAgICAgICA+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJrLW92ZXJsYXlcIiBAb3ZlcmxheUFwcGVhcj48L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwiay13aWRnZXQgay13aW5kb3cgay1kaWFsb2dcIiByb2xlPVwiZGlhbG9nXCIgW25nU3R5bGVdPVwic3R5bGVzXCIgQGRpYWxvZ1NsaWRlSW5BcHBlYXI+XG4gICAgICAgICAgICA8a2VuZG8tZGlhbG9nLXRpdGxlYmFyICpuZ0lmPVwidGl0bGVcIiBbY2xvc2VUaXRsZV09XCJjbG9zZVRpdGxlXCIgW2lkXT1cInRpdGxlSWRcIj57eyB0aXRsZSB9fTwva2VuZG8tZGlhbG9nLXRpdGxlYmFyPlxuICAgICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwia2VuZG8tZGlhbG9nLXRpdGxlYmFyXCIgKm5nSWY9XCIhdGl0bGVcIj48L25nLWNvbnRlbnQ+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJrLWNvbnRlbnQgay13aW5kb3ctY29udGVudCBrLWRpYWxvZy1jb250ZW50XCI+XG4gICAgICAgICAgICAgICAgPG5nLWNvbnRlbnQgKm5nSWY9XCIhY29udGVudFRlbXBsYXRlXCI+PC9uZy1jb250ZW50PlxuICAgICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSBbbmdUZW1wbGF0ZU91dGxldF09XCJjb250ZW50VGVtcGxhdGVcIiAqbmdJZj1cImNvbnRlbnRUZW1wbGF0ZVwiPjwvbmctdGVtcGxhdGU+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwia2VuZG8tZGlhbG9nLWFjdGlvbnNcIiAqbmdJZj1cIiFhY3Rpb25zXCI+PC9uZy1jb250ZW50PlxuICAgICAgICAgICAgPGtlbmRvLWRpYWxvZy1hY3Rpb25zICpuZ0lmPVwiYWN0aW9uc1wiIFthY3Rpb25zXT1cImFjdGlvbnNcIiBbbGF5b3V0XT1cImFjdGlvbnNMYXlvdXRcIj4gPC9rZW5kby1kaWFsb2ctYWN0aW9ucz5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgYFxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5EaWFsb2dDb21wb25lbnQuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBFbGVtZW50UmVmIH0sXG4gICAgeyB0eXBlOiBSZW5kZXJlcjIgfSxcbiAgICB7IHR5cGU6IExvY2FsaXphdGlvblNlcnZpY2UgfSxcbiAgICB7IHR5cGU6IENoYW5nZURldGVjdG9yUmVmIH1cbl07XG5EaWFsb2dDb21wb25lbnQucHJvcERlY29yYXRvcnMgPSB7XG4gICAgYWN0aW9uczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgYWN0aW9uc0xheW91dDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgYXV0b0ZvY3VzZWRFbGVtZW50OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICB0aXRsZTogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgd2lkdGg6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIG1pbldpZHRoOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBtYXhXaWR0aDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgaGVpZ2h0OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBtaW5IZWlnaHQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIG1heEhlaWdodDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgYWN0aW9uOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgY2xvc2U6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBkaXI6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2F0dHIuZGlyJyxdIH1dLFxuICAgIHRhYkluZGV4OiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydhdHRyLnRhYkluZGV4JyxdIH1dLFxuICAgIHRpdGxlYmFyQ29udGVudDogW3sgdHlwZTogQ29udGVudENoaWxkLCBhcmdzOiBbRGlhbG9nVGl0bGVCYXJDb21wb25lbnQsXSB9XSxcbiAgICB0aXRsZWJhclZpZXc6IFt7IHR5cGU6IFZpZXdDaGlsZCwgYXJnczogW0RpYWxvZ1RpdGxlQmFyQ29tcG9uZW50LF0gfV0sXG4gICAgYWN0aW9uc1ZpZXc6IFt7IHR5cGU6IFZpZXdDaGlsZCwgYXJnczogW0RpYWxvZ0FjdGlvbnNDb21wb25lbnQsXSB9XSxcbiAgICBvbkNvbXBvbmVudEtleWRvd246IFt7IHR5cGU6IEhvc3RMaXN0ZW5lciwgYXJnczogWydrZXlkb3duJywgWyckZXZlbnQnXSxdIH1dLFxuICAgIHdyYXBwZXJDbGFzczogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1kaWFsb2ctd3JhcHBlcicsXSB9XVxufTtcblxuLyoqXG4gKiBUaGUgYmFzZSBjbGFzcyAgd2hpY2ggd2lsbCBiZSBleHRlbmRlZCBieSBhIGNvbXBvbmVudCB0aGF0IGlzIHByb3ZpZGVkIGFzIGNvbnRlbnQgdGhyb3VnaCBgY29udGVudGBcbiAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgc2VydmljZV9kaWFsb2cgJX0jdG9jLXBhc3NpbmctdGl0bGUtY29udGVudC1hbmQtYWN0aW9ucy1hcy1hLXNpbmdsZS1jb21wb25lbnQpKS5cbiAqL1xuY2xhc3MgRGlhbG9nQ29udGVudEJhc2Uge1xuICAgIGNvbnN0cnVjdG9yKGRpYWxvZykge1xuICAgICAgICB0aGlzLmRpYWxvZyA9IGRpYWxvZztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nVGl0bGVCYXIpIHtcbiAgICAgICAgICAgIC8vIHdoZW4gb3BlbmluZyBjb21wb25lbnQgaW5zaWRlIGRpYWxvZyB3aXRoIHNlcnZpY2UgQU5EIHRoZSBjb21wb25lbnQgaGFzIGRlZmluZWQgaXRzIG93biB0aXRsZWJhclxuICAgICAgICAgICAgdGhpcy5kaWFsb2dUaXRsZUJhci5jbG9zZS5waXBlKGZpbHRlcigoZSkgPT4gIWUuaXNEZWZhdWx0UHJldmVudGVkKCkpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlhbG9nLmNsb3NlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kaWFsb2dBY3Rpb25zKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaWFsb2dBY3Rpb25zLmFjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpYWxvZ0FjdGlvbnMuYWN0aW9uLnN1YnNjcmliZShhY3Rpb24gPT4gdGhpcy5kaWFsb2cuZGlhbG9nLmluc3RhbmNlLmFjdGlvbi5lbWl0KGFjdGlvbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuRGlhbG9nQ29udGVudEJhc2UucHJvcERlY29yYXRvcnMgPSB7XG4gICAgZGlhbG9nVGl0bGVCYXI6IFt7IHR5cGU6IFZpZXdDaGlsZCwgYXJnczogW0RpYWxvZ1RpdGxlQmFyQ29tcG9uZW50LF0gfV0sXG4gICAgZGlhbG9nQWN0aW9uczogW3sgdHlwZTogVmlld0NoaWxkLCBhcmdzOiBbRGlhbG9nQWN0aW9uc0NvbXBvbmVudCxdIH1dXG59O1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgRGlhbG9nQ29udGFpbmVyU2VydmljZSB7XG4gICAgc2V0IGNvbnRhaW5lcihjb250YWluZXIpIHtcbiAgICAgICAgRGlhbG9nQ29udGFpbmVyU2VydmljZS5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgfVxuICAgIGdldCBjb250YWluZXIoKSB7XG4gICAgICAgIHJldHVybiBEaWFsb2dDb250YWluZXJTZXJ2aWNlLmNvbnRhaW5lcjtcbiAgICB9XG59XG5EaWFsb2dDb250YWluZXJTZXJ2aWNlLmNvbnRhaW5lciA9IG51bGw7XG5EaWFsb2dDb250YWluZXJTZXJ2aWNlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBJbmplY3RhYmxlIH0sXG5dO1xuXG4vLyB0c2xpbnQ6ZGlzYWJsZTptYXgtbGluZS1sZW5ndGhcbmNvbnN0IGlzTm90Q29tcG9uZW50ID0gKGNvbXBvbmVudCkgPT4gaXNTdHJpbmcoY29tcG9uZW50KSB8fCBjb21wb25lbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZjtcbmNsYXNzIERpYWxvZ0luamVjdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihnZXREaWFsb2dSZWYsIHBhcmVudEluamVjdG9yKSB7XG4gICAgICAgIHRoaXMuZ2V0RGlhbG9nUmVmID0gZ2V0RGlhbG9nUmVmO1xuICAgICAgICB0aGlzLnBhcmVudEluamVjdG9yID0gcGFyZW50SW5qZWN0b3I7XG4gICAgfVxuICAgIGdldCh0b2tlbiwgbm90Rm91bmRWYWx1ZSkge1xuICAgICAgICBpZiAodG9rZW4gPT09IERpYWxvZ1JlZikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGlhbG9nUmVmKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50SW5qZWN0b3IuZ2V0KHRva2VuLCBub3RGb3VuZFZhbHVlKTtcbiAgICB9XG59XG4vKipcbiAqIEEgc2VydmljZSBmb3Igb3BlbmluZyBEaWFsb2cgd2luZG93cyBkeW5hbWljYWxseVxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBzZXJ2aWNlX2RpYWxvZyAlfSkpLlxuICovXG5jbGFzcyBEaWFsb2dTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgcmVzb2x2ZXIsIGNvbnRhaW5lclNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5yZXNvbHZlciA9IHJlc29sdmVyO1xuICAgICAgICB0aGlzLmNvbnRhaW5lclNlcnZpY2UgPSBjb250YWluZXJTZXJ2aWNlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBPcGVucyBhIERpYWxvZyB3aW5kb3cuIFJlcXVpcmVzIGFuIGVsZW1lbnQgaW4gdGhlIGFwcGxpY2F0aW9uIHRoYXQgdXNlcyB0aGVcbiAgICAgKiBbYGtlbmRvRGlhbG9nQ29udGFpbmVyYF0oeyUgc2x1ZyBhcGlfZGlhbG9nX2RpYWxvZ2NvbnRhaW5lcmRpcmVjdGl2ZSAlfSkgZGlyZWN0aXZlLlxuICAgICAqIENyZWF0ZWQgRGlhbG9ncyB3aWxsIGJlIG1vdW50ZWQgaW4gdGhlIERPTSBkaXJlY3RseSBhZnRlciB0aGF0IGVsZW1lbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0RpYWxvZ0FjdGlvbn0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIHRoYXQgZGVmaW5lIHRoZSBEaWFsb2cuXG4gICAgICogQHJldHVybnMge0RpYWxvZ1JlZn0gLSBBIHJlZmVyZW5jZSB0byB0aGUgRGlhbG9nIG9iamVjdCBhbmQgdGhlIGNvbnZlbmllbmNlIHByb3BlcnRpZXMuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogYGBgdHMtbm8tcnVuXG4gICAgICogX0BDb21wb25lbnQoe1xuICAgICAqICAgc2VsZWN0b3I6ICdteS1hcHAnLFxuICAgICAqICAgdGVtcGxhdGU6IGBcbiAgICAgKiAgICAgPGJ1dHRvbiBrZW5kb0J1dHRvbiAoY2xpY2spPVwib3BlbigpXCI+SGFybWxlc3MgYnV0dG9uPC9idXR0b24+XG4gICAgICogICAgIDxkaXYga2VuZG9EaWFsb2dDb250YWluZXI+PC9kaXY+XG4gICAgICogICBgXG4gICAgICogfSlcbiAgICAgKiBleHBvcnQgY2xhc3MgQXBwQ29tcG9uZW50IHtcbiAgICAgKiAgICAgY29uc3RydWN0b3IoIHByaXZhdGUgZGlhbG9nU2VydmljZTogRGlhbG9nU2VydmljZSApIHt9XG4gICAgICpcbiAgICAgKiAgICAgcHVibGljIG9wZW4oKSB7XG4gICAgICogICAgICAgICB2YXIgZGlhbG9nID0gdGhpcy5kaWFsb2dTZXJ2aWNlLm9wZW4oe1xuICAgICAqICAgICAgICAgICB0aXRsZTogXCJQbGVhc2UgY29uZmlybVwiLFxuICAgICAqICAgICAgICAgICBjb250ZW50OiBcIkFyZSB5b3Ugc3VyZT9cIixcbiAgICAgKiAgICAgICAgICAgYWN0aW9uczogW1xuICAgICAqICAgICAgICAgICAgIHsgdGV4dDogXCJOb1wiIH0sXG4gICAgICogICAgICAgICAgICAgeyB0ZXh0OiBcIlllc1wiLCBwcmltYXJ5OiB0cnVlIH1cbiAgICAgKiAgICAgICAgICAgXVxuICAgICAqICAgICAgICAgfSk7XG4gICAgICpcbiAgICAgKiAgICAgICAgIGRpYWxvZy5yZXN1bHQuc3Vic2NyaWJlKChyZXN1bHQpID0+IHtcbiAgICAgKiAgICAgICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIERpYWxvZ0Nsb3NlUmVzdWx0KSB7XG4gICAgICogICAgICAgICAgICAgY29uc29sZS5sb2coXCJjbG9zZVwiKTtcbiAgICAgKiAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgKiAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImFjdGlvblwiLCByZXN1bHQpO1xuICAgICAqICAgICAgICAgICB9XG4gICAgICogICAgICAgICB9KTtcbiAgICAgKiAgICAgfVxuICAgICAqIH1cbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqL1xuICAgIG9wZW4ob3B0aW9ucykge1xuICAgICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShEaWFsb2dDb21wb25lbnQpO1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBvcHRpb25zLmFwcGVuZFRvIHx8IHRoaXMuY29udGFpbmVyU2VydmljZS5jb250YWluZXI7XG4gICAgICAgIGlmICghY29udGFpbmVyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFxuQ2Fubm90IGF0dGFjaCBkaWFsb2cgdG8gdGhlIHBhZ2UuXG5BZGQgYW4gZWxlbWVudCB0aGF0IHVzZXMgdGhlIGtlbmRvRGlhbG9nQ29udGFpbmVyIGRpcmVjdGl2ZSwgb3Igc2V0IHRoZSAnYXBwZW5kVG8nIHByb3BlcnR5LlxuU2VlIGh0dHBzOi8vd3d3LnRlbGVyaWsuY29tL2tlbmRvLWFuZ3VsYXItdWkvY29tcG9uZW50cy9kaWFsb2dzL2RpYWxvZy9zZXJ2aWNlLy5cbiAgICAgICAgICBgKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjcmVhdGUgRGlhbG9nUmVmIHRvICgxKSBwYXNzIGFzIHJlc3VsdCwgKDIpIHByb3ZpZGUgdGhyb3VnaCBpbmplY3RvclxuICAgICAgICBjb25zdCBkaWFsb2dSZWYgPSB7XG4gICAgICAgICAgICBjbG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8qIG5vb3AgKi9cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50OiBudWxsLFxuICAgICAgICAgICAgZGlhbG9nOiBudWxsLFxuICAgICAgICAgICAgcmVzdWx0OiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmluaXRpYWxpemVEaWFsb2cob3B0aW9ucy5jb250ZW50LCBmYWN0b3J5LCBjb250YWluZXIsIGRpYWxvZ1JlZiwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGluaXRpYWxpemVEaWFsb2coY29tcG9uZW50LCBmYWN0b3J5LCBjb250YWluZXIsIGRpYWxvZ1JlZiwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5jb250ZW50RnJvbShjb21wb25lbnQsIGNvbnRhaW5lciwgZGlhbG9nUmVmKTtcbiAgICAgICAgY29uc3QgZGlhbG9nID0gY29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5LCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY29udGVudC5ub2Rlcyk7XG4gICAgICAgIGRpYWxvZ1JlZi5kaWFsb2cgPSBkaWFsb2c7XG4gICAgICAgIGRpYWxvZy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgLy8gY29weSBASW5wdXQgb3B0aW9ucyB0byBkaWFsb2cgaW5zdGFuY2VcbiAgICAgICAgdGhpcy5hcHBseU9wdGlvbnMoZGlhbG9nLmluc3RhbmNlLCBvcHRpb25zKTtcbiAgICAgICAgLy8gY3JlYXRlIGNsb3NlIGhhbmRsZXIgYW5kIHJlc3VsdCBzdHJlYW1cbiAgICAgICAgY29uc3QgYXBpQ2xvc2UgPSBuZXcgU3ViamVjdCgpO1xuICAgICAgICBjb25zdCBjbG9zZSA9IChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFByZXZlbnRhYmxlRXZlbnQpIHtcbiAgICAgICAgICAgICAgICBlID0gbmV3IERpYWxvZ0Nsb3NlUmVzdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhcGlDbG9zZS5uZXh0KGUgfHwgbmV3IERpYWxvZ0Nsb3NlUmVzdWx0KCkpO1xuICAgICAgICAgICAgaWYgKGNvbnRlbnQuY29tcG9uZW50UmVmKSB7XG4gICAgICAgICAgICAgICAgY29udGVudC5jb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGlhbG9nLmRlc3Ryb3koKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbWVyZ2UoYXBpQ2xvc2UsIFxuICAgICAgICAvLyB0cmlnZ2VyZWQgd2hlbiB0aGUgdGl0bGViYXIgb3IgYWN0aW9ucyBhcmUgZGVmaW5lZCBpbiBEaWFsb2dTZXR0aW5nc1xuICAgICAgICBtZXJnZShkaWFsb2cuaW5zdGFuY2UuY2xvc2UsIGRpYWxvZy5pbnN0YW5jZS5hY3Rpb24pLnBpcGUobWFwKGUgPT4gKGUgaW5zdGFuY2VvZiBQcmV2ZW50YWJsZUV2ZW50ID8gbmV3IERpYWxvZ0Nsb3NlUmVzdWx0KCkgOiBlKSksIGZpbHRlcihlID0+IHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnByZXZlbnRBY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAvLyBhZGQgZGlhbG9nUmVmIG9ubHkgd2hlbiB1c2luZyBjb21wb25lbnRcbiAgICAgICAgICAgICAgICBjb25zdCBkaWFsb2dSZWZQYXJhbWV0ZXIgPSBpc05vdENvbXBvbmVudChjb21wb25lbnQpID8gdW5kZWZpbmVkIDogZGlhbG9nUmVmO1xuICAgICAgICAgICAgICAgIHJldHVybiAhb3B0aW9ucy5wcmV2ZW50QWN0aW9uKGUsIGRpYWxvZ1JlZlBhcmFtZXRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSkpKS5waXBlKHRha2UoMSksIFxuICAgICAgICAvLyBUYWtlcyBjYXJlIGZvciBtdWx0aXBsZSBzdWJzY3JpcHRpb25zOlxuICAgICAgICAvLyBXZSBzdWJzY3JpYmUgaW50ZXJuYWx5IGFuZCB0aGUgdXNlciBtYXkgc3Vic2NyaWJlIHRvIGdldCBhIGNsb3NlIHJlc3VsdCAtIGRpYWxvZy5yZXN1bHQuc3Vic2NyaWJlKCkuXG4gICAgICAgIC8vIFRoaXMgY2F1c2VzIG11bHRpcGxlIHN1YnNjcmlwdGlvbnMgdG8gdGhlIHNhbWUgc291cmNlIGFuZCB0aHVzIG11bHRpcGxlIGVtaXNzaW9ucy4gc2hhcmUoKSBzb2x2ZXMgdGhhdC5cbiAgICAgICAgc2hhcmUoKSk7XG4gICAgICAgIHJlc3VsdC5zdWJzY3JpYmUoY2xvc2UpO1xuICAgICAgICBkaWFsb2dSZWYuY2xvc2UgPSBjbG9zZTtcbiAgICAgICAgZGlhbG9nUmVmLnJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgaWYgKGNvbXBvbmVudCAmJiBpc0Rldk1vZGUoKSkge1xuICAgICAgICAgICAgY29uc3QgaGFzQ29udGVudFRpdGxlID0gY29udGVudC5ub2Rlc1swXSAmJiBjb250ZW50Lm5vZGVzWzBdLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICBjb25zdCBoYXNDb250ZW50QWN0aW9ucyA9IGNvbnRlbnQubm9kZXNbMl0gJiYgY29udGVudC5ub2Rlc1syXS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgY29uc3QgbXVsdGlwbGVUaXRsZXMgPSBvcHRpb25zLnRpdGxlICYmIGhhc0NvbnRlbnRUaXRsZTtcbiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxlQWN0aW9ucyA9IG9wdGlvbnMuYWN0aW9ucyAmJiBoYXNDb250ZW50QWN0aW9ucztcbiAgICAgICAgICAgIGlmIChjb21wb25lbnQucHJvdG90eXBlIGluc3RhbmNlb2YgRGlhbG9nQ29udGVudEJhc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBjb250ZW50IGNvbXBvbmVudCBleHRlbmRzIERpYWxvZ0NvbnRlbnRCYXNlXG4gICAgICAgICAgICAgICAgaWYgKG11bHRpcGxlVGl0bGVzIHx8IG11bHRpcGxlQWN0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFxuICAgICAgICAgICAgICAgICAgICBNdWx0aXBsZSBUaXRsZSBhbmQvb3IgQWN0aW9ucyBjb25maWd1cmF0aW9ucyBkZXRlY3RlZC5cbiAgICAgICAgICAgICAgICAgICAgV2hlbiB1c2luZyBhIGNvbXBvbmVudCBhcyBjb250ZW50LCBwcm92aWRlIHRoZSB0aXRsZSBhbmQgYWN0aW9ucyBlaXRoZXIgaW4gdGhlIGNvbXBvbmVudCdzIG1hcmt1cFxuICAgICAgICAgICAgICAgICAgICBvciB2aWEgdGhlIHRpdGxlIGFuZCBhY3Rpb25zIHByb3BlcnRpZXMgb2YgdGhlIERpYWxvZ1NldHRpbmdzIG9iamVjdCwgYnV0IG5vdCBib3RoLlxuICAgICAgICAgICAgICAgICAgICBTZWUgaHR0cHM6Ly93d3cudGVsZXJpay5jb20va2VuZG8tYW5ndWxhci11aS9jb21wb25lbnRzL2RpYWxvZ3MvZGlhbG9nL3NlcnZpY2UvI3RvYy1wYXNzaW5nLXRpdGxlLWNvbnRlbnQtYW5kLWFjdGlvbnMtYXMtYS1zaW5nbGUtY29tcG9uZW50J2ApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChoYXNDb250ZW50VGl0bGUgfHwgaGFzQ29udGVudEFjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBcbiAgICAgICAgICAgICAgICAgICAgV2hlbiBUaXRsZSBhbmQvb3IgQWN0aW9ucyBtYXJrdXAgaXMgcHJvdmlkZWQgaW4gY29udGVudCBjb21wb25lbnQncyB0ZW1wbGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgdGhlIGNvbXBvbmVudCBuZWVkcyB0byBpbmhlcml0IHRoZSBEaWFsb2dDb250ZW50QmFzZSBjbGFzcyB0byBlbnN1cmUgdGhhdCBjbG9zZSBhbmQgcmVzdWx0IGV2ZW50cyBhcmUgcHJvcGVybHkgaG9va2VkLlxuICAgICAgICAgICAgICAgICAgICBTZWUgaHR0cHM6Ly93d3cudGVsZXJpay5jb20va2VuZG8tYW5ndWxhci11aS9jb21wb25lbnRzL2RpYWxvZ3MvZGlhbG9nL3NlcnZpY2UvI3RvYy1wYXNzaW5nLXRpdGxlLWNvbnRlbnQtYW5kLWFjdGlvbnMtYXMtYS1zaW5nbGUtY29tcG9uZW50J2ApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGlhbG9nUmVmO1xuICAgIH1cbiAgICBhcHBseU9wdGlvbnMoaW5zdGFuY2UsIG9wdGlvbnMpIHtcbiAgICAgICAgaW5zdGFuY2UudGl0bGUgPSBvcHRpb25zLnRpdGxlO1xuICAgICAgICBpbnN0YW5jZS5hY3Rpb25zID0gb3B0aW9ucy5hY3Rpb25zO1xuICAgICAgICBpbnN0YW5jZS5hY3Rpb25zTGF5b3V0ID0gb3B0aW9ucy5hY3Rpb25zTGF5b3V0IHx8ICdzdHJldGNoZWQnO1xuICAgICAgICBpbnN0YW5jZS53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICAgIGluc3RhbmNlLm1pbldpZHRoID0gb3B0aW9ucy5taW5XaWR0aDtcbiAgICAgICAgaW5zdGFuY2UubWF4V2lkdGggPSBvcHRpb25zLm1heFdpZHRoO1xuICAgICAgICBpbnN0YW5jZS5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICAgICAgaW5zdGFuY2UubWluSGVpZ2h0ID0gb3B0aW9ucy5taW5IZWlnaHQ7XG4gICAgICAgIGluc3RhbmNlLm1heEhlaWdodCA9IG9wdGlvbnMubWF4SGVpZ2h0O1xuICAgICAgICBpbnN0YW5jZS5hdXRvRm9jdXNlZEVsZW1lbnQgPSBvcHRpb25zLmF1dG9Gb2N1c2VkRWxlbWVudDtcbiAgICAgICAgaW5zdGFuY2UuY2xvc2VUaXRsZSA9IG9wdGlvbnMuY2xvc2VUaXRsZTtcbiAgICAgICAgaWYgKG9wdGlvbnMuY29udGVudCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5jb250ZW50VGVtcGxhdGUgPSBvcHRpb25zLmNvbnRlbnQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29udGVudEZyb20oY29udGVudCwgY29udGFpbmVyLCBkaWFsb2dSZWYpIHtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBjb250YWluZXIuaW5qZWN0b3IuZ2V0KFJlbmRlcmVyMik7XG4gICAgICAgIGxldCBub2RlcyA9IFtdO1xuICAgICAgICBsZXQgdGl0bGVOb2RlcyA9IFtdO1xuICAgICAgICBsZXQgYWN0aW9uTm9kZXMgPSBbXTtcbiAgICAgICAgbGV0IGNvbXBvbmVudFJlZiA9IG51bGw7XG4gICAgICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIG5vZGVzID0gW3JlbmRlcmVyLmNyZWF0ZVRleHQoY29udGVudCldO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbnRlbnQgJiYgIShjb250ZW50IGluc3RhbmNlb2YgVGVtcGxhdGVSZWYpKSB7XG4gICAgICAgICAgICAvLyBDb21wb25lbnRcbiAgICAgICAgICAgIGNvbnN0IGluamVjdG9yID0gbmV3IERpYWxvZ0luamVjdG9yKCgpID0+IGRpYWxvZ1JlZiwgY29udGFpbmVyLmluamVjdG9yKTtcbiAgICAgICAgICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbnRlbnQpO1xuICAgICAgICAgICAgY29tcG9uZW50UmVmID0gY29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5LCB1bmRlZmluZWQsIGluamVjdG9yKTtcbiAgICAgICAgICAgIHRpdGxlTm9kZXMgPSBBcnJheS5mcm9tKGNvbXBvbmVudFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2tlbmRvLWRpYWxvZy10aXRsZWJhcicpKTtcbiAgICAgICAgICAgIG5vZGVzID0gW2NvbXBvbmVudFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50XTtcbiAgICAgICAgICAgIGFjdGlvbk5vZGVzID0gQXJyYXkuZnJvbShjb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdrZW5kby1kaWFsb2ctYWN0aW9ucycpKTtcbiAgICAgICAgICAgIGRpYWxvZ1JlZi5jb250ZW50ID0gY29tcG9uZW50UmVmO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYsXG4gICAgICAgICAgICBub2RlczogW1xuICAgICAgICAgICAgICAgIHRpdGxlTm9kZXMsXG4gICAgICAgICAgICAgICAgbm9kZXMsXG4gICAgICAgICAgICAgICAgYWN0aW9uTm9kZXMgLy8gPG5nLWNvbnRlbnQgc2VsZWN0PVwia2VuZG8tZGlhbG9nLWFjdGlvbnNcIj5cbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICB9XG59XG5EaWFsb2dTZXJ2aWNlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBJbmplY3RhYmxlIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5EaWFsb2dTZXJ2aWNlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyIH0sXG4gICAgeyB0eXBlOiBEaWFsb2dDb250YWluZXJTZXJ2aWNlLCBkZWNvcmF0b3JzOiBbeyB0eXBlOiBJbmplY3QsIGFyZ3M6IFtEaWFsb2dDb250YWluZXJTZXJ2aWNlLF0gfV0gfVxuXTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmxldCBuZXdaSW5kZXggPSAxMDAwMjtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBERUZBVUxUX09QVElPTlMgPSB7XG4gICAgZHJhZ2dhYmxlOiB0cnVlLFxuICAgIGhlaWdodDogbnVsbCxcbiAgICBsZWZ0OiBudWxsLFxuICAgIG1pbkhlaWdodDogMTAwLFxuICAgIG1pbldpZHRoOiAxMjAsXG4gICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgcmVzaXphYmxlOiB0cnVlLFxuICAgIHN0YXRlOiAnZGVmYXVsdCcsXG4gICAgdG9wOiBudWxsLFxuICAgIHdpZHRoOiBudWxsXG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGNyZWF0ZU1vdmVTdHJlYW0gPSAoZWwsIGV2KSA9PiBtb3VzZURvd24gPT4ge1xuICAgIHJldHVybiBlbC5rZW5kb0RyYWdcbiAgICAgICAgLnBpcGUodGFrZVVudGlsKGVsLmtlbmRvUmVsZWFzZS5waXBlKHRhcCgoKSA9PiB7IGV2LmVtaXQoKTsgfSkpKSwgbWFwKCh7IHBhZ2VYLCBwYWdlWSB9KSA9PiAoe1xuICAgICAgICBvcmlnaW5hbFg6IG1vdXNlRG93bi5wYWdlWCxcbiAgICAgICAgb3JpZ2luYWxZOiBtb3VzZURvd24ucGFnZVksXG4gICAgICAgIHBhZ2VYLFxuICAgICAgICBwYWdlWVxuICAgIH0pKSk7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIERyYWdSZXNpemVTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcihuZ1pvbmUpIHtcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSBuZ1pvbmU7XG4gICAgICAgIHRoaXMuY2xvc2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuZm9jdXMgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuY2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmRyYWdTdGFydCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5kcmFnRW5kID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnJlc2l6ZUVuZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9PUFRJT05TKTtcbiAgICAgICAgdGhpcy5sYXN0QWN0aW9uID0gbnVsbDtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICAgICAgICB0aGlzLmRyYWdTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5kcmFnU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmRyYWdTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpbml0KGVsKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlJCQxID0gdGhpcy5vcHRpb25zLnN0YXRlO1xuICAgICAgICBsZXQgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgdGhpcy53aW5kb3cgPSBlbDtcbiAgICAgICAgaWYgKHN0YXRlJCQxICE9PSAnZGVmYXVsdCcpIHtcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZU9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdGUkJDEgPT09ICdtaW5pbWl6ZWQnKSB7XG4gICAgICAgICAgICBvcHRpb25zLmhlaWdodCA9IDA7XG4gICAgICAgICAgICBvcHRpb25zLm1pbkhlaWdodCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXRlJCQxID09PSAnbWF4aW1pemVkJykge1xuICAgICAgICAgICAgb3B0aW9ucy5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25EcmFnKGVsKSB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgbGV0IHN0YXJ0UG9zaXRpb247XG4gICAgICAgICAgICBsZXQgZHJhZ1N0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLmRyYWdTdWJzY3JpcHRpb24gPSBlbC5rZW5kb1ByZXNzXG4gICAgICAgICAgICAgICAgLnBpcGUodGFwKChldikgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghZXYuaXNUb3VjaCkge1xuICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdChldik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXMuZW1pdCgpO1xuICAgICAgICAgICAgICAgIHN0YXJ0UG9zaXRpb24gPSB0aGlzLmN1cnJlbnRQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIGRyYWdTdGFydGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9KSwgc3dpdGNoTWFwKGNyZWF0ZU1vdmVTdHJlYW0oZWwsIHRoaXMuZHJhZ0VuZCkpKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKHsgcGFnZVgsIHBhZ2VZLCBvcmlnaW5hbFgsIG9yaWdpbmFsWSB9KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFkcmFnU3RhcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVuc3VyZVdpZHRoKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ1N0YXJ0LmVtaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgZHJhZ1N0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZURyYWcoe1xuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFgsIG9yaWdpbmFsWSxcbiAgICAgICAgICAgICAgICAgICAgcGFnZVgsIHBhZ2VZLCBzdGFydFBvc2l0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBoYW5kbGVEcmFnKHsgb3JpZ2luYWxYLCBvcmlnaW5hbFksIHBhZ2VYLCBwYWdlWSwgc3RhcnRQb3NpdGlvbiB9KSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5sZWZ0ID0gc3RhcnRQb3NpdGlvbi54ICsgcGFnZVggLSBvcmlnaW5hbFg7XG4gICAgICAgIHRoaXMub3B0aW9ucy50b3AgPSBzdGFydFBvc2l0aW9uLnkgKyBwYWdlWSAtIG9yaWdpbmFsWTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdGF0ZSA9PT0gJ21pbmltaXplZCcgJiYgaXNQcmVzZW50KHRoaXMucmVzdG9yZU9wdGlvbnMpKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3RvcmVPcHRpb25zLmxlZnQgPSB0aGlzLm9wdGlvbnMubGVmdDtcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZU9wdGlvbnMudG9wID0gdGhpcy5vcHRpb25zLnRvcDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNoYW5nZS5lbWl0KHtcbiAgICAgICAgICAgIGxlZnQ6IHN0YXJ0UG9zaXRpb24ueCArIHBhZ2VYIC0gb3JpZ2luYWxYLFxuICAgICAgICAgICAgdG9wOiBzdGFydFBvc2l0aW9uLnkgKyBwYWdlWSAtIG9yaWdpbmFsWVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgb25SZXNpemUoaGFuZGxlLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZCh0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICAgICAgICBsZXQgc3RhcnRPZmZzZXRBbmRQb3NpdGlvbjtcbiAgICAgICAgICAgIGxldCByZXNpemVTdGFydGVkID0gZmFsc2U7XG4gICAgICAgICAgICBoYW5kbGUua2VuZG9QcmVzcy5waXBlKHRhcCgoZXYpID0+IHtcbiAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdChldik7XG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1cy5lbWl0KCk7XG4gICAgICAgICAgICAgICAgc3RhcnRPZmZzZXRBbmRQb3NpdGlvbiA9IHRoaXMuY3VycmVudE9mZnNldEFuZFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgcmVzaXplU3RhcnRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSksIHN3aXRjaE1hcChjcmVhdGVNb3ZlU3RyZWFtKGhhbmRsZSwgdGhpcy5yZXNpemVFbmQpKSlcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKCh7IHBhZ2VYLCBwYWdlWSwgb3JpZ2luYWxYLCBvcmlnaW5hbFkgfSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghcmVzaXplU3RhcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0LmVtaXQoZGlyZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplU3RhcnRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBkZWx0YVggPSBwYWdlWCAtIG9yaWdpbmFsWDtcbiAgICAgICAgICAgICAgICBsZXQgZGVsdGFZID0gcGFnZVkgLSBvcmlnaW5hbFk7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXNpemUoc3RhcnRPZmZzZXRBbmRQb3NpdGlvbiwgZGlyZWN0aW9uLCBkZWx0YVgsIGRlbHRhWSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBoYW5kbGVSZXNpemUoaW5pdGlhbCwgZGlyLCBkZWx0YVgsIGRlbHRhWSkge1xuICAgICAgICBjb25zdCBvbGQgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgIGxldCBldiA9IHt9O1xuICAgICAgICBpZiAoZGlyLmluZGV4T2YoJ2UnKSA+PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdXaWR0aCA9IGluaXRpYWwud2lkdGggKyBkZWx0YVg7XG4gICAgICAgICAgICBpZiAobmV3V2lkdGggIT09IG9sZC53aWR0aCAmJiBuZXdXaWR0aCA+PSBvbGQubWluV2lkdGgpIHtcbiAgICAgICAgICAgICAgICBldi53aWR0aCA9IG5ld1dpZHRoO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkaXIuaW5kZXhPZignbicpID49IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0hlaWdodCA9IGluaXRpYWwuaGVpZ2h0IC0gZGVsdGFZO1xuICAgICAgICAgICAgY29uc3QgbmV3VG9wID0gaW5pdGlhbC55ICsgZGVsdGFZO1xuICAgICAgICAgICAgaWYgKG5ld0hlaWdodCAhPT0gb2xkLmhlaWdodCAmJiBuZXdIZWlnaHQgPj0gb2xkLm1pbkhlaWdodCAmJiBuZXdUb3AgIT09IG9sZC50b3ApIHtcbiAgICAgICAgICAgICAgICBldi5oZWlnaHQgPSBuZXdIZWlnaHQ7XG4gICAgICAgICAgICAgICAgZXYudG9wID0gbmV3VG9wO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkaXIuaW5kZXhPZigncycpID49IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0hlaWdodCA9IGluaXRpYWwuaGVpZ2h0ICsgZGVsdGFZO1xuICAgICAgICAgICAgaWYgKG5ld0hlaWdodCAhPT0gb2xkLmhlaWdodCAmJiBuZXdIZWlnaHQgPj0gb2xkLm1pbkhlaWdodCkge1xuICAgICAgICAgICAgICAgIGV2LmhlaWdodCA9IG5ld0hlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZGlyLmluZGV4T2YoJ3cnKSA+PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdMZWZ0ID0gaW5pdGlhbC54ICsgZGVsdGFYO1xuICAgICAgICAgICAgY29uc3QgbmV3V2lkdGggPSBpbml0aWFsLndpZHRoIC0gZGVsdGFYO1xuICAgICAgICAgICAgaWYgKG5ld1dpZHRoICE9PSBvbGQud2lkdGggJiYgbmV3V2lkdGggPj0gb2xkLm1pbldpZHRoICYmIG5ld0xlZnQgIT09IG9sZC5sZWZ0KSB7XG4gICAgICAgICAgICAgICAgZXYud2lkdGggPSBuZXdXaWR0aDtcbiAgICAgICAgICAgICAgICBldi5sZWZ0ID0gbmV3TGVmdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KGV2LndpZHRoKSB8fCBpc1ByZXNlbnQoZXYuaGVpZ2h0KSkge1xuICAgICAgICAgICAgT0ZGU0VUX1NUWUxFUy5mb3JFYWNoKChzdHlsZSQkMSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpc1ByZXNlbnQoZXZbc3R5bGUkJDFdKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNbc3R5bGUkJDFdID0gZXZbc3R5bGUkJDFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2UuZW1pdChldik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVzdG9yZUFjdGlvbigpIHtcbiAgICAgICAgdGhpcy5sYXN0QWN0aW9uID0gJ3Jlc3RvcmUnO1xuICAgICAgICB0aGlzLmRlZmF1bHRTdGF0ZSgpO1xuICAgIH1cbiAgICBkZWZhdWx0U3RhdGUoKSB7XG4gICAgICAgIGlmIChpc1ByZXNlbnQodGhpcy5yZXN0b3JlT3B0aW9ucykpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMucmVzdG9yZU9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub3B0aW9ucy5zdGF0ZSA9ICdkZWZhdWx0JztcbiAgICAgICAgdGhpcy5zdGF0ZUNoYW5nZS5lbWl0KCdkZWZhdWx0Jyk7XG4gICAgfVxuICAgIHN0b3JlT3B0aW9ucygpIHtcbiAgICAgICAgdGhpcy5yZXN0b3JlT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMub3B0aW9ucyk7XG4gICAgfVxuICAgIG1heGltaXplQWN0aW9uKCkge1xuICAgICAgICB0aGlzLmxhc3RBY3Rpb24gPSAnbWF4aW1pemUnO1xuICAgICAgICB0aGlzLm1heGltaXplU3RhdGUoKTtcbiAgICB9XG4gICAgbWF4aW1pemVTdGF0ZSgpIHtcbiAgICAgICAgdGhpcy5zdG9yZU9wdGlvbnMoKTtcbiAgICAgICAgY29uc3Qgd25kID0gdGhpcy53aW5kb3dWaWV3UG9ydDtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRpb25zLCB7XG4gICAgICAgICAgICBoZWlnaHQ6IHduZC5oZWlnaHQsXG4gICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICAgICAgICBzdGF0ZTogJ21heGltaXplZCcsXG4gICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICB3aWR0aDogd25kLndpZHRoXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlLmVtaXQoJ21heGltaXplZCcpO1xuICAgIH1cbiAgICBtaW5pbWl6ZUFjdGlvbigpIHtcbiAgICAgICAgdGhpcy5sYXN0QWN0aW9uID0gJ21pbmltaXplJztcbiAgICAgICAgdGhpcy5taW5pbWl6ZVN0YXRlKCk7XG4gICAgfVxuICAgIG1pbmltaXplU3RhdGUoKSB7XG4gICAgICAgIHRoaXMuc3RvcmVPcHRpb25zKCk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMub3B0aW9ucywge1xuICAgICAgICAgICAgaGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgbWluSGVpZ2h0OiAwLFxuICAgICAgICAgICAgc3RhdGU6ICdtaW5pbWl6ZWQnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlLmVtaXQoJ21pbmltaXplZCcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIG1hbnVhbCBjaGFuZ2VzIG9mIHRoZSAnc3RhdGUnIHByb3BlcnR5LlxuICAgICAqIFJlcXVpcmVkIHRvIGRpc3Rpbmd1aXNoIHRoZW0gZnJvbSBhY3Rpb24gY2xpY2tzLlxuICAgICAqL1xuICAgIGFwcGx5TWFudWFsU3RhdGUoKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlJCQxID0gdGhpcy5vcHRpb25zLnN0YXRlO1xuICAgICAgICBzd2l0Y2ggKHN0YXRlJCQxKSB7XG4gICAgICAgICAgICBjYXNlICdkZWZhdWx0JzpcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFySGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0U3RhdGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ21heGltaXplZCc6XG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckhlaWdodCgpO1xuICAgICAgICAgICAgICAgIHRoaXMubWF4aW1pemVTdGF0ZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWluaW1pemVkJzpcbiAgICAgICAgICAgICAgICB0aGlzLm1pbmltaXplU3RhdGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xvc2VBY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuY2xvc2UuZW1pdCgpO1xuICAgIH1cbiAgICBlbnN1cmVXaWR0aCgpIHtcbiAgICAgICAgY29uc3Qgd2luZG93T2Zmc2V0ID0gb2Zmc2V0KHRoaXMud2luZG93Lm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICBpZiAoIWlzUHJlc2VudCh0aGlzLm9wdGlvbnMud2lkdGgpKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMud2lkdGggPSB3aW5kb3dPZmZzZXQud2lkdGg7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZS5lbWl0KHsgd2lkdGg6IHdpbmRvd09mZnNldC53aWR0aCB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjbGVhckhlaWdodCgpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oZWlnaHQgPT09IDApIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMuaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubWluSGVpZ2h0ID09PSAwKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5vcHRpb25zLm1pbkhlaWdodDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjZW50ZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc3RhdGUgPT09ICdtYXhpbWl6ZWQnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHNjcm9sbCA9IHNjcm9sbFBvc2l0aW9uKHRoaXMud2luZG93Lm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICBsZXQgd25kID0gdGhpcy53aW5kb3dWaWV3UG9ydDtcbiAgICAgICAgbGV0IHdyYXBwZXIgPSBvZmZzZXQodGhpcy53aW5kb3cubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGxldCBldiA9IHt9O1xuICAgICAgICBpZiAoIWlzUHJlc2VudCh0aGlzLm9wdGlvbnMubGVmdCkpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5sZWZ0ID0gc2Nyb2xsLnggKyBNYXRoLm1heCgwLCAod25kLndpZHRoIC0gd3JhcHBlci53aWR0aCkgLyAyKTtcbiAgICAgICAgICAgIGV2LmxlZnQgPSB0aGlzLm9wdGlvbnMubGVmdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzUHJlc2VudCh0aGlzLm9wdGlvbnMudG9wKSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnRvcCA9IHNjcm9sbC55ICsgTWF0aC5tYXgoMCwgKHduZC5oZWlnaHQgLSB3cmFwcGVyLmhlaWdodCkgLyAyKTtcbiAgICAgICAgICAgIGV2LnRvcCA9IHRoaXMub3B0aW9ucy50b3A7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jaGFuZ2UuZW1pdChldik7XG4gICAgfVxuICAgIGN1cnJlbnRPZmZzZXRBbmRQb3NpdGlvbigpIHtcbiAgICAgICAgY29uc3QgbyA9IHRoaXMub3B0aW9ucztcbiAgICAgICAgY29uc3Qgb2ZmID0gb2Zmc2V0KHRoaXMud2luZG93Lm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jdXJyZW50UG9zaXRpb24oKSwge1xuICAgICAgICAgICAgaGVpZ2h0OiBvLmhlaWdodCA/IG8uaGVpZ2h0IDogb2ZmLmhlaWdodCxcbiAgICAgICAgICAgIHdpZHRoOiBvLndpZHRoID8gby53aWR0aCA6IG9mZi53aWR0aFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY3VycmVudFBvc2l0aW9uKCkge1xuICAgICAgICBjb25zdCBvID0gdGhpcy5vcHRpb25zO1xuICAgICAgICBpZiAoIW8udG9wIHx8ICFvLmxlZnQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgeDogdGhpcy5vcHRpb25zLmxlZnQsXG4gICAgICAgICAgICB5OiB0aGlzLm9wdGlvbnMudG9wXG4gICAgICAgIH07XG4gICAgfVxuICAgIHNldFBvc2l0aW9uKCkge1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gcG9zaXRpb25XaXRoU2Nyb2xsKHRoaXMud2luZG93Lm5hdGl2ZUVsZW1lbnQsIGdldERvY3VtZW50RWxlbWVudCh0aGlzLndpbmRvdy5uYXRpdmVFbGVtZW50KSk7XG4gICAgICAgIHRoaXMub3B0aW9ucy5sZWZ0ID0gd3JhcHBlci5sZWZ0O1xuICAgICAgICB0aGlzLm9wdGlvbnMudG9wID0gd3JhcHBlci50b3A7XG4gICAgfVxuICAgIHNldFJlc3RvcmVPcHRpb24oc3R5bGUkJDEsIHZhbHVlKSB7XG4gICAgICAgIGlmIChpc1ByZXNlbnQodGhpcy5yZXN0b3JlT3B0aW9ucykpIHtcbiAgICAgICAgICAgIHRoaXMucmVzdG9yZU9wdGlvbnNbc3R5bGUkJDFdID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG5leHRQb3NzaWJsZVpJbmRleCgpIHtcbiAgICAgICAgcmV0dXJuIG5ld1pJbmRleDtcbiAgICB9XG4gICAgZ2V0IG5leHRaSW5kZXgoKSB7XG4gICAgICAgIHJldHVybiBuZXdaSW5kZXgrKztcbiAgICB9XG4gICAgZ2V0IHdpbmRvd1ZpZXdQb3J0KCkge1xuICAgICAgICByZXR1cm4gZ2V0V2luZG93Vmlld1BvcnQodGhpcy53aW5kb3cubmF0aXZlRWxlbWVudCk7XG4gICAgfVxufVxuRHJhZ1Jlc2l6ZVNlcnZpY2UuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IEluamVjdGFibGUgfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbkRyYWdSZXNpemVTZXJ2aWNlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogTmdab25lIH1cbl07XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jbGFzcyBSZXNpemVIYW5kbGVEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKGRyYWdnYWJsZSwgZWwsIHJlbmRlcmVyLCBzZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZHJhZ2dhYmxlID0gZHJhZ2dhYmxlO1xuICAgICAgICB0aGlzLmVsID0gZWw7XG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICAgIH1cbiAgICBnZXQgaG9zdENsYXNzKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuc2V0RGlzcGxheSgpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2stcmVzaXplLScgKyB0aGlzLmRpcmVjdGlvbik7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQob2YodGhpcy5kcmFnZ2FibGUpLnN1YnNjcmliZShoYW5kbGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLm9uUmVzaXplKGhhbmRsZSwgdGhpcy5kaXJlY3Rpb24pO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5zZXJ2aWNlLnJlc2l6ZVN0YXJ0LnN1YnNjcmliZSgoZGlyKSA9PiB7XG4gICAgICAgICAgICBpZiAoZGlyICE9PSB0aGlzLmRpcmVjdGlvbikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGlzcGxheSgnbm9uZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5zZXJ2aWNlLmRyYWdTdGFydC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXREaXNwbGF5KCdub25lJyk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZChtZXJnZSh0aGlzLnNlcnZpY2UucmVzaXplRW5kLCB0aGlzLnNlcnZpY2UuZHJhZ0VuZCkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGlzcGxheSgnYmxvY2snKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuYWRkKHRoaXMuc2VydmljZS5zdGF0ZUNoYW5nZS5zdWJzY3JpYmUoKHN0YXRlJCQxKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldERpc3BsYXkoc3RhdGUkJDEgPT09ICdkZWZhdWx0JyA/ICdibG9jaycgOiAnbm9uZScpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgc2V0RGlzcGxheSh2YWx1ZSA9ICdibG9jaycpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgdGhpcy5zZXJ2aWNlLm9wdGlvbnMuc3RhdGUgPT09ICdkZWZhdWx0JyA/IHZhbHVlIDogJ25vbmUnKTtcbiAgICB9XG59XG5SZXNpemVIYW5kbGVEaXJlY3RpdmUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IERpcmVjdGl2ZSwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ1trZW5kb1dpbmRvd1Jlc2l6ZUhhbmRsZV0nXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cblJlc2l6ZUhhbmRsZURpcmVjdGl2ZS5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IERyYWdnYWJsZURpcmVjdGl2ZSwgZGVjb3JhdG9yczogW3sgdHlwZTogSG9zdCB9XSB9LFxuICAgIHsgdHlwZTogRWxlbWVudFJlZiB9LFxuICAgIHsgdHlwZTogUmVuZGVyZXIyIH0sXG4gICAgeyB0eXBlOiBEcmFnUmVzaXplU2VydmljZSB9XG5dO1xuUmVzaXplSGFuZGxlRGlyZWN0aXZlLnByb3BEZWNvcmF0b3JzID0ge1xuICAgIGRpcmVjdGlvbjogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgaG9zdENsYXNzOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydjbGFzcy5rLXJlc2l6ZS1oYW5kbGUnLF0gfV1cbn07XG5cbmNsYXNzIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlbCwgc2VydmljZSwgbmdab25lKSB7XG4gICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSBuZ1pvbmU7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgfVxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmRyYWdEaXJlY3RpdmUgPSBuZXcgRHJhZ2dhYmxlRGlyZWN0aXZlKHRoaXMuZWwsIHRoaXMubmdab25lKTtcbiAgICAgICAgdGhpcy5kcmFnRGlyZWN0aXZlLm5nT25Jbml0KCk7XG4gICAgICAgIGlmICh0aGlzLmlzRHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmliZURyYWcoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN1YnNjcmliZVN0YXRlQ2hhbmdlKCk7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLmRyYWdEaXJlY3RpdmUubmdPbkRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZURyYWcoKTtcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZVN0YXRlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBzdWJzY3JpYmVEcmFnKCkge1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlRHJhZygpO1xuICAgICAgICB0aGlzLmRyYWdTdWJzY3JpcHRpb24gPSBvZih0aGlzLmRyYWdEaXJlY3RpdmUpLnN1YnNjcmliZSh0aXRsZUJhciA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2Uub25EcmFnKHRpdGxlQmFyKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBzdWJzY3JpYmVTdGF0ZUNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5zdGF0ZVN1YnNjcmlwdGlvbiA9IHRoaXMuc2VydmljZS5zdGF0ZUNoYW5nZS5zdWJzY3JpYmUoKHN0YXRlJCQxKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZXJ2aWNlLm9wdGlvbnMuZHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlJCQxID09PSAnbWF4aW1pemVkJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc3Vic2NyaWJlRHJhZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVEcmFnKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHVuc3Vic2NyaWJlRHJhZygpIHtcbiAgICAgICAgaWYgKHRoaXMuZHJhZ1N1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmRyYWdTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHRoaXMuZHJhZ1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgdGhpcy5kcmFnU3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgdW5zdWJzY3JpYmVTdGF0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGVTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVTdWJzY3JpcHRpb24gPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBjbGFzc05hbWUoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXQgdG91Y2hBY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gJ25vbmUnO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBoYW5kbGUoZXYpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXYudGFyZ2V0O1xuICAgICAgICBjb25zdCBzdGF0ZSQkMSA9IHRoaXMuc2VydmljZS5vcHRpb25zLnN0YXRlO1xuICAgICAgICBpZiAoIWhhc0NsYXNzZXModGFyZ2V0LCAnay1pY29uJykgJiYgIWlzRm9jdXNhYmxlKHRhcmdldCwgZmFsc2UpICYmIHRoaXMuc2VydmljZS5vcHRpb25zLnJlc2l6YWJsZSkge1xuICAgICAgICAgICAgaWYgKHN0YXRlJCQxID09PSAnZGVmYXVsdCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2UubWF4aW1pemVBY3Rpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHN0YXRlJCQxID09PSAnbWF4aW1pemVkJykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5yZXN0b3JlQWN0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IGlzRHJhZ2dhYmxlKCkge1xuICAgICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5zZXJ2aWNlLm9wdGlvbnM7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmRyYWdnYWJsZSAmJiBvcHRpb25zLnN0YXRlICE9PSAnbWF4aW1pemVkJztcbiAgICB9XG59XG5XaW5kb3dUaXRsZUJhckNvbXBvbmVudC5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogQ29tcG9uZW50LCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAna2VuZG8td2luZG93LXRpdGxlYmFyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogYFxuICAgIDxuZy1jb250ZW50ICpuZ0lmPVwiIXRlbXBsYXRlXCI+PC9uZy1jb250ZW50PlxuICAgIDxuZy10ZW1wbGF0ZVxuICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwidGVtcGxhdGVcIlxuICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cInsnJGltcGxpY2l0Jzogc2VydmljZX1cIiAqbmdJZj1cInRlbXBsYXRlXCI+XG4gICAgPC9uZy10ZW1wbGF0ZT5cbiAgYFxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5XaW5kb3dUaXRsZUJhckNvbXBvbmVudC5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IEVsZW1lbnRSZWYgfSxcbiAgICB7IHR5cGU6IERyYWdSZXNpemVTZXJ2aWNlIH0sXG4gICAgeyB0eXBlOiBOZ1pvbmUgfVxuXTtcbldpbmRvd1RpdGxlQmFyQ29tcG9uZW50LnByb3BEZWNvcmF0b3JzID0ge1xuICAgIHRlbXBsYXRlOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBjbGFzc05hbWU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2NsYXNzLmstd2luZG93LXRpdGxlYmFyJyxdIH0sIHsgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1kaWFsb2ctdGl0bGViYXInLF0gfV0sXG4gICAgdG91Y2hBY3Rpb246IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ3N0eWxlLnRvdWNoLWFjdGlvbicsXSB9XSxcbiAgICBoYW5kbGU6IFt7IHR5cGU6IEhvc3RMaXN0ZW5lciwgYXJnczogWydkYmxjbGljaycsIFsnJGV2ZW50J10sXSB9XVxufTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIE5hdmlnYXRpb25TZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3Rvcih3aW5kb3cpIHtcbiAgICAgICAgdGhpcy53aW5kb3cgPSB3aW5kb3c7XG4gICAgfVxuICAgIHByb2Nlc3MoZXYpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gZXYua2V5Q29kZTtcbiAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgIGNhc2UgS2V5cy51cDpcbiAgICAgICAgICAgIGNhc2UgS2V5cy5kb3duOlxuICAgICAgICAgICAgY2FzZSBLZXlzLmxlZnQ6XG4gICAgICAgICAgICBjYXNlIEtleXMucmlnaHQ6IHtcbiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQXJyb3coa2V5LCBldik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIEtleXMuZXNjOlxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRXNjYXBlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZUFycm93KGtleSwgZXYpIHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMud2luZG93Lm9wdGlvbnM7XG4gICAgICAgIGlmIChldi5hbHRLZXkpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlU3RhdGVDaGFuZ2Uoa2V5LCBvcHRpb25zLnN0YXRlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKGV2LmN0cmxLZXkgfHwgZXYubWV0YUtleSkgJiYgb3B0aW9ucy5zdGF0ZSA9PT0gJ2RlZmF1bHQnKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZVJlc2l6ZShrZXkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVEcmFnKGtleSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlRXNjYXBlKCkge1xuICAgICAgICB0aGlzLndpbmRvdy5jbG9zZUFjdGlvbigpO1xuICAgIH1cbiAgICBoYW5kbGVEcmFnKGtleSkge1xuICAgICAgICBsZXQgb3B0aW9ucyA9IHRoaXMud2luZG93Lm9wdGlvbnM7XG4gICAgICAgIGlmICghb3B0aW9ucy5kcmFnZ2FibGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvZmZzZXQkJDEgPSB0aGlzLndpbmRvdy5jdXJyZW50T2Zmc2V0QW5kUG9zaXRpb24oKTtcbiAgICAgICAgbGV0IHJlc3RvcmVPcHRpb25zID0gdGhpcy53aW5kb3cucmVzdG9yZU9wdGlvbnM7XG4gICAgICAgIGxldCBldiA9IHt9O1xuICAgICAgICBsZXQgZGVsdGEgPSAxMDtcbiAgICAgICAgaWYgKGtleSA9PT0gS2V5cy5sZWZ0IHx8IGtleSA9PT0gS2V5cy51cCkge1xuICAgICAgICAgICAgZGVsdGEgKj0gLTE7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgIGNhc2UgS2V5cy5sZWZ0OlxuICAgICAgICAgICAgY2FzZSBLZXlzLnJpZ2h0OiB7XG4gICAgICAgICAgICAgICAgZXYubGVmdCA9IG9mZnNldCQkMS54ICsgZGVsdGE7XG4gICAgICAgICAgICAgICAgb3B0aW9ucy5sZWZ0ID0gZXYubGVmdDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgS2V5cy51cDpcbiAgICAgICAgICAgIGNhc2UgS2V5cy5kb3duOiB7XG4gICAgICAgICAgICAgICAgZXYudG9wID0gb2Zmc2V0JCQxLnkgKyBkZWx0YTtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnRvcCA9IGV2LnRvcDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuc3RhdGUgPT09ICdtaW5pbWl6ZWQnICYmIGlzUHJlc2VudChyZXN0b3JlT3B0aW9ucykpIHtcbiAgICAgICAgICAgIHJlc3RvcmVPcHRpb25zLmxlZnQgPSBvcHRpb25zLmxlZnQ7XG4gICAgICAgICAgICByZXN0b3JlT3B0aW9ucy50b3AgPSBvcHRpb25zLnRvcDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndpbmRvdy5jaGFuZ2UuZW1pdChldik7XG4gICAgfVxuICAgIGhhbmRsZVJlc2l6ZShrZXkpIHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMud2luZG93Lm9wdGlvbnM7XG4gICAgICAgIGlmICghb3B0aW9ucy5yZXNpemFibGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvZmZzZXQkJDEgPSB0aGlzLndpbmRvdy5jdXJyZW50T2Zmc2V0QW5kUG9zaXRpb24oKTtcbiAgICAgICAgbGV0IG5ld1dpZHRoO1xuICAgICAgICBsZXQgbmV3SGVpZ2h0O1xuICAgICAgICBsZXQgZXYgPSB7fTtcbiAgICAgICAgbGV0IGRlbHRhID0gMTA7XG4gICAgICAgIGlmIChrZXkgPT09IEtleXMubGVmdCB8fCBrZXkgPT09IEtleXMudXApIHtcbiAgICAgICAgICAgIGRlbHRhICo9IC0xO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICBjYXNlIEtleXMubGVmdDpcbiAgICAgICAgICAgIGNhc2UgS2V5cy5yaWdodDoge1xuICAgICAgICAgICAgICAgIG5ld1dpZHRoID0gb2Zmc2V0JCQxLndpZHRoICsgZGVsdGE7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1dpZHRoICE9PSBvcHRpb25zLndpZHRoICYmIG5ld1dpZHRoID49IG9wdGlvbnMubWluV2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZXYud2lkdGggPSBuZXdXaWR0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIEtleXMudXA6XG4gICAgICAgICAgICBjYXNlIEtleXMuZG93bjoge1xuICAgICAgICAgICAgICAgIG5ld0hlaWdodCA9IG9mZnNldCQkMS5oZWlnaHQgKyBkZWx0YTtcbiAgICAgICAgICAgICAgICBpZiAobmV3SGVpZ2h0ICE9PSBvcHRpb25zLmhlaWdodCAmJiBuZXdIZWlnaHQgPj0gb3B0aW9ucy5taW5IZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXYuaGVpZ2h0ID0gbmV3SGVpZ2h0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChldi53aWR0aCkgfHwgaXNQcmVzZW50KGV2LmhlaWdodCkpIHtcbiAgICAgICAgICAgIE9GRlNFVF9TVFlMRVMuZm9yRWFjaCgoc3R5bGUkJDEpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXNQcmVzZW50KGV2W3N0eWxlJCQxXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53aW5kb3cub3B0aW9uc1tzdHlsZSQkMV0gPSBldltzdHlsZSQkMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLndpbmRvdy5jaGFuZ2UuZW1pdChldik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlU3RhdGVDaGFuZ2Uoa2V5LCBzdGF0ZSQkMSkge1xuICAgICAgICBpZiAoKHN0YXRlJCQxID09PSAnbWluaW1pemVkJyAmJiBrZXkgPT09IEtleXMudXApIHx8XG4gICAgICAgICAgICAoc3RhdGUkJDEgPT09ICdtYXhpbWl6ZWQnICYmIGtleSA9PT0gS2V5cy5kb3duKSkge1xuICAgICAgICAgICAgdGhpcy53aW5kb3cucmVzdG9yZUFjdGlvbigpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzdGF0ZSQkMSA9PT0gJ2RlZmF1bHQnKSB7XG4gICAgICAgICAgICBpZiAoa2V5ID09PSBLZXlzLnVwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy53aW5kb3cubWF4aW1pemVBY3Rpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gS2V5cy5kb3duKSB7XG4gICAgICAgICAgICAgICAgdGhpcy53aW5kb3cubWluaW1pemVBY3Rpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbk5hdmlnYXRpb25TZXJ2aWNlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBJbmplY3RhYmxlIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5OYXZpZ2F0aW9uU2VydmljZS5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IERyYWdSZXNpemVTZXJ2aWNlIH1cbl07XG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgW0tlbmRvIFVJIFdpbmRvdyBjb21wb25lbnQgZm9yIEFuZ3VsYXJdKHslIHNsdWcgb3ZlcnZpZXdfd2luZG93X2RpYWxvZ3MgJX0pLlxuICovXG5jbGFzcyBXaW5kb3dDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKGVsLCByZW5kZXJlciwgc2VydmljZSwgbmF2aWdhdGlvbiwgbmdab25lLCBsb2NhbGl6YXRpb24pIHtcbiAgICAgICAgdGhpcy5lbCA9IGVsO1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvbiA9IG5hdmlnYXRpb247XG4gICAgICAgIHRoaXMubmdab25lID0gbmdab25lO1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbiA9IGxvY2FsaXphdGlvbjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyBpZiB0aGUgY29udGVudCBvZiB0aGUgY29tcG9uZW50IGlzIHBlcnNpc3RlZCBpbiB0aGUgRE9NIHdoZW4gbWluaW1pemVkLlxuICAgICAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5rZWVwQ29udGVudCA9IGZhbHNlO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBzdGFydHMgdG8gbW92ZSB0aGUgV2luZG93LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kcmFnU3RhcnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBXaW5kb3cgd2FzIG1vdmVkIGJ5IHRoZSB1c2VyLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kcmFnRW5kID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBzdGFydHMgdG8gcmVzaXplIHRoZSBXaW5kb3cuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgV2luZG93IHdhcyByZXNpemVkIGJ5IHRoZSB1c2VyLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZXNpemVFbmQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1c2VyIGNsb3NlcyB0aGUgV2luZG93LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jbG9zZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIGB3aWR0aGAgcHJvcGVydHkgb2YgdGhlIGNvbXBvbmVudCB3YXMgdXBkYXRlZC4gVGhlIGV2ZW50IGlzIHRyaWdnZXJlZCBvbmx5IGFmdGVyIHRoZSByZXNpemluZ1xuICAgICAgICAgKiBoYXMgZW5kZWQuIFRoZSBldmVudCBkYXRhIGNvbnRhaW5zIHRoZSBuZXcgd2lkdGguIEFsbG93cyBhIHR3by13YXkgYmluZGluZyBvZiB0aGUgYHdpZHRoYCBwcm9wZXJ0eS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud2lkdGhDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBgaGVpZ2h0YCBwcm9wZXJ0eSBvZiB0aGUgY29tcG9uZW50IHdhcyB1cGRhdGVkLiBUaGUgZXZlbnQgaXMgdHJpZ2dlcmVkIG9ubHkgYWZ0ZXIgdGhlIHJlc2l6aW5nXG4gICAgICAgICAqIGhhcyBlbmRlZC4gVGhlIGV2ZW50IGRhdGEgY29udGFpbnMgdGhlIG5ldyBoZWlnaHQuIEFsbG93cyBhIHR3by13YXkgYmluZGluZyBvZiB0aGUgYGhlaWdodGAgcHJvcGVydHkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmhlaWdodENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIGB0b3BgIHByb3BlcnR5IG9mIHRoZSBjb21wb25lbnQgd2FzIHVwZGF0ZWQuIFRoZSBldmVudCBpcyB0cmlnZ2VyZWQgb25seSBhZnRlciB0aGUgZHJhZ2dpbmdcbiAgICAgICAgICogYW5kIHJlc2l6aW5nIGhhdmUgZW5kZWQuIFRoZSBldmVudCBkYXRhIGNvbnRhaW5zIHRoZSBuZXcgdG9wIG9mZnNldC4gQWxsb3dzIGEgdHdvLXdheSBiaW5kaW5nIG9mIHRoZSBgdG9wYCBwcm9wZXJ0eS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG9wQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgYGxlZnRgIHByb3BlcnR5IG9mIHRoZSBjb21wb25lbnQgd2FzIHVwZGF0ZWQuIFRoZSBldmVudCBpcyB0cmlnZ2VyZWQgb25seSBhZnRlciB0aGUgZHJhZ2dpbmdcbiAgICAgICAgICogYW5kIHJlc2l6aW5nIGhhdmUgZW5kZWQuIFRoZSBldmVudCBkYXRhIGNvbnRhaW5zIHRoZSBuZXcgbGVmdCBvZmZzZXQuIEFsbG93cyBhIHR3by13YXkgYmluZGluZyBvZiB0aGUgYGxlZnRgIHByb3BlcnR5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sZWZ0Q2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgYHN0YXRlYCBwcm9wZXJ0eSBvZiB0aGUgY29tcG9uZW50IHdhcyB1cGRhdGVkLiBUaGUgZXZlbnQgZGF0YSBjb250YWlucyB0aGUgbmV3IHN0YXRlLiBBbGxvd3MgYVxuICAgICAgICAgKiB0d28td2F5IGJpbmRpbmcgb2YgdGhlIGBzdGF0ZWAgcHJvcGVydHkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN0YXRlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnRhYkluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5kcmFnZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXNpemVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMubG9jYWxpemF0aW9uLnJ0bCA/ICdydGwnIDogJ2x0cic7XG4gICAgICAgIHRoaXMubG9jYWxpemF0aW9uQ2hhbmdlU3Vic2NyaXB0aW9uID0gdGhpcy5sb2NhbGl6YXRpb24uY2hhbmdlc1xuICAgICAgICAgICAgLnN1YnNjcmliZSgoeyBydGwgfSkgPT4gdGhpcy5kaXJlY3Rpb24gPSBydGwgPyAncnRsJyA6ICdsdHInKTtcbiAgICAgICAgdGhpcy5yZXNpemVEaXJlY3Rpb25zID0gUkVTSVpFX0RJUkVDVElPTlM7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlRXZlbnRzKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB3aGV0aGVyIHRoZSB1c2VyIHdpbGwgYmUgYWJsZSB0byBkcmFnIHRoZSBjb21wb25lbnQuXG4gICAgICogQGRlZmF1bHQgdHJ1ZVxuICAgICAqL1xuICAgIHNldCBkcmFnZ2FibGUodmFsdWUpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmRyYWdnYWJsZSA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgZHJhZ2dhYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmRyYWdnYWJsZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHdoZXRoZXIgdGhlIHVzZXIgd2lsbCBiZSBhYmxlIHRvIHJlc2l6ZSB0aGUgY29tcG9uZW50LlxuICAgICAqIEBkZWZhdWx0IHRydWVcbiAgICAgKi9cbiAgICBzZXQgcmVzaXphYmxlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemFibGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHJlc2l6YWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5yZXNpemFibGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB0aGUgaW5pdGlhbCBzdGF0ZSBvZiB0aGUgY29tcG9uZW50LlxuICAgICAqIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB2YWx1ZSBpcyBzZXQgdG8gYGRlZmF1bHRgLlxuICAgICAqXG4gICAgICogVGhlIHBvc3NpYmxlIHZhbHVlcyBhcmU6XG4gICAgICogKiBgbWluaW1pemVkYFxuICAgICAqICogYG1heGltaXplZGBcbiAgICAgKiAqIGBkZWZhdWx0YFxuICAgICAqL1xuICAgIHNldCBzdGF0ZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMuc3RhdGUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IHN0YXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnN0YXRlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTcGVjaWZpZXMgdGhlIG1pbmltdW0gd2lkdGggb2YgdGhlIGNvbXBvbmVudC5cbiAgICAgKiBUaGUgYG1pbldpZHRoYCBwcm9wZXJ0eSBoYXMgdG8gYmUgc2V0IGluIHBpeGVscy5cbiAgICAgKiBAZGVmYXVsdCAxMjBcbiAgICAgKi9cbiAgICBzZXQgbWluV2lkdGgodmFsdWUpIHtcbiAgICAgICAgdGhpcy5zZXRPcHRpb24oJ21pbldpZHRoJywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgbWluV2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMubWluV2lkdGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyB0aGUgbWluaW11bSBoZWlnaHQgb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgYG1pbkhlaWdodGAgcHJvcGVydHkgaGFzIHRvIGJlIHNldCBpbiBwaXhlbHMuXG4gICAgICogQGRlZmF1bHQgMTAwXG4gICAgICovXG4gICAgc2V0IG1pbkhlaWdodCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbignbWluSGVpZ2h0JywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgbWluSGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1pbkhlaWdodDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSB3aWR0aCBvZiB0aGUgV2luZG93LlxuICAgICAqIFRoZSBgd2lkdGhgIHByb3BlcnR5IGhhcyB0byBiZSBzZXQgaW4gcGl4ZWxzLlxuICAgICAqL1xuICAgIHNldCB3aWR0aCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbignd2lkdGgnLCB2YWx1ZSk7XG4gICAgfVxuICAgIGdldCB3aWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy53aWR0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSBoZWlnaHQgb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgYGhlaWdodGAgcHJvcGVydHkgaGFzIHRvIGJlIHNldCBpbiBwaXhlbHMuXG4gICAgICovXG4gICAgc2V0IGhlaWdodCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbignaGVpZ2h0JywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgaGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmhlaWdodDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSBpbml0aWFsIHRvcCBvZmZzZXQgb2YgdGhlIFdpbmRvdy5cbiAgICAgKiBUaGUgYHRvcGAgcHJvcGVydHkgaGFzIHRvIGJlIHNldCBpbiBwaXhlbHMuXG4gICAgICovXG4gICAgc2V0IHRvcCh2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbigndG9wJywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgdG9wKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnRvcDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BlY2lmaWVzIHRoZSBpbml0aWFsIGxlZnQgb2Zmc2V0IG9mIHRoZSBXaW5kb3cuXG4gICAgICogTnVtZXJpYyB2YWx1ZXMgYXJlIHRyZWF0ZWQgYXMgcGl4ZWxzLlxuICAgICAqL1xuICAgIHNldCBsZWZ0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9uKCdsZWZ0JywgdmFsdWUpO1xuICAgIH1cbiAgICBnZXQgbGVmdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5sZWZ0O1xuICAgIH1cbiAgICBnZXQgY2xvc2VCdXR0b25UaXRsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMubWVzc2FnZXMgJiYgdGhpcy5tZXNzYWdlcy5jbG9zZVRpdGxlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlcy5jbG9zZVRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsaXphdGlvbi5nZXQoJ2Nsb3NlVGl0bGUnKTtcbiAgICB9XG4gICAgZ2V0IHJlc3RvcmVCdXR0b25UaXRsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMubWVzc2FnZXMgJiYgdGhpcy5tZXNzYWdlcy5yZXN0b3JlVGl0bGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzLnJlc3RvcmVUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KCdyZXN0b3JlVGl0bGUnKTtcbiAgICB9XG4gICAgZ2V0IG1heGltaXplQnV0dG9uVGl0bGUoKSB7XG4gICAgICAgIGlmICh0aGlzLm1lc3NhZ2VzICYmIHRoaXMubWVzc2FnZXMubWF4aW1pemVUaXRsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWVzc2FnZXMubWF4aW1pemVUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KCdtYXhpbWl6ZVRpdGxlJyk7XG4gICAgfVxuICAgIGdldCBtaW5pbWl6ZUJ1dHRvblRpdGxlKCkge1xuICAgICAgICBpZiAodGhpcy5tZXNzYWdlcyAmJiB0aGlzLm1lc3NhZ2VzLm1pbmltaXplVGl0bGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzLm1pbmltaXplVGl0bGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxpemF0aW9uLmdldCgnbWluaW1pemVUaXRsZScpO1xuICAgIH1cbiAgICBnZXQgaG9zdENsYXNzZXMoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBnZXQgZGlyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3Rpb247XG4gICAgfVxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy5zZXROZXh0WkluZGV4KCk7XG4gICAgICAgIHRoaXMuaGFuZGxlSW5pdGlhbEZvY3VzKCk7XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IFByb21pc2UucmVzb2x2ZShudWxsKS50aGVuKCgpID0+IHRoaXMuc2V0SW5pdGlhbE9mZnNldCgpKSk7XG4gICAgfVxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICd0aXRsZScpO1xuICAgICAgICB0aGlzLnNlcnZpY2UuaW5pdCh0aGlzLmVsKTtcbiAgICB9XG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgICAgICBPRkZTRVRfU1RZTEVTLmZvckVhY2goKHN0eWxlJCQxKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNDaGFuZ2VkKHN0eWxlJCQxLCBjaGFuZ2VzKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3R5bGUoc3R5bGUkJDEsIHRoaXMub3B0aW9uc1tzdHlsZSQkMV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGlzQ2hhbmdlZCgnZHJhZ2dhYmxlJywgY2hhbmdlcykpIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlQmFyID0gaXNQcmVzZW50KHRoaXMudGl0bGVCYXJDb250ZW50KSA/IHRoaXMudGl0bGVCYXJDb250ZW50IDogdGhpcy50aXRsZUJhclZpZXc7XG4gICAgICAgICAgICBpZiAoaXNUcnV0aHkoY2hhbmdlcy5kcmFnZ2FibGUuY3VycmVudFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHRpdGxlQmFyLnN1YnNjcmliZURyYWcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRpdGxlQmFyLnVuc3Vic2NyaWJlRHJhZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpc0NoYW5nZWQoJ3N0YXRlJywgY2hhbmdlcykpIHtcbiAgICAgICAgICAgIGlmIChpc1ByZXNlbnQodGhpcy5zZXJ2aWNlLmxhc3RBY3Rpb24pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmxhc3RBY3Rpb24gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmFwcGx5TWFudWFsU3RhdGUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFsbE9mZnNldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy53aW5kb3dTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sb2NhbGl6YXRpb25DaGFuZ2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9jdXNlcyB0aGUgd3JhcHBlciBvZiB0aGUgV2luZG93IGNvbXBvbmVudC5cbiAgICAgKi9cbiAgICBmb2N1cygpIHtcbiAgICAgICAgY29uc3Qgd3JhcHBlciA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcbiAgICAgICAgaWYgKGlzUHJlc2VudCh3cmFwcGVyKSkge1xuICAgICAgICAgICAgd3JhcHBlci5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEJyaW5ncyB0aGUgY3VycmVudCBXaW5kb3cgY29tcG9uZW50IG9uIHRvcCBvZiBvdGhlciBXaW5kb3cgY29tcG9uZW50cyBvbiB0aGUgcGFnZS5cbiAgICAgKi9cbiAgICBicmluZ1RvRnJvbnQoKSB7XG4gICAgICAgIHRoaXMuc2V0TmV4dFpJbmRleCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNYW51YWxseSB1cGRhdGVzIHRoZSBgd2lkdGhgIG9yIGBoZWlnaHRgIG9wdGlvbiBvZiB0aGUgV2luZG93LlxuICAgICAqIFRoZSByZXF1aXJlZCBzdHlsZSB3aWxsIGJlIGFwcGxpZWQgdG8gdGhlIFdpbmRvdyB3cmFwcGVyIGVsZW1lbnQgYW5kIHRoZVxuICAgICAqIGNvcnJlc3BvbmRpbmcgcHJvcGVydHkgb2YgdGhlIGNvbXBvbmVudCBpbnN0YW5jZSB3aWxsIGJlIHVwZGF0ZWQuXG4gICAgICogVGhpcyBtZXRob2QgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBmb3Igc2l6aW5nIGR5bmFtaWNhbGx5IGNyZWF0ZWQgY29tcG9uZW50cyB1c2luZyB0aGVcbiAgICAgKiBbYFdpbmRvd1NlcnZpY2VgXSh7JSBzbHVnIGFwaV9kaWFsb2dfd2luZG93c2VydmljZSAlfSlcbiAgICAgKiBAcGFyYW0ge1dpbmRvd0RpbWVuc2lvblNldHRpbmd9IGRpbWVuc2lvbiAtIFRoZSBvcHRpb24gdGhhdCB3aWxsIGJlIHVwZGF0ZWRcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgc2V0IGluIHBpeGVsc1xuICAgICAqL1xuICAgIHNldERpbWVuc2lvbihkaW1lbnNpb24sIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0T3B0aW9uKGRpbWVuc2lvbiwgdmFsdWUpO1xuICAgICAgICB0aGlzLnNldFN0eWxlKGRpbWVuc2lvbiwgdmFsdWUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNYW51YWxseSB1cGRhdGVzIHRoZSBgdG9wYCBvciBgbGVmdGAgb2Zmc2V0IG9mIHRoZSBXaW5kb3cuXG4gICAgICogVGhlIHJlcXVpcmVkIHN0eWxlIHdpbGwgYmUgYXBwbGllZCB0byB0aGUgV2luZG93IHdyYXBwZXIgZWxlbWVudCBhbmQgdGhlXG4gICAgICogY29ycmVzcG9uZGluZyBwcm9wZXJ0eSBvZiB0aGUgY29tcG9uZW50IGluc3RhbmNlIHdpbGwgYmUgdXBkYXRlZC5cbiAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGZvciBwb3NpdGlvbmluZyBkeW5hbWljYWxseSBjcmVhdGVkIGNvbXBvbmVudHMgdXNpbmcgdGhlXG4gICAgICogW2BXaW5kb3dTZXJ2aWNlYF0oeyUgc2x1ZyBhcGlfZGlhbG9nX3dpbmRvd3NlcnZpY2UgJX0pXG4gICAgICogQHBhcmFtIHtXaW5kb3dPZmZzZXRTZXR0aW5nfSBvZmZzZXQgLSBUaGUgb3B0aW9uIHRoYXQgd2lsbCBiZSB1cGRhdGVkXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIHZhbHVlIHNldCBpbiBwaXhlbHNcbiAgICAgKi9cbiAgICBzZXRPZmZzZXQob2Zmc2V0JCQxLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLnNldE9wdGlvbihvZmZzZXQkJDEsIHZhbHVlKTtcbiAgICAgICAgdGhpcy5zZXRTdHlsZShvZmZzZXQkJDEsIHZhbHVlKTtcbiAgICB9XG4gICAgZ2V0IHNob3dEZWZhdWx0VGl0bGVCYXIoKSB7XG4gICAgICAgIHJldHVybiAhaXNQcmVzZW50KHRoaXMudGl0bGVCYXJDb250ZW50KTtcbiAgICB9XG4gICAgZ2V0IHN0eWxlTWluV2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1pbldpZHRoICsgJ3B4JztcbiAgICB9XG4gICAgZ2V0IHN0eWxlTWluSGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taW5IZWlnaHQgKyAncHgnO1xuICAgIH1cbiAgICBnZXQgc3R5bGVQb3NpdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5wb3NpdGlvbjtcbiAgICB9XG4gICAgZ2V0IHdyYXBwZXJNYXhpbWl6ZWRDbGFzcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUgPT09ICdtYXhpbWl6ZWQnO1xuICAgIH1cbiAgICBnZXQgd3JhcHBlck1pbmltaXplZENsYXNzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZSA9PT0gJ21pbmltaXplZCc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNvbXBvbmVudEtleWRvd24oZXZlbnQpIHtcbiAgICAgICAgaWYgKGhhc0NsYXNzZXMoZXZlbnQudGFyZ2V0LCBXSU5ET1dfQ0xBU1NFUykpIHtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbi5wcm9jZXNzKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25Db21wb25lbnRGb2N1cygpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdrLXN0YXRlLWZvY3VzZWQnKTtcbiAgICAgICAgdGhpcy5zZXROZXh0WkluZGV4KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNvbXBvbmVudEJsdXIoKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnay1zdGF0ZS1mb2N1c2VkJyk7XG4gICAgfVxuICAgIHN1YnNjcmliZUV2ZW50cygpIHtcbiAgICAgICAgaWYgKCFpc0RvY3VtZW50QXZhaWxhYmxlKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLmZvY3VzLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLmRyYWdTdGFydC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kcmFnZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdTdGFydC5lbWl0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLmRyYWdFbmQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRyYWdlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnRW5kLmVtaXQoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLmNsb3NlLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlLmVtaXQoKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLndpbmRvd1N1YnNjcmlwdGlvbi5hZGQodGhpcy5zZXJ2aWNlLnJlc2l6ZVN0YXJ0LnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlc2l6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0LmVtaXQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2UucmVzaXplRW5kLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5yZXNpemVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNpemVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNpemVFbmQuZW1pdCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2UuY2hhbmdlLnN1YnNjcmliZSgoZXYpID0+IHtcbiAgICAgICAgICAgIE9GRlNFVF9TVFlMRVMuZm9yRWFjaCgoc3R5bGUkJDEpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXNQcmVzZW50KGV2W3N0eWxlJCQxXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdHlsZShzdHlsZSQkMSwgZXZbc3R5bGUkJDFdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgIT09ICdtYXhpbWl6ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbWl0dGVyID0gdGhpc1tzdHlsZSQkMSArICdDaGFuZ2UnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbWl0dGVyLm9ic2VydmVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0dGVyLmVtaXQoZXZbc3R5bGUkJDFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMud2luZG93U3Vic2NyaXB0aW9uLmFkZCh0aGlzLnNlcnZpY2Uuc3RhdGVDaGFuZ2Uuc3Vic2NyaWJlKChzdGF0ZSQkMSkgPT4ge1xuICAgICAgICAgICAgaWYgKGlzUHJlc2VudCh0aGlzLnNlcnZpY2UubGFzdEFjdGlvbikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUFsbE9mZnNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVDaGFuZ2UuZW1pdChzdGF0ZSQkMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2V0TmV4dFpJbmRleCgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudFpJbmRleCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5zdHlsZVsnei1pbmRleCddO1xuICAgICAgICBjb25zdCBuZXh0UG9zc2libGVaSW5kZXggPSB0aGlzLnNlcnZpY2UubmV4dFBvc3NpYmxlWkluZGV4O1xuICAgICAgICBpZiAoIWN1cnJlbnRaSW5kZXggfHwgKG5leHRQb3NzaWJsZVpJbmRleCAtIGN1cnJlbnRaSW5kZXggPiAxKSkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIFwiei1pbmRleFwiLCB0aGlzLnNlcnZpY2UubmV4dFpJbmRleCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0SW5pdGlhbE9mZnNldCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgIT09ICdtYXhpbWl6ZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUFsbE9mZnNldCgpO1xuICAgICAgICAgICAgaWYgKCFpc1ByZXNlbnQodGhpcy5sZWZ0KSB8fCAhaXNQcmVzZW50KHRoaXMudG9wKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VydmljZS5jZW50ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHZpZXdQb3J0ID0gdGhpcy5zZXJ2aWNlLndpbmRvd1ZpZXdQb3J0O1xuICAgICAgICAgICAgdGhpcy5zZXRTdHlsZSgnd2lkdGgnLCB2aWV3UG9ydC53aWR0aCk7XG4gICAgICAgICAgICB0aGlzLnNldFN0eWxlKCdoZWlnaHQnLCB2aWV3UG9ydC5oZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdHlsZSgndG9wJywgMCk7XG4gICAgICAgICAgICB0aGlzLnNldFN0eWxlKCdsZWZ0JywgMCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlQWxsT2Zmc2V0KCkge1xuICAgICAgICBPRkZTRVRfU1RZTEVTLmZvckVhY2goKHN0eWxlJCQxKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNQcmVzZW50KHRoaXNbc3R5bGUkJDFdKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3R5bGUoc3R5bGUkJDEsIHRoaXNbc3R5bGUkJDFdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlU3R5bGUoc3R5bGUkJDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2V0U3R5bGUoc3R5bGUkJDEsIHZhbHVlKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCBzdHlsZSQkMSwgdmFsdWUgKyAncHgnKTtcbiAgICB9XG4gICAgcmVtb3ZlU3R5bGUoc3R5bGUkJDEpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsIHN0eWxlJCQxKTtcbiAgICB9XG4gICAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2Uub3B0aW9ucztcbiAgICB9XG4gICAgc2V0T3B0aW9uKHN0eWxlJCQxLCB2YWx1ZSkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJyAmJiB0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyc2VkVmFsdWUgPSAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykgPyB2YWx1ZSA6IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgICAgIHRoaXMub3B0aW9uc1tzdHlsZSQkMV0gPSBwYXJzZWRWYWx1ZTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlLnNldFJlc3RvcmVPcHRpb24oc3R5bGUkJDEsIHBhcnNlZFZhbHVlKTtcbiAgICB9XG4gICAgaGFuZGxlSW5pdGlhbEZvY3VzKCkge1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xuICAgICAgICBpZiAodGhpcy5hdXRvRm9jdXNlZEVsZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGluaXRpYWxseUZvY3VzZWRFbGVtZW50ID0gd3JhcHBlci5xdWVyeVNlbGVjdG9yKHRoaXMuYXV0b0ZvY3VzZWRFbGVtZW50KTtcbiAgICAgICAgICAgIGlmIChpbml0aWFsbHlGb2N1c2VkRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGluaXRpYWxseUZvY3VzZWRFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5XaW5kb3dDb21wb25lbnQuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBleHBvcnRBczogJ2tlbmRvV2luZG93JyxcbiAgICAgICAgICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgRHJhZ1Jlc2l6ZVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgICAgIE5hdmlnYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlOiBMMTBOX1BSRUZJWCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8ud2luZG93J1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLXdpbmRvdycsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGBcbiAgICAgICAgPG5nLWNvbnRhaW5lciBrZW5kb1dpbmRvd0xvY2FsaXplZE1lc3NhZ2VzXG4gICAgICAgICAgICBpMThuLWNsb3NlVGl0bGU9XCJrZW5kby53aW5kb3cuY2xvc2VUaXRsZXxUaGUgdGl0bGUgb2YgdGhlIGNsb3NlIGJ1dHRvblwiXG4gICAgICAgICAgICBjbG9zZVRpdGxlPVwiQ2xvc2VcIlxuXG4gICAgICAgICAgICBpMThuLXJlc3RvcmVUaXRsZT1cImtlbmRvLndpbmRvdy5yZXN0b3JlVGl0bGV8VGhlIHRpdGxlIG9mIHRoZSByZXN0b3JlIGJ1dHRvblwiXG4gICAgICAgICAgICByZXN0b3JlVGl0bGU9XCJSZXN0b3JlXCJcblxuICAgICAgICAgICAgaTE4bi1tYXhpbWl6ZVRpdGxlPVwia2VuZG8ud2luZG93Lm1heGltaXplVGl0bGV8VGhlIHRpdGxlIG9mIHRoZSBtYXhpbWl6ZSBidXR0b25cIlxuICAgICAgICAgICAgbWF4aW1pemVUaXRsZT1cIk1heGltaXplXCJcblxuICAgICAgICAgICAgaTE4bi1taW5pbWl6ZVRpdGxlPVwia2VuZG8ud2luZG93Lm1pbmltaXplVGl0bGV8VGhlIHRpdGxlIG9mIHRoZSBtaW5pbWl6ZSBidXR0b25cIlxuICAgICAgICAgICAgbWluaW1pemVUaXRsZT1cIk1pbmltaXplXCJcbiAgICAgICAgPlxuICAgICAgICA8bmctY29udGFpbmVyPlxuXG4gICAgICAgIDxrZW5kby13aW5kb3ctdGl0bGViYXIgKm5nSWY9XCJzaG93RGVmYXVsdFRpdGxlQmFyXCIgW3RlbXBsYXRlXT1cInRpdGxlQmFyVGVtcGxhdGVcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJrLXdpbmRvdy10aXRsZVwiPnt7IHRpdGxlIH19PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiay13aW5kb3ctYWN0aW9uc1wiPlxuICAgICAgICAgICAgICAgIDxidXR0b24ga2VuZG9XaW5kb3dNaW5pbWl6ZUFjdGlvbiAgW2F0dHIudGl0bGVdPVwibWluaW1pemVCdXR0b25UaXRsZVwiIFthdHRyLmFyaWEtbGFiZWxdPVwibWluaW1pemVCdXR0b25UaXRsZVwiPjwvYnV0dG9uPlxuICAgICAgICAgICAgICAgIDxidXR0b24ga2VuZG9XaW5kb3dNYXhpbWl6ZUFjdGlvbiBbYXR0ci50aXRsZV09XCJtYXhpbWl6ZUJ1dHRvblRpdGxlXCIgW2F0dHIuYXJpYS1sYWJlbF09XCJtYXhpbWl6ZUJ1dHRvblRpdGxlXCI+PC9idXR0b24+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBrZW5kb1dpbmRvd1Jlc3RvcmVBY3Rpb24gW2F0dHIudGl0bGVdPVwicmVzdG9yZUJ1dHRvblRpdGxlXCIgW2F0dHIuYXJpYS1sYWJlbF09XCJyZXN0b3JlQnV0dG9uVGl0bGVcIj48L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGtlbmRvV2luZG93Q2xvc2VBY3Rpb24gW2F0dHIudGl0bGVdPVwiY2xvc2VCdXR0b25UaXRsZVwiIFthdHRyLmFyaWEtbGFiZWxdPVwiY2xvc2VCdXR0b25UaXRsZVwiPjwvYnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwva2VuZG8td2luZG93LXRpdGxlYmFyPlxuICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJrZW5kby13aW5kb3ctdGl0bGViYXJcIiAqbmdJZj1cIiFzaG93RGVmYXVsdFRpdGxlQmFyXCI+PC9uZy1jb250ZW50PlxuXG4gICAgICAgIDxkaXYgKm5nSWY9XCJzdGF0ZSAhPT0gJ21pbmltaXplZCcgfHwga2VlcENvbnRlbnRcIlxuICAgICAgICAgICAgW2hpZGRlbl09XCJzdGF0ZSA9PT0gJ21pbmltaXplZCcgJiYga2VlcENvbnRlbnRcIlxuICAgICAgICAgICAgY2xhc3M9XCJrLWNvbnRlbnQgay13aW5kb3ctY29udGVudFwiXG4gICAgICAgID5cbiAgICAgICAgICAgIDxuZy1jb250ZW50ICpuZ0lmPVwiIWNvbnRlbnRUZW1wbGF0ZVwiPjwvbmctY29udGVudD5cbiAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSBbbmdUZW1wbGF0ZU91dGxldF09XCJjb250ZW50VGVtcGxhdGVcIiAqbmdJZj1cImNvbnRlbnRUZW1wbGF0ZVwiPjwvbmctdGVtcGxhdGU+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxuZy10ZW1wbGF0ZSBbbmdJZl09J3Jlc2l6YWJsZSc+XG4gICAgICAgICAgICA8ZGl2ICpuZ0Zvcj0nbGV0IGRpciBvZiByZXNpemVEaXJlY3Rpb25zJ1xuICAgICAgICAgICAgICAgIFtkaXJlY3Rpb25dPVwiZGlyXCJcbiAgICAgICAgICAgICAgICBrZW5kb1dpbmRvd1Jlc2l6ZUhhbmRsZVxuICAgICAgICAgICAgICAgIGtlbmRvRHJhZ2dhYmxlPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgYFxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5XaW5kb3dDb21wb25lbnQuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBFbGVtZW50UmVmIH0sXG4gICAgeyB0eXBlOiBSZW5kZXJlcjIgfSxcbiAgICB7IHR5cGU6IERyYWdSZXNpemVTZXJ2aWNlIH0sXG4gICAgeyB0eXBlOiBOYXZpZ2F0aW9uU2VydmljZSB9LFxuICAgIHsgdHlwZTogTmdab25lIH0sXG4gICAgeyB0eXBlOiBMb2NhbGl6YXRpb25TZXJ2aWNlIH1cbl07XG5XaW5kb3dDb21wb25lbnQucHJvcERlY29yYXRvcnMgPSB7XG4gICAgYXV0b0ZvY3VzZWRFbGVtZW50OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICB0aXRsZTogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgZHJhZ2dhYmxlOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICByZXNpemFibGU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGtlZXBDb250ZW50OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBzdGF0ZTogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgbWluV2lkdGg6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIG1pbkhlaWdodDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgd2lkdGg6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGhlaWdodDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgdG9wOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBsZWZ0OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBkcmFnU3RhcnQ6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBkcmFnRW5kOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgcmVzaXplU3RhcnQ6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICByZXNpemVFbmQ6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBjbG9zZTogW3sgdHlwZTogT3V0cHV0IH1dLFxuICAgIHdpZHRoQ2hhbmdlOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgaGVpZ2h0Q2hhbmdlOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgdG9wQ2hhbmdlOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgbGVmdENoYW5nZTogW3sgdHlwZTogT3V0cHV0IH1dLFxuICAgIHN0YXRlQ2hhbmdlOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgdGFiSW5kZXg6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2F0dHIudGFiSW5kZXgnLF0gfV0sXG4gICAgaG9zdENsYXNzZXM6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2NsYXNzLmstd2lkZ2V0JyxdIH0sIHsgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay13aW5kb3cnLF0gfV0sXG4gICAgZGlyOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydhdHRyLmRpcicsXSB9XSxcbiAgICB0aXRsZUJhclZpZXc6IFt7IHR5cGU6IFZpZXdDaGlsZCwgYXJnczogW1dpbmRvd1RpdGxlQmFyQ29tcG9uZW50LF0gfV0sXG4gICAgdGl0bGVCYXJDb250ZW50OiBbeyB0eXBlOiBDb250ZW50Q2hpbGQsIGFyZ3M6IFtXaW5kb3dUaXRsZUJhckNvbXBvbmVudCxdIH1dLFxuICAgIHJlc2l6ZUhhbmRsZXM6IFt7IHR5cGU6IFZpZXdDaGlsZHJlbiwgYXJnczogW1Jlc2l6ZUhhbmRsZURpcmVjdGl2ZSxdIH1dLFxuICAgIHN0eWxlTWluV2lkdGg6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ3N0eWxlLm1pbldpZHRoJyxdIH1dLFxuICAgIHN0eWxlTWluSGVpZ2h0OiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydzdHlsZS5taW5IZWlnaHQnLF0gfV0sXG4gICAgc3R5bGVQb3NpdGlvbjogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnc3R5bGUucG9zaXRpb24nLF0gfV0sXG4gICAgd3JhcHBlck1heGltaXplZENsYXNzOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydjbGFzcy5rLXdpbmRvdy1tYXhpbWl6ZWQnLF0gfV0sXG4gICAgd3JhcHBlck1pbmltaXplZENsYXNzOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydjbGFzcy5rLXdpbmRvdy1taW5pbWl6ZWQnLF0gfV0sXG4gICAgb25Db21wb25lbnRLZXlkb3duOiBbeyB0eXBlOiBIb3N0TGlzdGVuZXIsIGFyZ3M6IFsna2V5ZG93bicsIFsnJGV2ZW50J10sXSB9XSxcbiAgICBvbkNvbXBvbmVudEZvY3VzOiBbeyB0eXBlOiBIb3N0TGlzdGVuZXIsIGFyZ3M6IFsnZm9jdXMnLF0gfV0sXG4gICAgb25Db21wb25lbnRCbHVyOiBbeyB0eXBlOiBIb3N0TGlzdGVuZXIsIGFyZ3M6IFsnYmx1cicsXSB9XVxufTtcblxuY2xhc3MgV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUgZXh0ZW5kcyBCdXR0b24ge1xuICAgIGNvbnN0cnVjdG9yKGVsLCByZW5kZXJlciwgX3NlcnZpY2UsIGxvY2FsaXphdGlvbiwgbmdab25lKSB7XG4gICAgICAgIHN1cGVyKGVsLCByZW5kZXJlciwgbnVsbCwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpO1xuICAgICAgICB0aGlzLmJ1dHRvblR5cGUgPSAnYnV0dG9uJztcbiAgICAgICAgdGhpcy53aW5kb3cgPSBfc2VydmljZTtcbiAgICAgICAgdGhpcy5sb29rID0gJ2JhcmUnO1xuICAgICAgICB0aGlzLmljb24gPSAnd2luZG93LW1heGltaXplJztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9uQ2xpY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5pc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLndpbmRvdy5tYXhpbWl6ZUFjdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCB2aXNpYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy53aW5kb3cub3B0aW9ucy5zdGF0ZSA9PT0gJ2RlZmF1bHQnID8gJ2lubGluZS1mbGV4JyA6ICdub25lJztcbiAgICB9XG59XG5XaW5kb3dNYXhpbWl6ZUFjdGlvbkRpcmVjdGl2ZS5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogRGlyZWN0aXZlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGV4cG9ydEFzOiAna2VuZG9XaW5kb3dNYXhpbWl6ZUFjdGlvbicsXG4gICAgICAgICAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlVmFsdWU6ICdrZW5kby5idXR0b24nXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAnYnV0dG9uW2tlbmRvV2luZG93TWF4aW1pemVBY3Rpb25dJyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbldpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogRWxlbWVudFJlZiB9LFxuICAgIHsgdHlwZTogUmVuZGVyZXIyIH0sXG4gICAgeyB0eXBlOiBEcmFnUmVzaXplU2VydmljZSwgZGVjb3JhdG9yczogW3sgdHlwZTogT3B0aW9uYWwgfV0gfSxcbiAgICB7IHR5cGU6IExvY2FsaXphdGlvblNlcnZpY2UgfSxcbiAgICB7IHR5cGU6IE5nWm9uZSB9XG5dO1xuV2luZG93TWF4aW1pemVBY3Rpb25EaXJlY3RpdmUucHJvcERlY29yYXRvcnMgPSB7XG4gICAgd2luZG93OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBidXR0b25UeXBlOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydhdHRyLnR5cGUnLF0gfV0sXG4gICAgb25DbGljazogW3sgdHlwZTogSG9zdExpc3RlbmVyLCBhcmdzOiBbJ2NsaWNrJyxdIH1dLFxuICAgIHZpc2libGU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ3N0eWxlLmRpc3BsYXknLF0gfV1cbn07XG5cbmNsYXNzIFdpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlIGV4dGVuZHMgQnV0dG9uIHtcbiAgICBjb25zdHJ1Y3RvcihlbCwgcmVuZGVyZXIsIF9zZXJ2aWNlLCBsb2NhbGl6YXRpb24sIG5nWm9uZSkge1xuICAgICAgICBzdXBlcihlbCwgcmVuZGVyZXIsIG51bGwsIGxvY2FsaXphdGlvbiwgbmdab25lKTtcbiAgICAgICAgdGhpcy5idXR0b25UeXBlID0gJ2J1dHRvbic7XG4gICAgICAgIHRoaXMud2luZG93ID0gX3NlcnZpY2U7XG4gICAgICAgIHRoaXMubG9vayA9ICdiYXJlJztcbiAgICAgICAgdGhpcy5pY29uID0gJ3dpbmRvdy1taW5pbWl6ZSc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNsaWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy53aW5kb3cubWluaW1pemVBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdmlzaWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2luZG93Lm9wdGlvbnMuc3RhdGUgPT09ICdkZWZhdWx0JyA/ICdpbmxpbmUtZmxleCcgOiAnbm9uZSc7XG4gICAgfVxufVxuV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IERpcmVjdGl2ZSwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBleHBvcnRBczogJ2tlbmRvV2luZG93TWluaW1pemVBY3Rpb24nLFxuICAgICAgICAgICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlOiBMMTBOX1BSRUZJWCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZVZhbHVlOiAna2VuZG8uYnV0dG9uJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ2J1dHRvbltrZW5kb1dpbmRvd01pbmltaXplQWN0aW9uXScgLy8gdHNsaW50OmRpc2FibGUtbGluZVxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5XaW5kb3dNaW5pbWl6ZUFjdGlvbkRpcmVjdGl2ZS5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IEVsZW1lbnRSZWYgfSxcbiAgICB7IHR5cGU6IFJlbmRlcmVyMiB9LFxuICAgIHsgdHlwZTogRHJhZ1Jlc2l6ZVNlcnZpY2UsIGRlY29yYXRvcnM6IFt7IHR5cGU6IE9wdGlvbmFsIH1dIH0sXG4gICAgeyB0eXBlOiBMb2NhbGl6YXRpb25TZXJ2aWNlIH0sXG4gICAgeyB0eXBlOiBOZ1pvbmUgfVxuXTtcbldpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlLnByb3BEZWNvcmF0b3JzID0ge1xuICAgIHdpbmRvdzogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgYnV0dG9uVHlwZTogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnYXR0ci50eXBlJyxdIH1dLFxuICAgIG9uQ2xpY2s6IFt7IHR5cGU6IEhvc3RMaXN0ZW5lciwgYXJnczogWydjbGljaycsXSB9XSxcbiAgICB2aXNpYmxlOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydzdHlsZS5kaXNwbGF5JyxdIH1dXG59O1xuXG5jbGFzcyBXaW5kb3dDbG9zZUFjdGlvbkRpcmVjdGl2ZSBleHRlbmRzIEJ1dHRvbiB7XG4gICAgY29uc3RydWN0b3IoZWwsIHJlbmRlcmVyLCBfc2VydmljZSwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpIHtcbiAgICAgICAgc3VwZXIoZWwsIHJlbmRlcmVyLCBudWxsLCBsb2NhbGl6YXRpb24sIG5nWm9uZSk7XG4gICAgICAgIHRoaXMuYnV0dG9uVHlwZSA9ICdidXR0b24nO1xuICAgICAgICB0aGlzLndpbmRvdyA9IF9zZXJ2aWNlO1xuICAgICAgICB0aGlzLmxvb2sgPSAnYmFyZSc7XG4gICAgICAgIHRoaXMuaWNvbiA9ICdjbG9zZSc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkNsaWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy53aW5kb3cuY2xvc2VBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbldpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBEaXJlY3RpdmUsIGFyZ3M6IFt7XG4gICAgICAgICAgICAgICAgZXhwb3J0QXM6ICdrZW5kb1dpbmRvd0Nsb3NlQWN0aW9uJyxcbiAgICAgICAgICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgTG9jYWxpemF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZTogTDEwTl9QUkVGSVgsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VWYWx1ZTogJ2tlbmRvLmJ1dHRvbidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdidXR0b25ba2VuZG9XaW5kb3dDbG9zZUFjdGlvbl0nIC8vIHRzbGludDpkaXNhYmxlLWxpbmVcbiAgICAgICAgICAgIH0sXSB9LFxuXTtcbi8qKiBAbm9jb2xsYXBzZSAqL1xuV2luZG93Q2xvc2VBY3Rpb25EaXJlY3RpdmUuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBFbGVtZW50UmVmIH0sXG4gICAgeyB0eXBlOiBSZW5kZXJlcjIgfSxcbiAgICB7IHR5cGU6IERyYWdSZXNpemVTZXJ2aWNlLCBkZWNvcmF0b3JzOiBbeyB0eXBlOiBPcHRpb25hbCB9XSB9LFxuICAgIHsgdHlwZTogTG9jYWxpemF0aW9uU2VydmljZSB9LFxuICAgIHsgdHlwZTogTmdab25lIH1cbl07XG5XaW5kb3dDbG9zZUFjdGlvbkRpcmVjdGl2ZS5wcm9wRGVjb3JhdG9ycyA9IHtcbiAgICB3aW5kb3c6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGJ1dHRvblR5cGU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2F0dHIudHlwZScsXSB9XSxcbiAgICBvbkNsaWNrOiBbeyB0eXBlOiBIb3N0TGlzdGVuZXIsIGFyZ3M6IFsnY2xpY2snLF0gfV1cbn07XG5cbmNsYXNzIFdpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmUgZXh0ZW5kcyBCdXR0b24ge1xuICAgIGNvbnN0cnVjdG9yKGVsLCByZW5kZXJlciwgX3NlcnZpY2UsIGxvY2FsaXphdGlvbiwgbmdab25lKSB7XG4gICAgICAgIHN1cGVyKGVsLCByZW5kZXJlciwgbnVsbCwgbG9jYWxpemF0aW9uLCBuZ1pvbmUpO1xuICAgICAgICB0aGlzLmJ1dHRvblR5cGUgPSAnYnV0dG9uJztcbiAgICAgICAgdGhpcy53aW5kb3cgPSBfc2VydmljZTtcbiAgICAgICAgdGhpcy5sb29rID0gJ2JhcmUnO1xuICAgICAgICB0aGlzLmljb24gPSAnd2luZG93LXJlc3RvcmUnO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25DbGljaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzRGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMud2luZG93LnJlc3RvcmVBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdmlzaWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMud2luZG93Lm9wdGlvbnMuc3RhdGUgPT09ICdkZWZhdWx0JyA/ICdub25lJyA6ICdpbmxpbmUtZmxleCc7XG4gICAgfVxufVxuV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZS5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogRGlyZWN0aXZlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGV4cG9ydEFzOiAna2VuZG9XaW5kb3dSZXN0b3JlQWN0aW9uJyxcbiAgICAgICAgICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgTG9jYWxpemF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZTogTDEwTl9QUkVGSVgsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VWYWx1ZTogJ2tlbmRvLmJ1dHRvbidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdidXR0b25ba2VuZG9XaW5kb3dSZXN0b3JlQWN0aW9uXScgLy8gdHNsaW50OmRpc2FibGUtbGluZVxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5XaW5kb3dSZXN0b3JlQWN0aW9uRGlyZWN0aXZlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogRWxlbWVudFJlZiB9LFxuICAgIHsgdHlwZTogUmVuZGVyZXIyIH0sXG4gICAgeyB0eXBlOiBEcmFnUmVzaXplU2VydmljZSwgZGVjb3JhdG9yczogW3sgdHlwZTogT3B0aW9uYWwgfV0gfSxcbiAgICB7IHR5cGU6IExvY2FsaXphdGlvblNlcnZpY2UgfSxcbiAgICB7IHR5cGU6IE5nWm9uZSB9XG5dO1xuV2luZG93UmVzdG9yZUFjdGlvbkRpcmVjdGl2ZS5wcm9wRGVjb3JhdG9ycyA9IHtcbiAgICB3aW5kb3c6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGJ1dHRvblR5cGU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2F0dHIudHlwZScsXSB9XSxcbiAgICBvbkNsaWNrOiBbeyB0eXBlOiBIb3N0TGlzdGVuZXIsIGFyZ3M6IFsnY2xpY2snLF0gfV0sXG4gICAgdmlzaWJsZTogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnc3R5bGUuZGlzcGxheScsXSB9XVxufTtcblxuLyoqXG4gKiBUaGUgc2V0dGluZ3MgZm9yIHRoZSBXaW5kb3cgYWN0aW9ucyB3aGVuIHRoZSBXaW5kb3cgaXMgb3BlbmVkIHRocm91Z2ggYFdpbmRvd1NlcnZpY2VgXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfd2luZG93c2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICovXG5jbGFzcyBXaW5kb3dTZXR0aW5ncyB7XG59XG4vKipcbiAqIEluZGljYXRlcyB0aGF0IHRoZSAqKkNsb3NlKiogYnV0dG9uIG9mIGEgV2luZG93IHRoYXQgaXMgb3BlbmVkIHRocm91Z2ggYFdpbmRvd1NlcnZpY2VgIGlzIGNsaWNrZWQuXG4gKi9cbmNsYXNzIFdpbmRvd0Nsb3NlUmVzdWx0IHtcbn1cbi8qKlxuICogSG9sZHMgcmVmZXJlbmNlcyB0byB0aGUgb2JqZWN0IGluc3RhbmNlIG9mIHRoZSBXaW5kb3cuXG4gKiBDb250cm9scyB0aGUgV2luZG93cyB0aGF0IHdlcmUgb3BlbmVkIHRocm91Z2ggYFdpbmRvd1NlcnZpY2VgXG4gKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfd2luZG93c2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICovXG5jbGFzcyBXaW5kb3dSZWYge1xufVxuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgV2luZG93Q29udGFpbmVyU2VydmljZSB7XG4gICAgc2V0IGNvbnRhaW5lcihjb250YWluZXIpIHtcbiAgICAgICAgV2luZG93Q29udGFpbmVyU2VydmljZS5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgfVxuICAgIGdldCBjb250YWluZXIoKSB7XG4gICAgICAgIHJldHVybiBXaW5kb3dDb250YWluZXJTZXJ2aWNlLmNvbnRhaW5lcjtcbiAgICB9XG59XG5XaW5kb3dDb250YWluZXJTZXJ2aWNlLmNvbnRhaW5lciA9IG51bGw7XG5XaW5kb3dDb250YWluZXJTZXJ2aWNlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBJbmplY3RhYmxlIH0sXG5dO1xuXG5jbGFzcyBXaW5kb3dJbmplY3RvciB7XG4gICAgY29uc3RydWN0b3IoZ2V0V2luZG93UmVmLCBwYXJlbnRJbmplY3Rvcikge1xuICAgICAgICB0aGlzLmdldFdpbmRvd1JlZiA9IGdldFdpbmRvd1JlZjtcbiAgICAgICAgdGhpcy5wYXJlbnRJbmplY3RvciA9IHBhcmVudEluamVjdG9yO1xuICAgIH1cbiAgICBnZXQodG9rZW4sIG5vdEZvdW5kVmFsdWUpIHtcbiAgICAgICAgaWYgKHRva2VuID09PSBXaW5kb3dSZWYpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFdpbmRvd1JlZigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudEluamVjdG9yLmdldCh0b2tlbiwgbm90Rm91bmRWYWx1ZSk7XG4gICAgfVxufVxuLyoqXG4gKiBBIHNlcnZpY2UgZm9yIG9wZW5pbmcgV2luZG93cyBkeW5hbWljYWxseVxuICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBzZXJ2aWNlX3dpbmRvdyAlfSkpLlxuICovXG5jbGFzcyBXaW5kb3dTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgcmVzb2x2ZXIsIGNvbnRhaW5lclNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5yZXNvbHZlciA9IHJlc29sdmVyO1xuICAgICAgICB0aGlzLmNvbnRhaW5lclNlcnZpY2UgPSBjb250YWluZXJTZXJ2aWNlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBPcGVucyBhIFdpbmRvdyBjb21wb25lbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1dpbmRvd1NldHRpbmdzfSBzZXR0aW5ncyAtIFRoZSBzZXR0aW5ncyB0aGF0IGRlZmluZSB0aGUgV2luZG93LlxuICAgICAqIEByZXR1cm5zIHtXaW5kb3dSZWZ9IC0gQSByZWZlcmVuY2UgdG8gdGhlIFdpbmRvdyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqXG4gICAgICogYGBgdHMtbm8tcnVuXG4gICAgICogX0BDb21wb25lbnQoe1xuICAgICAqICAgc2VsZWN0b3I6ICdteS1hcHAnLFxuICAgICAqICAgdGVtcGxhdGU6IGBcbiAgICAgKiAgICAgPGJ1dHRvbiBrZW5kb0J1dHRvbiAoY2xpY2spPVwib3BlbigpXCI+T3BlbiB3aW5kb3c8L2J1dHRvbj5cbiAgICAgKiAgICAgPGRpdiBrZW5kb1dpbmRvd0NvbnRhaW5lcj48L2Rpdj5cbiAgICAgKiAgIGBcbiAgICAgKiB9KVxuICAgICAqIGV4cG9ydCBjbGFzcyBBcHBDb21wb25lbnQge1xuICAgICAqICAgICBjb25zdHJ1Y3RvciggcHJpdmF0ZSB3aW5kb3dTZXJ2aWNlOiBXaW5kb3dTZXJ2aWNlICkge31cbiAgICAgKlxuICAgICAqICAgICBwdWJsaWMgb3BlbigpIHtcbiAgICAgKiAgICAgICAgIHZhciB3aW5kb3cgPSB0aGlzLndpbmRvd1NlcnZpY2Uub3Blbih7XG4gICAgICogICAgICAgICAgIHRpdGxlOiBcIk15IHdpbmRvd1wiLFxuICAgICAqICAgICAgICAgICBjb250ZW50OiBcIk15IGNvbnRlbnQhXCJcbiAgICAgKiAgICAgICAgIH0pO1xuICAgICAqXG4gICAgICogICAgICAgICB3aW5kb3cucmVzdWx0LnN1YnNjcmliZSgocmVzdWx0KSA9PiB7XG4gICAgICogICAgICAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBXaW5kb3dDbG9zZVJlc3VsdCkge1xuICAgICAqICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiV2luZG93IHdhcyBjbG9zZWRcIik7XG4gICAgICogICAgICAgICAgIH1cbiAgICAgKiAgICAgICAgIH0pO1xuICAgICAqICAgICB9XG4gICAgICogfVxuICAgICAqIGBgYFxuICAgICAqXG4gICAgICovXG4gICAgb3BlbihzZXR0aW5ncykge1xuICAgICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShXaW5kb3dDb21wb25lbnQpO1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBzZXR0aW5ncy5hcHBlbmRUbyB8fCB0aGlzLmNvbnRhaW5lclNlcnZpY2UuY29udGFpbmVyO1xuICAgICAgICBpZiAoIWNvbnRhaW5lcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgYXR0YWNoIHdpbmRvdyB0byB0aGUgcGFnZS5cbiAgICAgICAgICAgICAgICBBZGQgYW4gZWxlbWVudCB0aGF0IHVzZXMgdGhlIGtlbmRvV2luZG93Q29udGFpbmVyIGRpcmVjdGl2ZSwgb3Igc2V0IHRoZSAnYXBwZW5kVG8nIHByb3BlcnR5LlxuICAgICAgICAgICAgICAgIFNlZSBodHRwczovL3d3dy50ZWxlcmlrLmNvbS9rZW5kby1hbmd1bGFyLXVpL2NvbXBvbmVudHMvZGlhbG9ncy93aW5kb3cvc2VydmljZS9cbiAgICAgICAgICAgIGApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdpbmRvd1JlZiA9IHtcbiAgICAgICAgICAgIGNsb3NlOiAoKSA9PiB7IH0sXG4gICAgICAgICAgICBjb250ZW50OiBudWxsLFxuICAgICAgICAgICAgcmVzdWx0OiBudWxsLFxuICAgICAgICAgICAgd2luZG93OiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmNvbnRlbnRGcm9tKHNldHRpbmdzLmNvbnRlbnQsIGNvbnRhaW5lciwgd2luZG93UmVmKTtcbiAgICAgICAgY29uc3Qgd2luZG93ID0gY29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5LCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY29udGVudC5ub2Rlcyk7XG4gICAgICAgIHdpbmRvd1JlZi53aW5kb3cgPSB3aW5kb3c7XG4gICAgICAgIHRoaXMuYXBwbHlPcHRpb25zKHdpbmRvdy5pbnN0YW5jZSwgc2V0dGluZ3MpO1xuICAgICAgICBjb25zdCBhcGlDbG9zZSA9IG5ldyBTdWJqZWN0KCk7XG4gICAgICAgIGNvbnN0IGNsb3NlID0gKGUpID0+IHtcbiAgICAgICAgICAgIGFwaUNsb3NlLm5leHQoZSB8fCBuZXcgV2luZG93Q2xvc2VSZXN1bHQoKSk7XG4gICAgICAgICAgICBpZiAoY29udGVudC5jb21wb25lbnRSZWYpIHtcbiAgICAgICAgICAgICAgICBjb250ZW50LmNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aW5kb3cuZGVzdHJveSgpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXN1bHQgPSBtZXJnZShhcGlDbG9zZSwgd2luZG93Lmluc3RhbmNlLmNsb3NlKS5waXBlKHRha2UoMSkpO1xuICAgICAgICByZXN1bHQuc3Vic2NyaWJlKGNsb3NlKTtcbiAgICAgICAgd2luZG93UmVmLmNsb3NlID0gY2xvc2U7XG4gICAgICAgIHdpbmRvd1JlZi5yZXN1bHQgPSByZXN1bHQ7XG4gICAgICAgIHdpbmRvdy5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgcmV0dXJuIHdpbmRvd1JlZjtcbiAgICB9XG4gICAgYXBwbHlPcHRpb25zKGluc3RhbmNlLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy50aXRsZSkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLnRpdGxlID0gb3B0aW9ucy50aXRsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMua2VlcENvbnRlbnQpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5rZWVwQ29udGVudCA9IG9wdGlvbnMua2VlcENvbnRlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLndpZHRoKSkge1xuICAgICAgICAgICAgaW5zdGFuY2Uud2lkdGggPSBvcHRpb25zLndpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5taW5XaWR0aCkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLm1pbldpZHRoID0gb3B0aW9ucy5taW5XaWR0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMuaGVpZ2h0KSkge1xuICAgICAgICAgICAgaW5zdGFuY2UuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLm1pbkhlaWdodCkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLm1pbkhlaWdodCA9IG9wdGlvbnMubWluSGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5sZWZ0KSkge1xuICAgICAgICAgICAgaW5zdGFuY2UubGVmdCA9IG9wdGlvbnMubGVmdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMudG9wKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UudG9wID0gb3B0aW9ucy50b3A7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLmRyYWdnYWJsZSkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLmRyYWdnYWJsZSA9IG9wdGlvbnMuZHJhZ2dhYmxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1ByZXNlbnQob3B0aW9ucy5yZXNpemFibGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5yZXNpemFibGUgPSBvcHRpb25zLnJlc2l6YWJsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMubWVzc2FnZXMgJiYgb3B0aW9ucy5tZXNzYWdlcy5jbG9zZVRpdGxlKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UubWVzc2FnZXMuY2xvc2VUaXRsZSA9IG9wdGlvbnMubWVzc2FnZXMuY2xvc2VUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMubWVzc2FnZXMgJiYgb3B0aW9ucy5tZXNzYWdlcy5yZXN0b3JlVGl0bGUpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5tZXNzYWdlcy5yZXN0b3JlVGl0bGUgPSBvcHRpb25zLm1lc3NhZ2VzLnJlc3RvcmVUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMubWVzc2FnZXMgJiYgb3B0aW9ucy5tZXNzYWdlcy5tYXhpbWl6ZVRpdGxlKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UubWVzc2FnZXMubWF4aW1pemVUaXRsZSA9IG9wdGlvbnMubWVzc2FnZXMubWF4aW1pemVUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMubWVzc2FnZXMgJiYgb3B0aW9ucy5tZXNzYWdlcy5taW5pbWl6ZVRpdGxlKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UubWVzc2FnZXMubWluaW1pemVUaXRsZSA9IG9wdGlvbnMubWVzc2FnZXMubWluaW1pemVUaXRsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNQcmVzZW50KG9wdGlvbnMuYXV0b0ZvY3VzZWRFbGVtZW50KSkge1xuICAgICAgICAgICAgaW5zdGFuY2UuYXV0b0ZvY3VzZWRFbGVtZW50ID0gb3B0aW9ucy5hdXRvRm9jdXNlZEVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzUHJlc2VudChvcHRpb25zLnN0YXRlKSkge1xuICAgICAgICAgICAgaW5zdGFuY2Uuc3RhdGUgPSBvcHRpb25zLnN0YXRlO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RhdGUgPT09ICdtaW5pbWl6ZWQnKSB7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2Uua2VlcENvbnRlbnQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmNvbnRlbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZikge1xuICAgICAgICAgICAgaW5zdGFuY2UuY29udGVudFRlbXBsYXRlID0gb3B0aW9ucy5jb250ZW50O1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnRpdGxlQmFyQ29udGVudCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS50aXRsZUJhclRlbXBsYXRlID0gb3B0aW9ucy50aXRsZUJhckNvbnRlbnQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29udGVudEZyb20oY29udGVudCwgY29udGFpbmVyLCB3aW5kb3dSZWYpIHtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBjb250YWluZXIuaW5qZWN0b3IuZ2V0KFJlbmRlcmVyMik7XG4gICAgICAgIGxldCBub2RlcyA9IFtdO1xuICAgICAgICBsZXQgY29tcG9uZW50UmVmID0gbnVsbDtcbiAgICAgICAgaWYgKHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgbm9kZXMgPSBbcmVuZGVyZXIuY3JlYXRlVGV4dChjb250ZW50KV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29udGVudCAmJiAhKGNvbnRlbnQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZikpIHtcbiAgICAgICAgICAgIGNvbnN0IGluamVjdG9yID0gbmV3IFdpbmRvd0luamVjdG9yKCgpID0+IHdpbmRvd1JlZiwgY29udGFpbmVyLmluamVjdG9yKTtcbiAgICAgICAgICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbnRlbnQpO1xuICAgICAgICAgICAgY29tcG9uZW50UmVmID0gY29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5LCB1bmRlZmluZWQsIGluamVjdG9yKTtcbiAgICAgICAgICAgIG5vZGVzID0gW2NvbXBvbmVudFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50XTtcbiAgICAgICAgICAgIHdpbmRvd1JlZi5jb250ZW50ID0gY29tcG9uZW50UmVmO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYsXG4gICAgICAgICAgICBub2RlczogW1xuICAgICAgICAgICAgICAgIFtdLFxuICAgICAgICAgICAgICAgIG5vZGVzIC8vIENvbnRlbnRcbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICB9XG59XG5XaW5kb3dTZXJ2aWNlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBJbmplY3RhYmxlIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5XaW5kb3dTZXJ2aWNlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyIH0sXG4gICAgeyB0eXBlOiBXaW5kb3dDb250YWluZXJTZXJ2aWNlLCBkZWNvcmF0b3JzOiBbeyB0eXBlOiBJbmplY3QsIGFyZ3M6IFtXaW5kb3dDb250YWluZXJTZXJ2aWNlLF0gfV0gfVxuXTtcblxuLyoqXG4gKiBQcm92aWRlcyBhbiBpbnNlcnRpb24gcG9pbnQgZm9yIHRoZSBEaWFsb2dzIHdoaWNoIGFyZSBjcmVhdGVkIHRocm91Z2ggdGhlXG4gKiBEaWFsb2cgc2VydmljZSAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGFwaV9kaWFsb2dfZGlhbG9nc2VydmljZSAlfSN0b2Mtb3BlbikpLlxuICogQ3JlYXRlZCBEaWFsb2dzIHdpbGwgYmUgbW91bnRlZCBhZnRlciB0aGF0IGVsZW1lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWwtbm8tcnVuXG4gKiA8ZGl2IGtlbmRvRGlhbG9nQ29udGFpbmVyPjwvZGl2PlxuICogYGBgXG4gKi9cbmNsYXNzIERpYWxvZ0NvbnRhaW5lckRpcmVjdGl2ZSB7XG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyLCBzZXJ2aWNlKSB7XG4gICAgICAgIHNlcnZpY2UuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgIH1cbn1cbkRpYWxvZ0NvbnRhaW5lckRpcmVjdGl2ZS5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogRGlyZWN0aXZlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAnW2tlbmRvRGlhbG9nQ29udGFpbmVyXSdcbiAgICAgICAgICAgIH0sXSB9LFxuXTtcbi8qKiBAbm9jb2xsYXBzZSAqL1xuRGlhbG9nQ29udGFpbmVyRGlyZWN0aXZlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogVmlld0NvbnRhaW5lclJlZiB9LFxuICAgIHsgdHlwZTogRGlhbG9nQ29udGFpbmVyU2VydmljZSB9XG5dO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgTWVzc2FnZXMgZXh0ZW5kcyBDb21wb25lbnRNZXNzYWdlcyB7XG59XG5NZXNzYWdlcy5wcm9wRGVjb3JhdG9ycyA9IHtcbiAgICBjbG9zZVRpdGxlOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICByZXN0b3JlVGl0bGU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIG1heGltaXplVGl0bGU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIG1pbmltaXplVGl0bGU6IFt7IHR5cGU6IElucHV0IH1dXG59O1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmUgZXh0ZW5kcyBNZXNzYWdlcyB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgIH1cbn1cbkxvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBEaXJlY3RpdmUsIGFyZ3M6IFt7XG4gICAgICAgICAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IE1lc3NhZ2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmUpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBgXG4gICAgW2tlbmRvRGlhbG9nTG9jYWxpemVkTWVzc2FnZXNdLFxuICAgIFtrZW5kb1dpbmRvd0xvY2FsaXplZE1lc3NhZ2VzXVxuICBgXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbkxvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogTG9jYWxpemF0aW9uU2VydmljZSB9XG5dO1xuXG4vKipcbiAqIEN1c3RvbSBjb21wb25lbnQgbWVzc2FnZXMgb3ZlcnJpZGUgZGVmYXVsdCBjb21wb25lbnQgbWVzc2FnZXNcbiAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgZ2xvYmFsaXphdGlvbl9kaWFsb2dzICV9I3RvYy1sb2NhbGl6YXRpb24pKS5cbiAqL1xuY2xhc3MgQ3VzdG9tTWVzc2FnZXNDb21wb25lbnQgZXh0ZW5kcyBNZXNzYWdlcyB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgIH1cbiAgICBnZXQgb3ZlcnJpZGUoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cbkN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50LmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBDb21wb25lbnQsIGFyZ3M6IFt7XG4gICAgICAgICAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IE1lc3NhZ2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gQ3VzdG9tTWVzc2FnZXNDb21wb25lbnQpIC8vIHRzbGludDpkaXNhYmxlLWxpbmU6bm8tZm9yd2FyZC1yZWZcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdrZW5kby1kaWFsb2ctbWVzc2FnZXMsIGtlbmRvLXdpbmRvdy1tZXNzYWdlcycsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGBgXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbkN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50LmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogTG9jYWxpemF0aW9uU2VydmljZSB9XG5dO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgU0hBUkVEX0RJUkVDVElWRVMgPSBbXG4gICAgRGlhbG9nQWN0aW9uc0NvbXBvbmVudCxcbiAgICBDdXN0b21NZXNzYWdlc0NvbXBvbmVudCxcbiAgICBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZVxuXTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jbGFzcyBTaGFyZWRNb2R1bGUge1xufVxuU2hhcmVkTW9kdWxlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBOZ01vZHVsZSwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbnM6IFtTSEFSRURfRElSRUNUSVZFU10sXG4gICAgICAgICAgICAgICAgZXhwb3J0czogW1NIQVJFRF9ESVJFQ1RJVkVTLCBDb21tb25Nb2R1bGVdLFxuICAgICAgICAgICAgICAgIGltcG9ydHM6IFtDb21tb25Nb2R1bGVdXG4gICAgICAgICAgICB9LF0gfSxcbl07XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBESUFMT0dfRElSRUNUSVZFUyA9IFtcbiAgICBEaWFsb2dDb21wb25lbnQsXG4gICAgRGlhbG9nVGl0bGVCYXJDb21wb25lbnRcbl07XG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtOZ01vZHVsZV0oe3sgc2l0ZS5kYXRhLnVybHMuYW5ndWxhclsnbmdtb2R1bGVhcGknXSB9fSlcbiAqIGRlZmluaXRpb24gZm9yIHRoZSBEaWFsb2cgY29tcG9uZW50IHRoYXQgaW5jbHVkZXMgYWxsIERpYWxvZyBjb21wb25lbnRzIGFuZCBkaXJlY3RpdmVzLlxuICogSW1wb3J0cyBgRGlhbG9nTW9kdWxlYCBpbnRvIHRoZSBbcm9vdCBtb2R1bGVdKHt7IHNpdGUuZGF0YS51cmxzLmFuZ3VsYXJbJ25nbW9kdWxlcyddIH19I2FuZ3VsYXItbW9kdWxhcml0eSlcbiAqIG9mIHlvdXIgYXBwbGljYXRpb24gb3IgaW50byBhbnkgb3RoZXIgc3ViLW1vZHVsZSB0aGF0IHdpbGwgdXNlIHRoZSBEaWFsb2cgY29tcG9uZW50LlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0cy1uby1ydW5cbiAqIGltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG4gKiBpbXBvcnQgeyBCcm93c2VyTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG4gKiBpbXBvcnQgeyBEaWFsb2dNb2R1bGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci1kaWFsb2cnO1xuICogaW1wb3J0IHsgQXBwQ29tcG9uZW50IH0gZnJvbSAnLi9hcHAuY29tcG9uZW50JztcbiAqXG4gKiBfQE5nTW9kdWxlKHtcbiAqICAgICBib290c3RyYXA6ICAgIFtBcHBDb21wb25lbnRdLFxuICogICAgIGRlY2xhcmF0aW9uczogW0FwcENvbXBvbmVudF0sXG4gKiAgICAgaW1wb3J0czogICAgICBbQnJvd3Nlck1vZHVsZSwgRGlhbG9nTW9kdWxlXVxuICogfSlcbiAqIGV4cG9ydCBjbGFzcyBBcHBNb2R1bGUge1xuICogfVxuICogYGBgXG4gKi9cbmNsYXNzIERpYWxvZ01vZHVsZSB7XG59XG5EaWFsb2dNb2R1bGUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IE5nTW9kdWxlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uczogW0RJQUxPR19ESVJFQ1RJVkVTLCBEaWFsb2dDb250YWluZXJEaXJlY3RpdmVdLFxuICAgICAgICAgICAgICAgIGVudHJ5Q29tcG9uZW50czogW0RJQUxPR19ESVJFQ1RJVkVTXSxcbiAgICAgICAgICAgICAgICBleHBvcnRzOiBbRElBTE9HX0RJUkVDVElWRVMsIFNIQVJFRF9ESVJFQ1RJVkVTLCBEaWFsb2dDb250YWluZXJEaXJlY3RpdmVdLFxuICAgICAgICAgICAgICAgIGltcG9ydHM6IFtTaGFyZWRNb2R1bGVdLFxuICAgICAgICAgICAgICAgIHByb3ZpZGVyczogW0RpYWxvZ0NvbnRhaW5lclNlcnZpY2UsIERpYWxvZ1NlcnZpY2VdXG4gICAgICAgICAgICB9LF0gfSxcbl07XG5cbi8qKlxuICogUHJvdmlkZXMgYW4gaW5zZXJ0aW9uIHBvaW50IGZvciB0aGUgV2luZG93cyB3aGljaCBhcmUgY3JlYXRlZCB0aHJvdWdoIHRoZVxuICogV2luZG93IHNlcnZpY2UgKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBhcGlfZGlhbG9nX3dpbmRvd3NlcnZpY2UgJX0jdG9jLW9wZW4pKS5cbiAqIENyZWF0ZWQgV2luZG93cyB3aWxsIGJlIG1vdW50ZWQgYWZ0ZXIgdGhhdCBlbGVtZW50LlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBodG1sLW5vLXJ1blxuICogPGRpdiBrZW5kb1dpbmRvd0NvbnRhaW5lcj48L2Rpdj5cbiAqIGBgYFxuICovXG5jbGFzcyBXaW5kb3dDb250YWluZXJEaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lciwgc2VydmljZSkge1xuICAgICAgICBzZXJ2aWNlLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB9XG59XG5XaW5kb3dDb250YWluZXJEaXJlY3RpdmUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IERpcmVjdGl2ZSwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ1trZW5kb1dpbmRvd0NvbnRhaW5lcl0nXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbldpbmRvd0NvbnRhaW5lckRpcmVjdGl2ZS5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IFZpZXdDb250YWluZXJSZWYgfSxcbiAgICB7IHR5cGU6IFdpbmRvd0NvbnRhaW5lclNlcnZpY2UgfVxuXTtcblxuY29uc3QgV0lORE9XX0RJUkVDVElWRVMgPSBbXG4gICAgUmVzaXplSGFuZGxlRGlyZWN0aXZlLFxuICAgIFdpbmRvd0NvbXBvbmVudCxcbiAgICBXaW5kb3dUaXRsZUJhckNvbXBvbmVudCxcbiAgICBXaW5kb3dDbG9zZUFjdGlvbkRpcmVjdGl2ZSxcbiAgICBXaW5kb3dNaW5pbWl6ZUFjdGlvbkRpcmVjdGl2ZSxcbiAgICBXaW5kb3dNYXhpbWl6ZUFjdGlvbkRpcmVjdGl2ZSxcbiAgICBXaW5kb3dSZXN0b3JlQWN0aW9uRGlyZWN0aXZlXG5dO1xuY29uc3QgRU5UUllfQ09NUE9ORU5UUyA9IFtcbiAgICBXaW5kb3dDb21wb25lbnQsXG4gICAgV2luZG93VGl0bGVCYXJDb21wb25lbnRcbl07XG5jb25zdCBleHBvcnRlZE1vZHVsZXMgPSBbXG4gICAgV2luZG93Q29tcG9uZW50LFxuICAgIFdpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlLFxuICAgIFdpbmRvd01pbmltaXplQWN0aW9uRGlyZWN0aXZlLFxuICAgIFdpbmRvd01heGltaXplQWN0aW9uRGlyZWN0aXZlLFxuICAgIFdpbmRvd1Jlc3RvcmVBY3Rpb25EaXJlY3RpdmUsXG4gICAgV2luZG93VGl0bGVCYXJDb21wb25lbnRcbl07XG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFtOZ01vZHVsZV0oe3sgc2l0ZS5kYXRhLnVybHMuYW5ndWxhclsnbmdtb2R1bGVhcGknXSB9fSlcbiAqIGRlZmluaXRpb24gZm9yIHRoZSBXaW5kb3cgY29tcG9uZW50LiBJbXBvcnRzIGBXaW5kb3dNb2R1bGVgIGludG8gdGhlXG4gKiBbcm9vdCBtb2R1bGVdKHt7IHNpdGUuZGF0YS51cmxzLmFuZ3VsYXJbJ25nbW9kdWxlcyddIH19I2FuZ3VsYXItbW9kdWxhcml0eSlcbiAqIG9mIHlvdXIgYXBwbGljYXRpb24gb3IgaW50byBhbnkgb3RoZXIgc3ViLW1vZHVsZSB0aGF0IHdpbGwgdXNlIHRoZSBXaW5kb3cgY29tcG9uZW50LlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0cy1uby1ydW5cbiAqIGltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG4gKiBpbXBvcnQgeyBCcm93c2VyTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG4gKiBpbXBvcnQgeyBXaW5kb3dNb2R1bGUgfSBmcm9tICdAcHJvZ3Jlc3Mva2VuZG8tYW5ndWxhci13aW5kb3cnO1xuICogaW1wb3J0IHsgQXBwQ29tcG9uZW50IH0gZnJvbSAnLi9hcHAuY29tcG9uZW50JztcbiAqXG4gKiBfQE5nTW9kdWxlKHtcbiAqICAgICBib290c3RyYXA6ICAgIFtBcHBDb21wb25lbnRdLFxuICogICAgIGRlY2xhcmF0aW9uczogW0FwcENvbXBvbmVudF0sXG4gKiAgICAgaW1wb3J0czogICAgICBbQnJvd3Nlck1vZHVsZSwgV2luZG93TW9kdWxlXVxuICogfSlcbiAqIGV4cG9ydCBjbGFzcyBBcHBNb2R1bGUge1xuICogfVxuICogYGBgXG4gKi9cbmNsYXNzIFdpbmRvd01vZHVsZSB7XG59XG5XaW5kb3dNb2R1bGUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IE5nTW9kdWxlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uczogW1dJTkRPV19ESVJFQ1RJVkVTLCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmVdLFxuICAgICAgICAgICAgICAgIGVudHJ5Q29tcG9uZW50czogW0VOVFJZX0NPTVBPTkVOVFNdLFxuICAgICAgICAgICAgICAgIGV4cG9ydHM6IFtleHBvcnRlZE1vZHVsZXMsIFNIQVJFRF9ESVJFQ1RJVkVTLCBXaW5kb3dDb250YWluZXJEaXJlY3RpdmVdLFxuICAgICAgICAgICAgICAgIGltcG9ydHM6IFtTaGFyZWRNb2R1bGUsIERyYWdnYWJsZU1vZHVsZV0sXG4gICAgICAgICAgICAgICAgcHJvdmlkZXJzOiBbV2luZG93Q29udGFpbmVyU2VydmljZSwgV2luZG93U2VydmljZV1cbiAgICAgICAgICAgIH0sXSB9LFxuXTtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbTmdNb2R1bGVdKHt7IHNpdGUuZGF0YS51cmxzLmFuZ3VsYXJbJ25nbW9kdWxlYXBpJ10gfX0pXG4gKiBkZWZpbml0aW9uIGZvciB0aGUgRGlhbG9ncyBjb21wb25lbnRzLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogYGBgdHMtbm8tcnVuXG4gKiBpbXBvcnQgeyBEaWFsb2dzTW9kdWxlIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItZGlhbG9nJztcbiAqXG4gKiBpbXBvcnQgeyBwbGF0Zm9ybUJyb3dzZXJEeW5hbWljIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlci1keW5hbWljJztcbiAqIGltcG9ydCB7IE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG4gKlxuICogaW1wb3J0IHsgQXBwQ29tcG9uZW50IH0gZnJvbSAnLi9hcHAuY29tcG9uZW50JztcbiAqXG4gKiBfQE5nTW9kdWxlKHtcbiAqICAgICBkZWNsYXJhdGlvbnM6IFtBcHBDb21wb25lbnRdLFxuICogICAgIGltcG9ydHM6ICAgICAgW0Jyb3dzZXJNb2R1bGUsIERpYWxvZ3NNb2R1bGVdLFxuICogICAgIGJvb3RzdHJhcDogICAgW0FwcENvbXBvbmVudF1cbiAqIH0pXG4gKiBleHBvcnQgY2xhc3MgQXBwTW9kdWxlIHt9XG4gKlxuICogcGxhdGZvcm1Ccm93c2VyRHluYW1pYygpLmJvb3RzdHJhcE1vZHVsZShBcHBNb2R1bGUpO1xuICpcbiAqIGBgYFxuICovXG5jbGFzcyBEaWFsb2dzTW9kdWxlIHtcbn1cbkRpYWxvZ3NNb2R1bGUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IE5nTW9kdWxlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGV4cG9ydHM6IFtEaWFsb2dNb2R1bGUsIFdpbmRvd01vZHVsZV1cbiAgICAgICAgICAgIH0sXSB9LFxuXTtcblxuLyoqXG4gKiBHZW5lcmF0ZWQgYnVuZGxlIGluZGV4LiBEbyBub3QgZWRpdC5cbiAqL1xuXG5leHBvcnQgeyBESUFMT0dfRElSRUNUSVZFUywgRGlhbG9nQ29udGFpbmVyRGlyZWN0aXZlLCBEaWFsb2dDb250YWluZXJTZXJ2aWNlLCBDdXN0b21NZXNzYWdlc0NvbXBvbmVudCwgRElBTE9HX0xPQ0FMSVpBVElPTl9TRVJWSUNFLCBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZSwgTWVzc2FnZXMsIFNIQVJFRF9ESVJFQ1RJVkVTLCBTaGFyZWRNb2R1bGUsIERyYWdSZXNpemVTZXJ2aWNlLCBOYXZpZ2F0aW9uU2VydmljZSwgV2luZG93Q29udGFpbmVyRGlyZWN0aXZlLCBXaW5kb3dDb250YWluZXJTZXJ2aWNlLCBSZXNpemVIYW5kbGVEaXJlY3RpdmUsIERpYWxvZ0NvbXBvbmVudCwgRGlhbG9nVGl0bGVCYXJDb21wb25lbnQsIERpYWxvZ0NvbnRlbnRCYXNlLCBEaWFsb2dBY3Rpb25zQ29tcG9uZW50LCBEaWFsb2dTZXJ2aWNlLCBEaWFsb2dDbG9zZVJlc3VsdCwgRGlhbG9nUmVmLCBEaWFsb2dTZXR0aW5ncywgRGlhbG9nQWN0aW9uLCBXaW5kb3dDb21wb25lbnQsIFdpbmRvd1RpdGxlQmFyQ29tcG9uZW50LCBXaW5kb3dNYXhpbWl6ZUFjdGlvbkRpcmVjdGl2ZSwgV2luZG93TWluaW1pemVBY3Rpb25EaXJlY3RpdmUsIFdpbmRvd0Nsb3NlQWN0aW9uRGlyZWN0aXZlLCBXaW5kb3dSZXN0b3JlQWN0aW9uRGlyZWN0aXZlLCBXaW5kb3dTZXR0aW5ncywgV2luZG93UmVmLCBXaW5kb3dDbG9zZVJlc3VsdCwgV2luZG93U2VydmljZSwgRGlhbG9nTW9kdWxlLCBXaW5kb3dNb2R1bGUsIERpYWxvZ3NNb2R1bGUgfTtcbiJdfQ==