import * as tslib_1 from "tslib";
import { hasEntity } from './hasEntity';
// @internal
export function addEntities(_a) {
    var state = _a.state, entities = _a.entities, idKey = _a.idKey, _b = _a.options, options = _b === void 0 ? {} : _b, preAddEntity = _a.preAddEntity;
    var e_1, _c;
    var newEntities = {};
    var newIds = [];
    var hasNewEntities = false;
    try {
        for (var entities_1 = tslib_1.__values(entities), entities_1_1 = entities_1.next(); !entities_1_1.done; entities_1_1 = entities_1.next()) {
            var entity = entities_1_1.value;
            if (hasEntity(state.entities, entity[idKey]) === false) {
                // evaluate the middleware first to support dynamic ids
                var current = preAddEntity(entity);
                var entityId = current[idKey];
                newEntities[entityId] = current;
                if (options.prepend)
                    newIds.unshift(entityId);
                else
                    newIds.push(entityId);
                hasNewEntities = true;
            }
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (entities_1_1 && !entities_1_1.done && (_c = entities_1.return)) _c.call(entities_1);
        }
        finally { if (e_1) throw e_1.error; }
    }
    return hasNewEntities
        ? {
            newState: tslib_1.__assign({}, state, { entities: tslib_1.__assign({}, state.entities, newEntities), ids: options.prepend ? tslib_1.__spread(newIds, state.ids) : tslib_1.__spread(state.ids, newIds) }),
            newIds: newIds
        }
        : null;
}
//# sourceMappingURL=addEntities.js.map