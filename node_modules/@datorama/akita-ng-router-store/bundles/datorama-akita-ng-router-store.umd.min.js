!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/router"),require("@datorama/akita"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@datorama/akita-ng-router-store",["exports","@angular/core","@angular/router","@datorama/akita","rxjs","rxjs/operators"],e):e(((t=t||self).datorama=t.datorama||{},t.datorama["akita-ng-router-store"]={}),t.ng.core,t.ng.router,t.akita,t.rxjs,t.rxjs.operators)}(this,(function(t,e,r,n,i,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function s(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function c(t,e,r,n){var i,a=arguments.length,o=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(o=(a<3?i(o):a>3?i(e,r,o):i(e,r))||o);return a>3&&o&&Object.defineProperty(e,r,o),o}function p(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function l(){return{state:null,navigationId:null}}var d=function(t){function r(){return t.call(this,{state:null,navigationId:null})||this}return s(r,t),r.ngInjectableDef=e["ɵɵdefineInjectable"]({factory:function(){return new r},token:r,providedIn:"root"}),r=c([e.Injectable({providedIn:"root"}),n.StoreConfig({name:"router"}),p("design:paramtypes",[])],r)}(n.Store);function f(t){return function(e){return e.pipe(a.map((function(t){return t.state}))).pipe(n.filterNil,a.map((function(e){return e[t]})))}}var g=function(t){function r(e){var r=t.call(this,e)||this;return r.store=e,r.__navigationCancel=new i.Subject,r.__navigationError=new i.Subject,r}return s(r,t),r.prototype.selectParams=function(t){var e=this;if(void 0===t)return this.select().pipe(f("params"),a.distinctUntilChanged());var r=function(t){return e.select().pipe(f("params"),a.pluck(t),a.distinctUntilChanged())};if(Array.isArray(t)){var n=t.map(r);return i.combineLatest(n)}return r(t).pipe(a.distinctUntilChanged())},r.prototype.getParams=function(t){if(this.getValue().state){var e=this.getValue().state.params;return void 0===t?e:e[t]}return null},r.prototype.selectQueryParams=function(t){var e=this;if(void 0===t)return this.select().pipe(f("queryParams"),a.distinctUntilChanged());var r=function(t){return e.select().pipe(f("queryParams"),a.pluck(t),a.distinctUntilChanged())};if(Array.isArray(t)){var n=t.map(r);return i.combineLatest(n)}return r(t)},r.prototype.getQueryParams=function(t){if(this.getValue().state){var e=this.getValue().state.queryParams;return void 0===t?e:e[t]}return null},r.prototype.selectFragment=function(){return this.select().pipe(f("fragment"),a.distinctUntilChanged())},r.prototype.getFragment=function(){return this.getValue().state?this.getValue().state.fragment:null},r.prototype.selectData=function(t){return void 0===t?this.select().pipe(f("data"),a.distinctUntilChanged()):this.select().pipe(f("data"),a.pluck(t),a.distinctUntilChanged())},r.prototype.getData=function(t){if(this.getValue().state){var e=this.getValue().state.data;return void 0===t?e:e[t]}return null},r.prototype.selectNavigationExtras=function(t){return void 0===t?this.select().pipe(f("navigationExtras"),a.distinctUntilChanged()):this.select().pipe(f("data"),a.pluck(t),a.distinctUntilChanged())},r.prototype.getNavigationExtras=function(t){if(this.getValue().state){var e=this.getValue().state.navigationExtras;return void 0===t?e:e[t]}return null},r.prototype.selectNavigationCancel=function(){return this.__navigationCancel.asObservable()},r.prototype.selectNavigationError=function(){return this.__navigationError.asObservable()},r.ctorParameters=function(){return[{type:d}]},r.ngInjectableDef=e["ɵɵdefineInjectable"]({factory:function(){return new r(e["ɵɵinject"](d))},token:r,providedIn:"root"}),r=c([e.Injectable({providedIn:"root"}),p("design:paramtypes",[d])],r)}(n.Query),h=function(){function t(t,e,r){this.routerStore=t,this.routerQuery=e,this.router=r,this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1}return t.prototype.dispatchRouterCancel=function(t){this.update({navigationId:t.id}),this.routerQuery.__navigationCancel.next(t)},t.prototype.dispatchRouterError=function(t){this.update({navigationId:t.id}),this.routerQuery.__navigationError.next(t)},t.prototype.dispatchRouterSuccess=function(){this.update(this.lastRouterState)},t.prototype.init=function(){this.setUpStoreListener(),this.setUpStateRollbackEvents()},t.prototype.update=function(t){this.dispatchTriggeredByRouter=!0,this.routerStore.update((function(e){return u({},e,t)})),this.dispatchTriggeredByRouter=!1,this.navigationTriggeredByDispatch=!1},t.prototype.setUpStoreListener=function(){var t=this;this.routerQuery.select((function(t){return t})).subscribe((function(e){t.lastRouterState=e,t.navigateIfNeeded()}))},t.prototype.navigateIfNeeded=function(){this.lastRouterState&&this.lastRouterState.state&&!this.dispatchTriggeredByRouter&&this.router.url!==this.lastRouterState.state.url&&(this.navigationTriggeredByDispatch=!0,n.setSkipAction(),this.router.navigateByUrl(this.lastRouterState.state.url))},t.prototype.setUpStateRollbackEvents=function(){var t=this;this.router.events.subscribe((function(e){e instanceof r.RoutesRecognized||e instanceof r.GuardsCheckEnd||e instanceof r.ResolveEnd?t.lastRouterState=t.serializeRoute(e):e instanceof r.NavigationCancel?t.dispatchRouterCancel(e):e instanceof r.NavigationError?t.dispatchRouterError(e):e instanceof r.NavigationEnd&&!t.navigationTriggeredByDispatch&&t.dispatchRouterSuccess()}))},t.prototype.serializeRoute=function(t){for(var e=t.state.root;e.firstChild;)e=e.firstChild;var r=e.params,n=e.data,i=e.queryParams,a=e.fragment;return{navigationId:t.id,state:{url:t.url,urlAfterRedirects:t.urlAfterRedirects,params:r,queryParams:i,fragment:a,data:n,navigationExtras:this.router.getCurrentNavigation().extras?this.router.getCurrentNavigation().extras.state:{}}}},t.ctorParameters=function(){return[{type:d},{type:g},{type:r.Router}]},t.ngInjectableDef=e["ɵɵdefineInjectable"]({factory:function(){return new t(e["ɵɵinject"](d),e["ɵɵinject"](g),e["ɵɵinject"](r.Router))},token:t,providedIn:"root"}),c([n.action("Navigation Cancelled"),p("design:type",Function),p("design:paramtypes",[r.NavigationCancel]),p("design:returntype",void 0)],t.prototype,"dispatchRouterCancel",null),c([n.action("Navigation Error"),p("design:type",Function),p("design:paramtypes",[r.NavigationError]),p("design:returntype",void 0)],t.prototype,"dispatchRouterError",null),c([n.action("Navigation Succeeded"),p("design:type",Function),p("design:paramtypes",[]),p("design:returntype",void 0)],t.prototype,"dispatchRouterSuccess",null),t=c([e.Injectable({providedIn:"root"}),p("design:paramtypes",[d,g,r.Router])],t)}(),y=function(){function t(t){this.routerService=t,this.routerService.init()}return t.ctorParameters=function(){return[{type:h}]},t=c([e.NgModule(),p("design:paramtypes",[h])],t)}();t.AkitaNgRouterStoreModule=y,t.RouterQuery=g,t.RouterService=h,t.RouterStore=d,t.createInitialRouterState=l,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=datorama-akita-ng-router-store.umd.min.js.map